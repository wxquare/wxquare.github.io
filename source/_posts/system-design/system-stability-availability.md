---
title: 互联网系统设计 - 浅谈稳定性、可用性、性能优化
date: 2024-04-01
categories:
- 系统设计
---

## 影响系统可用性的因素

## 在系统可以用性可以做哪些工作

### 架构上设计 (拆分/解偶/资源隔离）
- 支持异地多活（DR集群）
- 服务支持横向扩容，扩容时注意事项（mysql，redis，kafka，es，依赖方，监控）
- 离线和在线分离
- mysql分库，分表、kafka topic、不同的ES集群
- 辑架构和物理架构分离，订单系统支持根据业务类型路由

### 系统保护
- 限流
- 熔断降级（核心功能报错，非核心功能返回空或者固定内容）

### 技术选型，组件本身的可用性保证和容量评估
- 适用性
- 优缺点
- 产品口碑
- 社区活跃度
- 实战案例
- 扩展性等多个方面进行全量评估
- 容量评估，mysql 一写多读，codis，kafka，ES
- 灾备，快速恢复

### 功能设计时考虑
- 接口维度的限流、用户维度限流
- 避免单点：比如在主页设计时，主页配置数据需要写在多个redis中
- 核心功能降级策略：redis→cdn

### 变更和服务扩容发布流程
- 新版本发布兼容，数据准备，变更流程，服务发布顺序
- 扩容时注意事项（mysql，redis，kafka，es，依赖方，监控）
- DB变更、配置变更、组件变更

### 可观测性&告警
- metric & log & trace
- 监控体系和告警指标
- SLA和NOC指标


## 可观测性、监控和告警
- 业务层的监控，例如NOC核心指标监控，登陆、首页流量、成功率、PDP流量、成功率、下单流量、成功率、支付数量、成功率等
- 网关的监控。所有接口的流量、成功率、耗时95线，限流监控
- 接口详情监控：可以筛选出每个接口流量、成功率、具体错误吗、耗时均线、95线等
- 核心功能监控：缓存命中率、变价率、数据一致性监控
- 中间件外部组件监控：mysql、redis、kafka、es,容器资源监控等
- 外部依赖监控：支付团队，履约团队、供应商依赖服务监控


参考：
- [浅谈系统稳定性与高可用保障的几种思路](https://tech.dewu.com/article?id=5)
- [ShopeePay 数据中心同城双活之路](https://www.modb.pro/db/474515)
- [如何建设监控体系](https://dunwu.github.io/blog/pages/e593a4/)