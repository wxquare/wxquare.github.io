<h1 id="Redis-Ziplist-è¯¦ç»†ç»“æ„å¯è§†åŒ–"><a href="#Redis-Ziplist-è¯¦ç»†ç»“æ„å¯è§†åŒ–" class="headerlink" title="Redis Ziplist è¯¦ç»†ç»“æ„å¯è§†åŒ–"></a>Redis Ziplist è¯¦ç»†ç»“æ„å¯è§†åŒ–</h1><h2 id="1-Ziplist-æ•´ä½“ç»“æ„å’Œ-Entry-èŠ‚ç‚¹è¯¦è§£"><a href="#1-Ziplist-æ•´ä½“ç»“æ„å’Œ-Entry-èŠ‚ç‚¹è¯¦è§£" class="headerlink" title="1. Ziplist æ•´ä½“ç»“æ„å’Œ Entry èŠ‚ç‚¹è¯¦è§£"></a>1. Ziplist æ•´ä½“ç»“æ„å’Œ Entry èŠ‚ç‚¹è¯¦è§£</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph overview [&quot;ziplist æ•´ä½“ç»“æ„ - è¿ç»­å†…å­˜å—&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        zlbytes[&quot;zlbytes&lt;br/&gt;4å­—èŠ‚&lt;br/&gt;æ•´ä¸ªziplistå ç”¨å­—èŠ‚æ•°&quot;]</span><br><span class="line">        zltail[&quot;zltail&lt;br/&gt;4å­—èŠ‚&lt;br/&gt;åˆ°å°¾èŠ‚ç‚¹çš„åç§»é‡&quot;]</span><br><span class="line">        zllen[&quot;zllen&lt;br/&gt;2å­—èŠ‚&lt;br/&gt;èŠ‚ç‚¹æ•°é‡&lt;br/&gt;æœ€å¤§65535&quot;]</span><br><span class="line">        </span><br><span class="line">        entry1[&quot;entry 1&quot;]</span><br><span class="line">        entry2[&quot;entry 2&quot;]</span><br><span class="line">        entry3[&quot;entry 3&quot;]</span><br><span class="line">        entryn[&quot;entry N&quot;]</span><br><span class="line">        </span><br><span class="line">        zlend[&quot;zlend&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;0xFF&lt;br/&gt;ç»“æŸæ ‡è®°&quot;]</span><br><span class="line">        </span><br><span class="line">        zlbytes --&gt; zltail --&gt; zllen --&gt; entry1 --&gt; entry2 --&gt; entry3 --&gt; entryn --&gt; zlend</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph entry_struct [&quot;Entry èŠ‚ç‚¹è¯¦ç»†ç»“æ„ - ä¸‰éƒ¨åˆ†&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph prevlen [&quot;1. prevlen - å‰ä¸€èŠ‚ç‚¹é•¿åº¦&quot;]</span><br><span class="line">            prevlen_desc[&quot;è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦&lt;br/&gt;ç”¨äºä»åå‘å‰éå†&quot;]</span><br><span class="line">            </span><br><span class="line">            prevlen_1byte[&quot;&lt; 254å­—èŠ‚:&lt;br/&gt;ç”¨ 1 å­—èŠ‚å­˜å‚¨&lt;br/&gt;ç›´æ¥å­˜é•¿åº¦å€¼&quot;]</span><br><span class="line">            prevlen_5byte[&quot;&gt;= 254å­—èŠ‚:&lt;br/&gt;ç”¨ 5 å­—èŠ‚å­˜å‚¨&lt;br/&gt;ç¬¬1å­—èŠ‚=0xFE&lt;br/&gt;å4å­—èŠ‚=å®é™…é•¿åº¦&quot;]</span><br><span class="line">            </span><br><span class="line">            prevlen_desc --&gt; prevlen_1byte</span><br><span class="line">            prevlen_desc --&gt; prevlen_5byte</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph encoding [&quot;2. encoding - ç¼–ç ç±»å‹&quot;]</span><br><span class="line">            encoding_desc[&quot;è®°å½• content çš„ç±»å‹å’Œé•¿åº¦&quot;]</span><br><span class="line">            </span><br><span class="line">            subgraph string_enc [&quot;å­—ç¬¦ä¸²ç¼–ç &quot;]</span><br><span class="line">                enc_00[&quot;00pppppp&lt;br/&gt;é•¿åº¦&lt;=63å­—èŠ‚&lt;br/&gt;å6ä½å­˜é•¿åº¦&quot;]</span><br><span class="line">                enc_01[&quot;01pppppp qqqqqqqq&lt;br/&gt;é•¿åº¦&lt;=16383å­—èŠ‚&lt;br/&gt;14ä½å­˜é•¿åº¦&quot;]</span><br><span class="line">                enc_10[&quot;10______ [4å­—èŠ‚]&lt;br/&gt;é•¿åº¦&gt;16383å­—èŠ‚&lt;br/&gt;åç»­4å­—èŠ‚å­˜é•¿åº¦&quot;]</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            subgraph int_enc [&quot;æ•´æ•°ç¼–ç &quot;]</span><br><span class="line">                enc_11_00[&quot;11000000&lt;br/&gt;int16_t&lt;br/&gt;2å­—èŠ‚æ•´æ•°&quot;]</span><br><span class="line">                enc_11_01[&quot;11010000&lt;br/&gt;int32_t&lt;br/&gt;4å­—èŠ‚æ•´æ•°&quot;]</span><br><span class="line">                enc_11_10[&quot;11100000&lt;br/&gt;int64_t&lt;br/&gt;8å­—èŠ‚æ•´æ•°&quot;]</span><br><span class="line">                enc_11_11[&quot;1111xxxx&lt;br/&gt;0-12çš„æ•´æ•°&lt;br/&gt;ç›´æ¥å­˜åœ¨ç¼–ç ä¸­&quot;]</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            encoding_desc --&gt; string_enc</span><br><span class="line">            encoding_desc --&gt; int_enc</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph content [&quot;3. content - å®é™…æ•°æ®&quot;]</span><br><span class="line">            content_desc[&quot;å­˜å‚¨å®é™…çš„æ•°æ®&lt;br/&gt;æ ¹æ® encoding è§£æ&quot;]</span><br><span class="line">            </span><br><span class="line">            content_string[&quot;å­—ç¬¦ä¸²:&lt;br/&gt;åŸå§‹å­—èŠ‚æ•°ç»„&quot;]</span><br><span class="line">            content_int[&quot;æ•´æ•°:&lt;br/&gt;äºŒè¿›åˆ¶æ•´æ•°&quot;]</span><br><span class="line">            </span><br><span class="line">            content_desc --&gt; content_string</span><br><span class="line">            content_desc --&gt; content_int</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph example1 [&quot;ç¤ºä¾‹1: Hash å­˜å‚¨ name=iPhone&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        ex1_field[&quot;Entry (field)&lt;br/&gt;----&lt;br/&gt;prevlen: 0&lt;br/&gt;encoding: 00000100&lt;br/&gt;content: &#x27;name&#x27;&quot;]</span><br><span class="line">        </span><br><span class="line">        ex1_value[&quot;Entry (value)&lt;br/&gt;----&lt;br/&gt;prevlen: 9&lt;br/&gt;encoding: 00000110&lt;br/&gt;content: &#x27;iPhone&#x27;&quot;]</span><br><span class="line">        </span><br><span class="line">        ex1_field --&gt; ex1_value</span><br><span class="line">        </span><br><span class="line">        ex1_note[&quot;è§£é‡Š:&lt;br/&gt;prevlen=0: ç¬¬ä¸€ä¸ªèŠ‚ç‚¹&lt;br/&gt;00000100: å­—ç¬¦ä¸²é•¿åº¦4&lt;br/&gt;prevlen=9: å‰ä¸€èŠ‚ç‚¹9å­—èŠ‚&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph example2 [&quot;ç¤ºä¾‹2: List å­˜å‚¨æ•´æ•° [100, 200, 12]&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        ex2_1[&quot;Entry 1&lt;br/&gt;----&lt;br/&gt;prevlen: 0&lt;br/&gt;encoding: 11000000&lt;br/&gt;content: 100&lt;br/&gt;int16&quot;]</span><br><span class="line">        </span><br><span class="line">        ex2_2[&quot;Entry 2&lt;br/&gt;----&lt;br/&gt;prevlen: 7&lt;br/&gt;encoding: 11000000&lt;br/&gt;content: 200&lt;br/&gt;int16&quot;]</span><br><span class="line">        </span><br><span class="line">        ex2_3[&quot;Entry 3&lt;br/&gt;----&lt;br/&gt;prevlen: 7&lt;br/&gt;encoding: 11111100&lt;br/&gt;æ•´æ•°12ç›´æ¥ç¼–ç &quot;]</span><br><span class="line">        </span><br><span class="line">        ex2_1 --&gt; ex2_2 --&gt; ex2_3</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph cascade [&quot;è¿é”æ›´æ–°é—®é¢˜ Cascade Update&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        cascade_desc[&quot;é—®é¢˜: æ’å…¥/åˆ é™¤èŠ‚ç‚¹å¯¼è‡´åç»­èŠ‚ç‚¹çš„ prevlen å­—æ®µå˜åŒ–&quot;]</span><br><span class="line">        </span><br><span class="line">        before[&quot;æ›´æ–°å‰:&lt;br/&gt;[253B] [253B] [253B]&lt;br/&gt;æ¯ä¸ª prevlen å  1 å­—èŠ‚&quot;]</span><br><span class="line">        </span><br><span class="line">        after[&quot;æ’å…¥å¤§èŠ‚ç‚¹å:&lt;br/&gt;[253B] [260B] [?B] [?B]&lt;br/&gt;åç»­èŠ‚ç‚¹ prevlen éœ€æ‰©å±•ä¸º 5 å­—èŠ‚&quot;]</span><br><span class="line">        </span><br><span class="line">        impact[&quot;å½±å“:&lt;br/&gt;æœ€åæƒ…å†µ: O(nÂ²) æ—¶é—´å¤æ‚åº¦&lt;br/&gt;éœ€è¦è¿ç»­é‡æ–°åˆ†é…å†…å­˜&lt;br/&gt;å®é™…ä¸­å¾ˆå°‘å‘ç”Ÿ&quot;]</span><br><span class="line">        </span><br><span class="line">        cascade_desc --&gt; before --&gt; after --&gt; impact</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph traverse [&quot;éå†æ–¹å¼&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        forward[&quot;æ­£å‘éå†:&lt;br/&gt;zllen è·å–é•¿åº¦&lt;br/&gt;ä»ç¬¬ä¸€ä¸ª entry å¼€å§‹&lt;br/&gt;æ ¹æ® encoding è®¡ç®—èŠ‚ç‚¹å¤§å°&lt;br/&gt;è·³åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹&quot;]</span><br><span class="line">        </span><br><span class="line">        backward[&quot;åå‘éå†:&lt;br/&gt;zltail ç›´æ¥å®šä½å°¾èŠ‚ç‚¹&lt;br/&gt;æ ¹æ® prevlen è·³åˆ°å‰ä¸€èŠ‚ç‚¹&lt;br/&gt;å®ç°åŒå‘éå†èƒ½åŠ›&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph memory [&quot;å†…å­˜ä¼˜åŒ–ç‰¹ç‚¹&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        opt1[&quot;âœ… è¿ç»­å†…å­˜åˆ†é…&lt;br/&gt;CPUç¼“å­˜å‹å¥½&quot;]</span><br><span class="line">        opt2[&quot;âœ… æ— æŒ‡é’ˆå¼€é”€&lt;br/&gt;èŠ‚çœå†…å­˜&quot;]</span><br><span class="line">        opt3[&quot;âœ… å˜é•¿ç¼–ç &lt;br/&gt;å°æ•°æ®å‹ç¼©å­˜å‚¨&quot;]</span><br><span class="line">        opt4[&quot;âŒ æ’å…¥/åˆ é™¤éœ€å†…å­˜é‡åˆ†é…&lt;br/&gt;å¯èƒ½è§¦å‘è¿é”æ›´æ–°&quot;]</span><br><span class="line">        opt5[&quot;âŒ æŸ¥æ‰¾æ˜¯ O(n)&lt;br/&gt;ä¸é€‚åˆå¤§é‡æ•°æ®&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    classDef headerStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px</span><br><span class="line">    classDef entryStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px</span><br><span class="line">    classDef exampleStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px</span><br><span class="line">    classDef warnStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px</span><br><span class="line">    </span><br><span class="line">    class zlbytes,zltail,zllen,zlend headerStyle</span><br><span class="line">    class prevlen_1byte,prevlen_5byte,enc_00,enc_01,enc_10,enc_11_00,enc_11_01,enc_11_10,enc_11_11 entryStyle</span><br><span class="line">    class ex1_field,ex1_value,ex2_1,ex2_2,ex2_3 exampleStyle</span><br><span class="line">    class cascade_desc,before,after,impact,opt4,opt5 warnStyle</span><br></pre></td></tr></table></figure>

<h2 id="2-å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹"><a href="#2-å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹" class="headerlink" title="2. å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹"></a>2. å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph memory_layout [&quot;ziplist å†…å­˜å¸ƒå±€å®ä¾‹ - Hashå­˜å‚¨ &#123;name:iPhone, price:5999&#125;&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph header [&quot;å¤´éƒ¨ä¿¡æ¯ 10å­—èŠ‚&quot;]</span><br><span class="line">            byte0_3[&quot;å­—èŠ‚ 0-3: zlbytes&lt;br/&gt;0x00 0x00 0x00 0x3F&lt;br/&gt;æ€»å¤§å° = 63å­—èŠ‚&quot;]</span><br><span class="line">            byte4_7[&quot;å­—èŠ‚ 4-7: zltail&lt;br/&gt;0x00 0x00 0x00 0x35&lt;br/&gt;å°¾èŠ‚ç‚¹åç§» = 53&quot;]</span><br><span class="line">            byte8_9[&quot;å­—èŠ‚ 8-9: zllen&lt;br/&gt;0x00 0x04&lt;br/&gt;èŠ‚ç‚¹æ•° = 4ä¸ª&lt;br/&gt;2 field + 2 value&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph entry1 [&quot;Entry 1: field &#x27;name&#x27; - 9å­—èŠ‚&quot;]</span><br><span class="line">            e1_prevlen[&quot;prevlen: 0x00&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹é•¿åº¦=0&lt;br/&gt;æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹&quot;]</span><br><span class="line">            e1_encoding[&quot;encoding: 0x04&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;00000100&lt;br/&gt;å­—ç¬¦ä¸²é•¿åº¦=4&quot;]</span><br><span class="line">            e1_content[&quot;content: &#x27;name&#x27;&lt;br/&gt;4å­—èŠ‚&lt;br/&gt;0x6E 0x61 0x6D 0x65&quot;]</span><br><span class="line">            </span><br><span class="line">            e1_prevlen --&gt; e1_encoding --&gt; e1_content</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph entry2 [&quot;Entry 2: value &#x27;iPhone&#x27; - 11å­—èŠ‚&quot;]</span><br><span class="line">            e2_prevlen[&quot;prevlen: 0x09&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹é•¿åº¦=9&quot;]</span><br><span class="line">            e2_encoding[&quot;encoding: 0x06&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;00000110&lt;br/&gt;å­—ç¬¦ä¸²é•¿åº¦=6&quot;]</span><br><span class="line">            e2_content[&quot;content: &#x27;iPhone&#x27;&lt;br/&gt;6å­—èŠ‚&lt;br/&gt;0x69 0x50 0x68...&quot;]</span><br><span class="line">            </span><br><span class="line">            e2_prevlen --&gt; e2_encoding --&gt; e2_content</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph entry3 [&quot;Entry 3: field &#x27;price&#x27; - 10å­—èŠ‚&quot;]</span><br><span class="line">            e3_prevlen[&quot;prevlen: 0x0B&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹é•¿åº¦=11&quot;]</span><br><span class="line">            e3_encoding[&quot;encoding: 0x05&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;00000101&lt;br/&gt;å­—ç¬¦ä¸²é•¿åº¦=5&quot;]</span><br><span class="line">            e3_content[&quot;content: &#x27;price&#x27;&lt;br/&gt;5å­—èŠ‚&lt;br/&gt;0x70 0x72 0x69...&quot;]</span><br><span class="line">            </span><br><span class="line">            e3_prevlen --&gt; e3_encoding --&gt; e3_content</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph entry4 [&quot;Entry 4: value 5999 - 7å­—èŠ‚&quot;]</span><br><span class="line">            e4_prevlen[&quot;prevlen: 0x0A&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹é•¿åº¦=10&quot;]</span><br><span class="line">            e4_encoding[&quot;encoding: 0xC0&lt;br/&gt;1å­—èŠ‚&lt;br/&gt;11000000&lt;br/&gt;int16_t æ•´æ•°&quot;]</span><br><span class="line">            e4_content[&quot;content: 5999&lt;br/&gt;2å­—èŠ‚&lt;br/&gt;0x17 0x6F&lt;br/&gt;æ•´æ•°å­˜å‚¨&quot;]</span><br><span class="line">            </span><br><span class="line">            e4_prevlen --&gt; e4_encoding --&gt; e4_content</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph tail [&quot;å°¾éƒ¨æ ‡è®° 1å­—èŠ‚&quot;]</span><br><span class="line">            zlend_byte[&quot;å­—èŠ‚ 62: zlend&lt;br/&gt;0xFF&lt;br/&gt;ç»“æŸæ ‡è®°&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        header --&gt; entry1 --&gt; entry2 --&gt; entry3 --&gt; entry4 --&gt; tail</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph calculation [&quot;å†…å­˜è®¡ç®—&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        calc_header[&quot;å¤´éƒ¨: 10å­—èŠ‚&lt;br/&gt;4+4+2&quot;]</span><br><span class="line">        calc_entry1[&quot;Entry1: 9å­—èŠ‚&lt;br/&gt;1+1+4+3&quot;]</span><br><span class="line">        calc_entry2[&quot;Entry2: 11å­—èŠ‚&lt;br/&gt;1+1+6+3&quot;]</span><br><span class="line">        calc_entry3[&quot;Entry3: 10å­—èŠ‚&lt;br/&gt;1+1+5+3&quot;]</span><br><span class="line">        calc_entry4[&quot;Entry4: 7å­—èŠ‚&lt;br/&gt;1+1+2+3&quot;]</span><br><span class="line">        calc_tail[&quot;å°¾éƒ¨: 1å­—èŠ‚&quot;]</span><br><span class="line">        calc_total[&quot;æ€»è®¡: 48å­—èŠ‚&quot;]</span><br><span class="line">        </span><br><span class="line">        calc_header --&gt; calc_entry1 --&gt; calc_entry2 --&gt; calc_entry3 --&gt; calc_entry4 --&gt; calc_tail --&gt; calc_total</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph encoding_detail [&quot;ç¼–ç ç±»å‹è¯¦è§£&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph str_encoding [&quot;å­—ç¬¦ä¸²ç¼–ç  - æ ¹æ®é•¿åº¦é€‰æ‹©&quot;]</span><br><span class="line">            str1[&quot;00pppppp&lt;br/&gt;1å­—èŠ‚header&lt;br/&gt;é•¿åº¦ 0-63&quot;]</span><br><span class="line">            str2[&quot;01pppppp qqqqqqqq&lt;br/&gt;2å­—èŠ‚header&lt;br/&gt;é•¿åº¦ 64-16383&quot;]</span><br><span class="line">            str3[&quot;10000000 [4å­—èŠ‚é•¿åº¦]&lt;br/&gt;5å­—èŠ‚header&lt;br/&gt;é•¿åº¦ &gt; 16383&quot;]</span><br><span class="line">            </span><br><span class="line">            str_example[&quot;ä¾‹: &#x27;iPhone&#x27; é•¿åº¦=6&lt;br/&gt;encoding = 00000110&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph int_encoding [&quot;æ•´æ•°ç¼–ç  - æ ¹æ®èŒƒå›´ä¼˜åŒ–&quot;]</span><br><span class="line">            int1[&quot;11000000 [2å­—èŠ‚]&lt;br/&gt;int16: -32768~32767&quot;]</span><br><span class="line">            int2[&quot;11010000 [4å­—èŠ‚]&lt;br/&gt;int32: -2^31~2^31-1&quot;]</span><br><span class="line">            int3[&quot;11100000 [8å­—èŠ‚]&lt;br/&gt;int64: å¤§æ•´æ•°&quot;]</span><br><span class="line">            int4[&quot;11110000&lt;br/&gt;24ä½æ•´æ•°&quot;]</span><br><span class="line">            int5[&quot;11111110&lt;br/&gt;8ä½æ•´æ•°&quot;]</span><br><span class="line">            int6[&quot;1111xxxx&lt;br/&gt;0-12 ç›´æ¥ç¼–ç &lt;br/&gt;æ— éœ€contentå­—æ®µ&quot;]</span><br><span class="line">            </span><br><span class="line">            int_example[&quot;ä¾‹: 5999&lt;br/&gt;encoding = 11000000&lt;br/&gt;content = 0x17 0x6F&quot;]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph advantages [&quot;ziplist çš„ä¼˜åŠ¿&quot;]</span><br><span class="line">        adv1[&quot;ğŸ’¾ å†…å­˜é«˜æ•ˆ&lt;br/&gt;æ— æŒ‡é’ˆå¼€é”€&lt;br/&gt;ç´§å‡‘å­˜å‚¨&quot;]</span><br><span class="line">        adv2[&quot;ğŸš€ ç¼“å­˜å‹å¥½&lt;br/&gt;è¿ç»­å†…å­˜&lt;br/&gt;é¢„è¯»ä¼˜åŒ–&quot;]</span><br><span class="line">        adv3[&quot;ğŸ”¢ æ™ºèƒ½ç¼–ç &lt;br/&gt;æ•´æ•°å‹ç¼©&lt;br/&gt;å˜é•¿å­˜å‚¨&quot;]</span><br><span class="line">        adv4[&quot;â†”ï¸ åŒå‘éå†&lt;br/&gt;æ”¯æŒä»å¤´åˆ°å°¾&lt;br/&gt;æ”¯æŒä»å°¾åˆ°å¤´&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph limitations [&quot;ziplist çš„é™åˆ¶&quot;]</span><br><span class="line">        lim1[&quot;âš ï¸ O(n) æŸ¥æ‰¾&lt;br/&gt;ä¸é€‚åˆå¤§æ•°æ®&quot;]</span><br><span class="line">        lim2[&quot;âš ï¸ è¿é”æ›´æ–°&lt;br/&gt;æœ€å O(nÂ²)&quot;]</span><br><span class="line">        lim3[&quot;âš ï¸ å†…å­˜é‡åˆ†é…&lt;br/&gt;æ’å…¥åˆ é™¤å¼€é”€å¤§&quot;]</span><br><span class="line">        lim4[&quot;ğŸ“Š é»˜è®¤é˜ˆå€¼&lt;br/&gt;Hash: 512 entries&lt;br/&gt;List: 512 entries&lt;br/&gt;ZSet: 128 entries&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    classDef headerStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px</span><br><span class="line">    classDef entryStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px</span><br><span class="line">    classDef advStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px</span><br><span class="line">    classDef warnStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px</span><br><span class="line">    </span><br><span class="line">    class byte0_3,byte4_7,byte8_9,zlend_byte headerStyle</span><br><span class="line">    class e1_prevlen,e1_encoding,e1_content,e2_prevlen,e2_encoding,e2_content,e3_prevlen,e3_encoding,e3_content,e4_prevlen,e4_encoding,e4_content entryStyle</span><br><span class="line">    class adv1,adv2,adv3,adv4 advStyle</span><br><span class="line">    class lim1,lim2,lim3,lim4 warnStyle</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®è¦ç‚¹æ€»ç»“"><a href="#å…³é”®è¦ç‚¹æ€»ç»“" class="headerlink" title="å…³é”®è¦ç‚¹æ€»ç»“"></a>å…³é”®è¦ç‚¹æ€»ç»“</h2><h3 id="Ziplist-çš„ä¸‰å±‚ç»“æ„"><a href="#Ziplist-çš„ä¸‰å±‚ç»“æ„" class="headerlink" title="Ziplist çš„ä¸‰å±‚ç»“æ„"></a>Ziplist çš„ä¸‰å±‚ç»“æ„</h3><ol>
<li><strong>æ•´ä½“ç»“æ„</strong>ï¼šzlbytes + zltail + zllen + entries + zlend</li>
<li><strong>èŠ‚ç‚¹ç»“æ„</strong>ï¼šprevlen + encoding + content</li>
<li><strong>å˜é•¿ç¼–ç </strong>ï¼šå­—ç¬¦ä¸²ï¼ˆ3ç§ï¼‰+ æ•´æ•°ï¼ˆ6ç§ï¼‰</li>
</ol>
<h3 id="å†…å­˜ä¼˜åŒ–æŠ€å·§"><a href="#å†…å­˜ä¼˜åŒ–æŠ€å·§" class="headerlink" title="å†…å­˜ä¼˜åŒ–æŠ€å·§"></a>å†…å­˜ä¼˜åŒ–æŠ€å·§</h3><ul>
<li><strong>æ— æŒ‡é’ˆå¼€é”€</strong>ï¼šå¯¹æ¯”é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹çœ 16 å­—èŠ‚</li>
<li><strong>æ•´æ•°å‹ç¼©</strong>ï¼š0-12 ç›´æ¥ç¼–ç ï¼Œæ— éœ€ content å­—æ®µ</li>
<li><strong>å˜é•¿ prevlen</strong>ï¼šå°èŠ‚ç‚¹ 1 å­—èŠ‚ï¼Œå¤§èŠ‚ç‚¹ 5 å­—èŠ‚</li>
</ul>
<h3 id="æ€§èƒ½ç‰¹ç‚¹"><a href="#æ€§èƒ½ç‰¹ç‚¹" class="headerlink" title="æ€§èƒ½ç‰¹ç‚¹"></a>æ€§èƒ½ç‰¹ç‚¹</h3><ul>
<li>âœ… å°æ•°æ®é‡ï¼ˆ&lt; 512ï¼‰æ€§èƒ½ä¼˜ç§€</li>
<li>âœ… å†…å­˜å ç”¨æä½</li>
<li>âŒ O(n) æŸ¥æ‰¾ï¼Œä¸é€‚åˆå¤§æ•°æ®</li>
<li>âŒ è¿é”æ›´æ–°é£é™©ï¼ˆå®é™…å¾ˆå°‘ï¼‰</li>
</ul>
<h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><ul>
<li>Hash å°å¯¹è±¡ï¼ˆå•†å“è¯¦æƒ…ã€Sessionï¼‰</li>
<li>List æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ&lt; 512 æ¶ˆæ¯ï¼‰</li>
<li>ZSet å°å‹æ’è¡Œæ¦œï¼ˆ&lt; 128 æˆå‘˜ï¼‰</li>
</ul>
