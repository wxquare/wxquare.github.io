graph TB
    subgraph memory_layout ["ziplist å†…å­˜å¸ƒå±€å®ä¾‹ - Hashå­˜å‚¨ {name:iPhone, price:5999}"]
        direction TB
        
        subgraph header ["å¤´éƒ¨ä¿¡æ¯ 10å­—èŠ‚"]
            byte0_3["å­—èŠ‚ 0-3: zlbytes<br/>0x00 0x00 0x00 0x3F<br/>æ€»å¤§å° = 63å­—èŠ‚"]
            byte4_7["å­—èŠ‚ 4-7: zltail<br/>0x00 0x00 0x00 0x35<br/>å°¾èŠ‚ç‚¹åç§» = 53"]
            byte8_9["å­—èŠ‚ 8-9: zllen<br/>0x00 0x04<br/>èŠ‚ç‚¹æ•° = 4ä¸ª<br/>2 field + 2 value"]
        end
        
        subgraph entry1 ["Entry 1: field 'name' - 9å­—èŠ‚"]
            e1_prevlen["prevlen: 0x00<br/>1å­—èŠ‚<br/>å‰ä¸€èŠ‚ç‚¹é•¿åº¦=0<br/>æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹"]
            e1_encoding["encoding: 0x04<br/>1å­—èŠ‚<br/>00000100<br/>å­—ç¬¦ä¸²é•¿åº¦=4"]
            e1_content["content: 'name'<br/>4å­—èŠ‚<br/>0x6E 0x61 0x6D 0x65"]
            
            e1_prevlen --> e1_encoding --> e1_content
        end
        
        subgraph entry2 ["Entry 2: value 'iPhone' - 11å­—èŠ‚"]
            e2_prevlen["prevlen: 0x09<br/>1å­—èŠ‚<br/>å‰ä¸€èŠ‚ç‚¹é•¿åº¦=9"]
            e2_encoding["encoding: 0x06<br/>1å­—èŠ‚<br/>00000110<br/>å­—ç¬¦ä¸²é•¿åº¦=6"]
            e2_content["content: 'iPhone'<br/>6å­—èŠ‚<br/>0x69 0x50 0x68..."]
            
            e2_prevlen --> e2_encoding --> e2_content
        end
        
        subgraph entry3 ["Entry 3: field 'price' - 10å­—èŠ‚"]
            e3_prevlen["prevlen: 0x0B<br/>1å­—èŠ‚<br/>å‰ä¸€èŠ‚ç‚¹é•¿åº¦=11"]
            e3_encoding["encoding: 0x05<br/>1å­—èŠ‚<br/>00000101<br/>å­—ç¬¦ä¸²é•¿åº¦=5"]
            e3_content["content: 'price'<br/>5å­—èŠ‚<br/>0x70 0x72 0x69..."]
            
            e3_prevlen --> e3_encoding --> e3_content
        end
        
        subgraph entry4 ["Entry 4: value 5999 - 7å­—èŠ‚"]
            e4_prevlen["prevlen: 0x0A<br/>1å­—èŠ‚<br/>å‰ä¸€èŠ‚ç‚¹é•¿åº¦=10"]
            e4_encoding["encoding: 0xC0<br/>1å­—èŠ‚<br/>11000000<br/>int16_t æ•´æ•°"]
            e4_content["content: 5999<br/>2å­—èŠ‚<br/>0x17 0x6F<br/>æ•´æ•°å­˜å‚¨"]
            
            e4_prevlen --> e4_encoding --> e4_content
        end
        
        subgraph tail ["å°¾éƒ¨æ ‡è®° 1å­—èŠ‚"]
            zlend_byte["å­—èŠ‚ 62: zlend<br/>0xFF<br/>ç»“æŸæ ‡è®°"]
        end
        
        header --> entry1 --> entry2 --> entry3 --> entry4 --> tail
    end
    
    subgraph calculation ["å†…å­˜è®¡ç®—"]
        direction LR
        
        calc_header["å¤´éƒ¨: 10å­—èŠ‚<br/>4+4+2"]
        calc_entry1["Entry1: 9å­—èŠ‚<br/>1+1+4+3"]
        calc_entry2["Entry2: 11å­—èŠ‚<br/>1+1+6+3"]
        calc_entry3["Entry3: 10å­—èŠ‚<br/>1+1+5+3"]
        calc_entry4["Entry4: 7å­—èŠ‚<br/>1+1+2+3"]
        calc_tail["å°¾éƒ¨: 1å­—èŠ‚"]
        calc_total["æ€»è®¡: 48å­—èŠ‚"]
        
        calc_header --> calc_entry1 --> calc_entry2 --> calc_entry3 --> calc_entry4 --> calc_tail --> calc_total
    end
    
    subgraph encoding_detail ["ç¼–ç ç±»å‹è¯¦è§£"]
        direction TB
        
        subgraph str_encoding ["å­—ç¬¦ä¸²ç¼–ç  - æ ¹æ®é•¿åº¦é€‰æ‹©"]
            str1["00pppppp<br/>1å­—èŠ‚header<br/>é•¿åº¦ 0-63"]
            str2["01pppppp qqqqqqqq<br/>2å­—èŠ‚header<br/>é•¿åº¦ 64-16383"]
            str3["10000000 [4å­—èŠ‚é•¿åº¦]<br/>5å­—èŠ‚header<br/>é•¿åº¦ > 16383"]
            
            str_example["ä¾‹: 'iPhone' é•¿åº¦=6<br/>encoding = 00000110"]
        end
        
        subgraph int_encoding ["æ•´æ•°ç¼–ç  - æ ¹æ®èŒƒå›´ä¼˜åŒ–"]
            int1["11000000 [2å­—èŠ‚]<br/>int16: -32768~32767"]
            int2["11010000 [4å­—èŠ‚]<br/>int32: -2^31~2^31-1"]
            int3["11100000 [8å­—èŠ‚]<br/>int64: å¤§æ•´æ•°"]
            int4["11110000<br/>24ä½æ•´æ•°"]
            int5["11111110<br/>8ä½æ•´æ•°"]
            int6["1111xxxx<br/>0-12 ç›´æ¥ç¼–ç <br/>æ— éœ€contentå­—æ®µ"]
            
            int_example["ä¾‹: 5999<br/>encoding = 11000000<br/>content = 0x17 0x6F"]
        end
    end
    
    subgraph advantages ["ziplist çš„ä¼˜åŠ¿"]
        adv1["ğŸ’¾ å†…å­˜é«˜æ•ˆ<br/>æ— æŒ‡é’ˆå¼€é”€<br/>ç´§å‡‘å­˜å‚¨"]
        adv2["ğŸš€ ç¼“å­˜å‹å¥½<br/>è¿ç»­å†…å­˜<br/>é¢„è¯»ä¼˜åŒ–"]
        adv3["ğŸ”¢ æ™ºèƒ½ç¼–ç <br/>æ•´æ•°å‹ç¼©<br/>å˜é•¿å­˜å‚¨"]
        adv4["â†”ï¸ åŒå‘éå†<br/>æ”¯æŒä»å¤´åˆ°å°¾<br/>æ”¯æŒä»å°¾åˆ°å¤´"]
    end
    
    subgraph limitations ["ziplist çš„é™åˆ¶"]
        lim1["âš ï¸ O(n) æŸ¥æ‰¾<br/>ä¸é€‚åˆå¤§æ•°æ®"]
        lim2["âš ï¸ è¿é”æ›´æ–°<br/>æœ€å O(nÂ²)"]
        lim3["âš ï¸ å†…å­˜é‡åˆ†é…<br/>æ’å…¥åˆ é™¤å¼€é”€å¤§"]
        lim4["ğŸ“Š é»˜è®¤é˜ˆå€¼<br/>Hash: 512 entries<br/>List: 512 entries<br/>ZSet: 128 entries"]
    end
    
    classDef headerStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef entryStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef advStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef warnStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    
    class byte0_3,byte4_7,byte8_9,zlend_byte headerStyle
    class e1_prevlen,e1_encoding,e1_content,e2_prevlen,e2_encoding,e2_content,e3_prevlen,e3_encoding,e3_content,e4_prevlen,e4_encoding,e4_content entryStyle
    class adv1,adv2,adv3,adv4 advStyle
    class lim1,lim2,lim3,lim4 warnStyle

