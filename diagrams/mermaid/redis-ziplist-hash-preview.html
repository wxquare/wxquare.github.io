<h1 id="Redis-Ziplist-å®æˆ˜ï¼šHash-name-â€œiPhoneâ€-price-5999"><a href="#Redis-Ziplist-å®æˆ˜ï¼šHash-name-â€œiPhoneâ€-price-5999" class="headerlink" title="Redis Ziplist å®æˆ˜ï¼šHash {name: â€œiPhoneâ€, price: 5999}"></a>Redis Ziplist å®æˆ˜ï¼šHash {name: â€œiPhoneâ€, price: 5999}</h1><h2 id="å®Œæ•´å†…å­˜å¸ƒå±€å¯è§†åŒ–"><a href="#å®Œæ•´å†…å­˜å¸ƒå±€å¯è§†åŒ–" class="headerlink" title="å®Œæ•´å†…å­˜å¸ƒå±€å¯è§†åŒ–"></a>å®Œæ•´å†…å­˜å¸ƒå±€å¯è§†åŒ–</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">    subgraph overview [&quot;Hash &#123;name: iPhone, price: 5999&#125; çš„ ziplist å†…å­˜å¸ƒå±€&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph header [&quot;å¤´éƒ¨ 10 å­—èŠ‚&quot;]</span><br><span class="line">            h1[&quot;zlbytes&lt;br/&gt;0x0000002C&lt;br/&gt;44å­—èŠ‚&quot;]</span><br><span class="line">            h2[&quot;zltail&lt;br/&gt;0x00000023&lt;br/&gt;å°¾èŠ‚ç‚¹@35&quot;]</span><br><span class="line">            h3[&quot;zllen&lt;br/&gt;0x0004&lt;br/&gt;4ä¸ªèŠ‚ç‚¹&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph entries [&quot;æ•°æ®åŒºåŸŸ 25 å­—èŠ‚ - field/value äº¤æ›¿å­˜å‚¨&quot;]</span><br><span class="line">            direction TB</span><br><span class="line">            </span><br><span class="line">            subgraph e1 [&quot;Entry 1: field name - 6å­—èŠ‚&quot;]</span><br><span class="line">                e1_p[&quot;prevlen: 0x00&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹ 0B&quot;]</span><br><span class="line">                e1_e[&quot;encoding: 0x04&lt;br/&gt;00000100&lt;br/&gt;å­—ç¬¦ä¸²é•¿åº¦4&quot;]</span><br><span class="line">                e1_c[&quot;content: name&lt;br/&gt;0x6E616D65&quot;]</span><br><span class="line">                </span><br><span class="line">                e1_p --&gt; e1_e --&gt; e1_c</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            subgraph e2 [&quot;Entry 2: value iPhone - 8å­—èŠ‚&quot;]</span><br><span class="line">                e2_p[&quot;prevlen: 0x06&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹ 6B&quot;]</span><br><span class="line">                e2_e[&quot;encoding: 0x06&lt;br/&gt;00000110&lt;br/&gt;å­—ç¬¦ä¸²é•¿åº¦6&quot;]</span><br><span class="line">                e2_c[&quot;content: iPhone&lt;br/&gt;0x69506F6E65&quot;]</span><br><span class="line">                </span><br><span class="line">                e2_p --&gt; e2_e --&gt; e2_c</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            subgraph e3 [&quot;Entry 3: field price - 7å­—èŠ‚&quot;]</span><br><span class="line">                e3_p[&quot;prevlen: 0x08&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹ 8B&quot;]</span><br><span class="line">                e3_e[&quot;encoding: 0x05&lt;br/&gt;00000101&lt;br/&gt;å­—ç¬¦ä¸²é•¿åº¦5&quot;]</span><br><span class="line">                e3_c[&quot;content: price&lt;br/&gt;0x7072696365&quot;]</span><br><span class="line">                </span><br><span class="line">                e3_p --&gt; e3_e --&gt; e3_c</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            subgraph e4 [&quot;Entry 4: value 5999 - 4å­—èŠ‚ â­æ•´æ•°ä¼˜åŒ–&quot;]</span><br><span class="line">                e4_p[&quot;prevlen: 0x07&lt;br/&gt;å‰ä¸€èŠ‚ç‚¹ 7B&quot;]</span><br><span class="line">                e4_e[&quot;encoding: 0xC0&lt;br/&gt;11000000&lt;br/&gt;int16_t&quot;]</span><br><span class="line">                e4_c[&quot;content: 5999&lt;br/&gt;0x176F å°ç«¯åº&lt;br/&gt;èŠ‚çœ2å­—èŠ‚!&quot;]</span><br><span class="line">                </span><br><span class="line">                e4_p --&gt; e4_e --&gt; e4_c</span><br><span class="line">            end</span><br><span class="line">            </span><br><span class="line">            e1 -.-&gt;|prevlen| e2</span><br><span class="line">            e2 -.-&gt;|prevlen| e3</span><br><span class="line">            e3 -.-&gt;|prevlen| e4</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph tail [&quot;å°¾éƒ¨ 1 å­—èŠ‚&quot;]</span><br><span class="line">            zlend[&quot;zlend: 0xFF&lt;br/&gt;ç»“æŸæ ‡è®°&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        header --&gt; entries --&gt; tail</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph memory_map [&quot;å®Œæ•´å†…å­˜æ˜ å°„å›¾&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        m0[&quot;[0-3]&lt;br/&gt;zlbytes&lt;br/&gt;4B&quot;]</span><br><span class="line">        m1[&quot;[4-7]&lt;br/&gt;zltail&lt;br/&gt;4B&quot;]</span><br><span class="line">        m2[&quot;[8-9]&lt;br/&gt;zllen&lt;br/&gt;2B&quot;]</span><br><span class="line">        m3[&quot;[10-15]&lt;br/&gt;name&lt;br/&gt;6B&quot;]</span><br><span class="line">        m4[&quot;[16-23]&lt;br/&gt;iPhone&lt;br/&gt;8B&quot;]</span><br><span class="line">        m5[&quot;[24-30]&lt;br/&gt;price&lt;br/&gt;7B&quot;]</span><br><span class="line">        m6[&quot;[31-34]&lt;br/&gt;5999&lt;br/&gt;4B&quot;]</span><br><span class="line">        m7[&quot;[35]&lt;br/&gt;0xFF&lt;br/&gt;1B&quot;]</span><br><span class="line">        </span><br><span class="line">        m0 ~~~ m1 ~~~ m2 ~~~ m3 ~~~ m4 ~~~ m5 ~~~ m6 ~~~ m7</span><br><span class="line">        </span><br><span class="line">        total[&quot;æ€»è®¡: 36 å­—èŠ‚&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph encoding_types [&quot;ç¼–ç ç±»å‹è§£æ&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph str_enc [&quot;å­—ç¬¦ä¸²ç¼–ç  - Entry 1/2/3&quot;]</span><br><span class="line">            s1[&quot;00000100 = é•¿åº¦4&lt;br/&gt;name&quot;]</span><br><span class="line">            s2[&quot;00000110 = é•¿åº¦6&lt;br/&gt;iPhone&quot;]</span><br><span class="line">            s3[&quot;00000101 = é•¿åº¦5&lt;br/&gt;price&quot;]</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph int_enc [&quot;æ•´æ•°ç¼–ç  - Entry 4 â­&quot;]</span><br><span class="line">            i1[&quot;11000000 = int16&lt;br/&gt;5999 ç”¨ 2 å­—èŠ‚&quot;]</span><br><span class="line">            i2[&quot;å¦‚æœæ˜¯å­—ç¬¦ä¸²:&lt;br/&gt;éœ€è¦ 4+2=6 å­—èŠ‚&lt;br/&gt;èŠ‚çœ 2 å­—èŠ‚!&quot;]</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph comparison [&quot;å†…å­˜å¯¹æ¯”åˆ†æ&quot;]</span><br><span class="line">        direction LR</span><br><span class="line">        </span><br><span class="line">        subgraph zl [&quot;ziplist æ–¹æ¡ˆ&quot;]</span><br><span class="line">            zl1[&quot;å¤´éƒ¨: 10B&quot;]</span><br><span class="line">            zl2[&quot;name: 6B&lt;br/&gt;iPhone: 8B&lt;br/&gt;price: 7B&lt;br/&gt;5999: 4B&quot;]</span><br><span class="line">            zl3[&quot;å°¾éƒ¨: 1B&quot;]</span><br><span class="line">            zl_total[&quot;æ€»è®¡: 36B&quot;]</span><br><span class="line">            </span><br><span class="line">            zl1 --&gt; zl2 --&gt; zl3 --&gt; zl_total</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph ht [&quot;hashtable æ–¹æ¡ˆ&quot;]</span><br><span class="line">            ht1[&quot;dictht: 24B&lt;br/&gt;table[8]: 64B&quot;]</span><br><span class="line">            ht2[&quot;4ä¸ªdictEntry&lt;br/&gt;æ¯ä¸ª24B = 96B&quot;]</span><br><span class="line">            ht3[&quot;å­—ç¬¦ä¸²SDS&lt;br/&gt;çº¦30B&quot;]</span><br><span class="line">            ht_total[&quot;æ€»è®¡: ~214B&lt;br/&gt;âŒ 5.9å€&quot;]</span><br><span class="line">            </span><br><span class="line">            ht1 --&gt; ht2 --&gt; ht3 --&gt; ht_total</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph json [&quot;String JSON æ–¹æ¡ˆ&quot;]</span><br><span class="line">            json1[&quot;JSONå­—ç¬¦ä¸²&lt;br/&gt;32B&quot;]</span><br><span class="line">            json2[&quot;Rediså¼€é”€&lt;br/&gt;~18B&quot;]</span><br><span class="line">            json_total[&quot;æ€»è®¡: ~50B&lt;br/&gt;âŒ 1.4å€&quot;]</span><br><span class="line">            </span><br><span class="line">            json1 --&gt; json2 --&gt; json_total</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph operations [&quot;æ“ä½œæ¼”ç¤º&quot;]</span><br><span class="line">        direction TB</span><br><span class="line">        </span><br><span class="line">        subgraph op_get [&quot;HGET product:1001 name&quot;]</span><br><span class="line">            get1[&quot;1. ä»åç§»10å¼€å§‹&quot;]</span><br><span class="line">            get2[&quot;2. è¯»å– prevlen+encoding&quot;]</span><br><span class="line">            get3[&quot;3. å¯¹æ¯” content = name?&quot;]</span><br><span class="line">            get4[&quot;4. æ˜¯! è¯»å–ä¸‹ä¸€ä¸ªentry&quot;]</span><br><span class="line">            get5[&quot;5. è¿”å› iPhone&quot;]</span><br><span class="line">            get6[&quot;æ—¶é—´å¤æ‚åº¦: O(n)&lt;br/&gt;éœ€éå†&quot;]</span><br><span class="line">            </span><br><span class="line">            get1 --&gt; get2 --&gt; get3 --&gt; get4 --&gt; get5 --&gt; get6</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph op_incr [&quot;HINCRBY product:1001 price 1&quot;]</span><br><span class="line">            incr1[&quot;1. æ‰¾åˆ° price â†’ 5999&quot;]</span><br><span class="line">            incr2[&quot;2. è§£æ int16: 5999&quot;]</span><br><span class="line">            incr3[&quot;3. åŠ 1 â†’ 6000&quot;]</span><br><span class="line">            incr4[&quot;4. ä»åœ¨ int16 èŒƒå›´&quot;]</span><br><span class="line">            incr5[&quot;5. åŸåœ°æ›´æ–° 0x7017&quot;]</span><br><span class="line">            incr6[&quot;æ— éœ€ realloc!&lt;br/&gt;é«˜æ•ˆ!&quot;]</span><br><span class="line">            </span><br><span class="line">            incr1 --&gt; incr2 --&gt; incr3 --&gt; incr4 --&gt; incr5 --&gt; incr6</span><br><span class="line">        end</span><br><span class="line">        </span><br><span class="line">        subgraph op_set [&quot;HSET product:1001 stock 100&quot;]</span><br><span class="line">            set1[&quot;1. æ£€æŸ¥ zllen &lt; 512&quot;]</span><br><span class="line">            set2[&quot;2. realloc æ‰©å±•å†…å­˜&quot;]</span><br><span class="line">            set3[&quot;3. å†™å…¥ stock field&quot;]</span><br><span class="line">            set4[&quot;4. å†™å…¥ 100 æ•´æ•°&quot;]</span><br><span class="line">            set5[&quot;5. æ›´æ–° zlbytesç­‰&quot;]</span><br><span class="line">            set6[&quot;å¯èƒ½è§¦å‘è¿é”æ›´æ–°&lt;br/&gt;æ¦‚ç‡ä½&quot;]</span><br><span class="line">            </span><br><span class="line">            set1 --&gt; set2 --&gt; set3 --&gt; set4 --&gt; set5 --&gt; set6</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph advantages [&quot;ziplist ä¼˜åŠ¿åˆ†æ&quot;]</span><br><span class="line">        adv1[&quot;ğŸ’¾ å†…å­˜æè‡´ä¼˜åŒ–&lt;br/&gt;36B vs 214B&lt;br/&gt;èŠ‚çœ 83%&quot;]</span><br><span class="line">        adv2[&quot;ğŸ”¢ æ•´æ•°å‹ç¼©&lt;br/&gt;5999 ä»…ç”¨ 2B&lt;br/&gt;æ™ºèƒ½ç¼–ç &quot;]</span><br><span class="line">        adv3[&quot;ğŸš€ CPUç¼“å­˜å‹å¥½&lt;br/&gt;è¿ç»­å†…å­˜&lt;br/&gt;é¢„è¯»ä¼˜åŒ–&quot;]</span><br><span class="line">        adv4[&quot;â†”ï¸ åŒå‘éå†&lt;br/&gt;prevlenåå‘&lt;br/&gt;zltailå®šä½&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph limitations [&quot;ziplist é™åˆ¶&quot;]</span><br><span class="line">        lim1[&quot;âš ï¸ O(n) æŸ¥æ‰¾&lt;br/&gt;ä¸é€‚åˆå¤§é‡å­—æ®µ&lt;br/&gt;é˜ˆå€¼ 512&quot;]</span><br><span class="line">        lim2[&quot;âš ï¸ realloc å¼€é”€&lt;br/&gt;æ’å…¥åˆ é™¤éœ€&lt;br/&gt;å†…å­˜é‡åˆ†é…&quot;]</span><br><span class="line">        lim3[&quot;âš ï¸ è¿é”æ›´æ–°&lt;br/&gt;254Bè¾¹ç•Œ&lt;br/&gt;æ¦‚ç‡ä½&quot;]</span><br><span class="line">        lim4[&quot;ğŸ“Š é€‚ç”¨åœºæ™¯&lt;br/&gt;å°å¯¹è±¡&lt;br/&gt;&lt; 64B value&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph transition [&quot;ç¼–ç è½¬æ¢&quot;]</span><br><span class="line">        t1[&quot;æ¡ä»¶1: entries &gt; 512&quot;]</span><br><span class="line">        t2[&quot;æ¡ä»¶2: value &gt; 64B&quot;]</span><br><span class="line">        t3[&quot;è§¦å‘è½¬æ¢&lt;br/&gt;ziplist â†’ hashtable&lt;br/&gt;ä¸å¯é€†&quot;]</span><br><span class="line">        </span><br><span class="line">        t1 --&gt; t3</span><br><span class="line">        t2 --&gt; t3</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    classDef headerStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px</span><br><span class="line">    classDef entryStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px</span><br><span class="line">    classDef intStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px</span><br><span class="line">    classDef advStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px</span><br><span class="line">    classDef warnStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px</span><br><span class="line">    </span><br><span class="line">    class h1,h2,h3,zlend,m0,m1,m2,m7 headerStyle</span><br><span class="line">    class e1,e2,e3,e1_p,e1_e,e1_c,e2_p,e2_e,e2_c,e3_p,e3_e,e3_c,m3,m4,m5 entryStyle</span><br><span class="line">    class e4,e4_p,e4_e,e4_c,m6,i1,i2 intStyle</span><br><span class="line">    class adv1,adv2,adv3,adv4,zl,zl1,zl2,zl3,zl_total advStyle</span><br><span class="line">    class lim1,lim2,lim3,lim4,ht,json,ht_total,json_total warnStyle</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å­—èŠ‚çº§è¯¦ç»†è¡¨æ ¼"><a href="#å­—èŠ‚çº§è¯¦ç»†è¡¨æ ¼" class="headerlink" title="å­—èŠ‚çº§è¯¦ç»†è¡¨æ ¼"></a>å­—èŠ‚çº§è¯¦ç»†è¡¨æ ¼</h2><table>
<thead>
<tr>
<th>åç§»</th>
<th>å­—æ®µ</th>
<th>åå…­è¿›åˆ¶</th>
<th>åè¿›åˆ¶</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>0-3</td>
<td>zlbytes</td>
<td>0x0000002C</td>
<td>44</td>
<td>æ€»å¤§å°</td>
</tr>
<tr>
<td>4-7</td>
<td>zltail</td>
<td>0x00000023</td>
<td>35</td>
<td>å°¾èŠ‚ç‚¹åç§»</td>
</tr>
<tr>
<td>8-9</td>
<td>zllen</td>
<td>0x0004</td>
<td>4</td>
<td>4ä¸ªèŠ‚ç‚¹</td>
</tr>
<tr>
<td><strong>10</strong></td>
<td><strong>Entry 1: â€œnameâ€</strong></td>
<td></td>
<td></td>
<td><strong>field</strong></td>
</tr>
<tr>
<td>10</td>
<td>prevlen</td>
<td>0x00</td>
<td>0</td>
<td>ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</td>
</tr>
<tr>
<td>11</td>
<td>encoding</td>
<td>0x04</td>
<td>4</td>
<td>å­—ç¬¦ä¸²é•¿åº¦4</td>
</tr>
<tr>
<td>12-15</td>
<td>content</td>
<td>0x6E616D65</td>
<td>â€œnameâ€</td>
<td>n-a-m-e</td>
</tr>
<tr>
<td><strong>16</strong></td>
<td><strong>Entry 2: â€œiPhoneâ€</strong></td>
<td></td>
<td></td>
<td><strong>value</strong></td>
</tr>
<tr>
<td>16</td>
<td>prevlen</td>
<td>0x06</td>
<td>6</td>
<td>å‰ä¸€èŠ‚ç‚¹6B</td>
</tr>
<tr>
<td>17</td>
<td>encoding</td>
<td>0x06</td>
<td>6</td>
<td>å­—ç¬¦ä¸²é•¿åº¦6</td>
</tr>
<tr>
<td>18-23</td>
<td>content</td>
<td>0x69506F6E65</td>
<td>â€œiPhoneâ€</td>
<td>i-P-h-o-n-e</td>
</tr>
<tr>
<td><strong>24</strong></td>
<td><strong>Entry 3: â€œpriceâ€</strong></td>
<td></td>
<td></td>
<td><strong>field</strong></td>
</tr>
<tr>
<td>24</td>
<td>prevlen</td>
<td>0x08</td>
<td>8</td>
<td>å‰ä¸€èŠ‚ç‚¹8B</td>
</tr>
<tr>
<td>25</td>
<td>encoding</td>
<td>0x05</td>
<td>5</td>
<td>å­—ç¬¦ä¸²é•¿åº¦5</td>
</tr>
<tr>
<td>26-30</td>
<td>content</td>
<td>0x7072696365</td>
<td>â€œpriceâ€</td>
<td>p-r-i-c-e</td>
</tr>
<tr>
<td><strong>31</strong></td>
<td><strong>Entry 4: 5999</strong></td>
<td></td>
<td></td>
<td><strong>value æ•´æ•°</strong></td>
</tr>
<tr>
<td>31</td>
<td>prevlen</td>
<td>0x07</td>
<td>7</td>
<td>å‰ä¸€èŠ‚ç‚¹7B</td>
</tr>
<tr>
<td>32</td>
<td>encoding</td>
<td>0xC0</td>
<td>11000000</td>
<td>int16_t</td>
</tr>
<tr>
<td>33-34</td>
<td>content</td>
<td>0x6F17</td>
<td>5999</td>
<td>å°ç«¯åº</td>
</tr>
<tr>
<td><strong>35</strong></td>
<td><strong>zlend</strong></td>
<td><strong>0xFF</strong></td>
<td><strong>255</strong></td>
<td><strong>ç»“æŸæ ‡è®°</strong></td>
</tr>
</tbody></table>
<hr>
<h2 id="ç¼–ç è¯¦è§£"><a href="#ç¼–ç è¯¦è§£" class="headerlink" title="ç¼–ç è¯¦è§£"></a>ç¼–ç è¯¦è§£</h2><h3 id="å­—ç¬¦ä¸²ç¼–ç ï¼ˆå‰2ä½-00ï¼‰"><a href="#å­—ç¬¦ä¸²ç¼–ç ï¼ˆå‰2ä½-00ï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ç¼–ç ï¼ˆå‰2ä½ &#x3D; 00ï¼‰"></a>å­—ç¬¦ä¸²ç¼–ç ï¼ˆå‰2ä½ &#x3D; 00ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Entry 1: 0x04 = 00000100</span><br><span class="line">  â†’ å‰2ä½ 00 = å­—ç¬¦ä¸²</span><br><span class="line">  â†’ å6ä½ 000100 = 4 = é•¿åº¦</span><br><span class="line"></span><br><span class="line">Entry 2: 0x06 = 00000110</span><br><span class="line">  â†’ å‰2ä½ 00 = å­—ç¬¦ä¸²</span><br><span class="line">  â†’ å6ä½ 000110 = 6 = é•¿åº¦</span><br><span class="line"></span><br><span class="line">Entry 3: 0x05 = 00000101</span><br><span class="line">  â†’ å‰2ä½ 00 = å­—ç¬¦ä¸²</span><br><span class="line">  â†’ å6ä½ 000101 = 5 = é•¿åº¦</span><br></pre></td></tr></table></figure>

<h3 id="æ•´æ•°ç¼–ç ï¼ˆå‰2ä½-11ï¼‰â­"><a href="#æ•´æ•°ç¼–ç ï¼ˆå‰2ä½-11ï¼‰â­" class="headerlink" title="æ•´æ•°ç¼–ç ï¼ˆå‰2ä½ &#x3D; 11ï¼‰â­"></a>æ•´æ•°ç¼–ç ï¼ˆå‰2ä½ &#x3D; 11ï¼‰â­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Entry 4: 0xC0 = 11000000</span><br><span class="line">  â†’ å‰2ä½ 11 = æ•´æ•°</span><br><span class="line">  â†’ å6ä½ 000000 = int16_t (2å­—èŠ‚)</span><br><span class="line">  </span><br><span class="line">Content: 0x6F17</span><br><span class="line">  â†’ å°ç«¯åº: [0x6F] [0x17]</span><br><span class="line">  â†’ è®¡ç®—: 0x17 * 256 + 0x6F = 23 * 256 + 111 = 5999</span><br><span class="line">  </span><br><span class="line">ä¼˜åŒ–æ•ˆæœ:</span><br><span class="line">  - æ•´æ•°ç¼–ç : 1B encoding + 2B content = 3B</span><br><span class="line">  - å­—ç¬¦ä¸²ç¼–ç : 1B encoding + 4B &quot;5999&quot; = 5B</span><br><span class="line">  - èŠ‚çœ: 2 å­—èŠ‚!</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å†…å­˜å¯¹æ¯”æ€»ç»“"><a href="#å†…å­˜å¯¹æ¯”æ€»ç»“" class="headerlink" title="å†…å­˜å¯¹æ¯”æ€»ç»“"></a>å†…å­˜å¯¹æ¯”æ€»ç»“</h2><table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>æ€»å­—èŠ‚æ•°</th>
<th>ç›¸å¯¹ ziplist</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ziplist</strong></td>
<td><strong>36</strong></td>
<td><strong>1.0x</strong></td>
<td>âœ… æœ€ä¼˜</td>
</tr>
<tr>
<td>String JSON</td>
<td>50</td>
<td>1.4x</td>
<td>âŒ æ— æ³•éƒ¨åˆ†æ›´æ–°</td>
</tr>
<tr>
<td>hashtable</td>
<td>214</td>
<td>5.9x</td>
<td>âŒ å†…å­˜å¼€é”€å¤§</td>
</tr>
</tbody></table>
<hr>
<h2 id="å…³é”®è¦ç‚¹"><a href="#å…³é”®è¦ç‚¹" class="headerlink" title="å…³é”®è¦ç‚¹"></a>å…³é”®è¦ç‚¹</h2><h3 id="ä¸ºä»€ä¹ˆè¿™ä¹ˆçœå†…å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™ä¹ˆçœå†…å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™ä¹ˆçœå†…å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™ä¹ˆçœå†…å­˜ï¼Ÿ</h3><ol>
<li><strong>æ— æŒ‡é’ˆå¼€é”€</strong>ï¼šlinkedlist æ¯èŠ‚ç‚¹ 16B æŒ‡é’ˆï¼Œhashtable æ¯èŠ‚ç‚¹ 8B æŒ‡é’ˆ</li>
<li><strong>ç´§å‡‘å­˜å‚¨</strong>ï¼šè¿ç»­å†…å­˜ï¼Œæ— ç¢ç‰‡</li>
<li><strong>æ•´æ•°ä¼˜åŒ–</strong>ï¼š5999 ç”¨ 2Bï¼Œä¸æ˜¯ 4B å­—ç¬¦ä¸²</li>
<li><strong>å˜é•¿ç¼–ç </strong>ï¼šå°æ•°æ®ç”¨å°ç©ºé—´</li>
</ol>
<h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èï¼šå°å¯¹è±¡</span></span><br><span class="line">rdb.HSet(ctx, <span class="string">&quot;session:123&quot;</span>, <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">    <span class="string">&quot;uid&quot;</span>:   <span class="number">88888</span>,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:  <span class="string">&quot;alice&quot;</span>,</span><br><span class="line">    <span class="string">&quot;role&quot;</span>:  <span class="string">&quot;buyer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;login&quot;</span>: time.Now().Unix(),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// â†’ ziplist ç¼–ç ï¼Œå†…å­˜æçœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ ä¸æ¨èï¼šå¤§å¯¹è±¡æˆ–å¤§é‡å­—æ®µ</span></span><br><span class="line">rdb.HSet(ctx, <span class="string">&quot;user:123&quot;</span>, <span class="string">&quot;profile&quot;</span>, longJSON)  <span class="comment">// &gt; 64B</span></span><br><span class="line"><span class="comment">// â†’ ä¼šè½¬æ¢ä¸º hashtable</span></span><br></pre></td></tr></table></figure>

<h3 id="ç›‘æ§å‘½ä»¤"><a href="#ç›‘æ§å‘½ä»¤" class="headerlink" title="ç›‘æ§å‘½ä»¤"></a>ç›‘æ§å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; HSET product:1001 name <span class="string">&quot;iPhone&quot;</span> price 5999</span><br><span class="line">redis&gt; OBJECT ENCODING product:1001</span><br><span class="line"><span class="string">&quot;ziplist&quot;</span></span><br><span class="line"></span><br><span class="line">redis&gt; MEMORY USAGE product:1001</span><br><span class="line">(<span class="built_in">integer</span>) 64  <span class="comment"># åŒ…æ‹¬ Redis å¯¹è±¡å¼€é”€</span></span><br><span class="line"></span><br><span class="line">redis&gt; HLEN product:1001</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

