<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æœ¬æ–‡æ·±å…¥å‰–æ Redis çš„æ ¸å¿ƒåŸç†ã€æ•°æ®ç»“æ„åº•å±‚å®ç°ã€ç”µå•†åœºæ™¯æœ€ä½³å®è·µã€‚åŒ…å« Hash ziplist å­—èŠ‚çº§å†…å­˜åˆ†æã€æ¸è¿›å¼ rehash æœºåˆ¶ã€ç¼“å­˜ä¸€è‡´æ€§æ–¹æ¡ˆç­‰ã€‚  ğŸ“‹ ç›®å½•å¯¼èˆªä¸€ã€åŸºç¡€ç¯‡ Redis æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯ äº”ç§æ•°æ®ç±»å‹ä¸åº•å±‚å®ç° å¸¸ç”¨å‘½ä»¤ä¸æ—¶é—´å¤æ‚åº¦  äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ Hash åº•å±‚å®ç°è¯¦è§£ï¼ˆâ­ æ ¸å¿ƒé‡ç‚¹ï¼‰ ziplist å‹ç¼©åˆ—è¡¨ï¼ˆå­—èŠ‚çº§åˆ†æï¼‰ hashtable">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸­é—´ä»¶ - Redis åŸç†ä¸å®è·µ">
<meta property="og:url" content="http://yoursite.com/2024/03/06/system-design/8-cache-redis/index.html">
<meta property="og:site_name" content="wxquare&#39;s Blogs">
<meta property="og:description" content="æœ¬æ–‡æ·±å…¥å‰–æ Redis çš„æ ¸å¿ƒåŸç†ã€æ•°æ®ç»“æ„åº•å±‚å®ç°ã€ç”µå•†åœºæ™¯æœ€ä½³å®è·µã€‚åŒ…å« Hash ziplist å­—èŠ‚çº§å†…å­˜åˆ†æã€æ¸è¿›å¼ rehash æœºåˆ¶ã€ç¼“å­˜ä¸€è‡´æ€§æ–¹æ¡ˆç­‰ã€‚  ğŸ“‹ ç›®å½•å¯¼èˆªä¸€ã€åŸºç¡€ç¯‡ Redis æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯ äº”ç§æ•°æ®ç±»å‹ä¸åº•å±‚å®ç° å¸¸ç”¨å‘½ä»¤ä¸æ—¶é—´å¤æ‚åº¦  äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ Hash åº•å±‚å®ç°è¯¦è§£ï¼ˆâ­ æ ¸å¿ƒé‡ç‚¹ï¼‰ ziplist å‹ç¼©åˆ—è¡¨ï¼ˆå­—èŠ‚çº§åˆ†æï¼‰ hashtable">
<meta property="og:locale">
<meta property="og:image" content="http://yoursite.com/images/cache-remote-local-multilevel.png">
<meta property="og:image" content="http://yoursite.com/images/double-buffer-lru.png">
<meta property="og:image" content="http://yoursite.com/images/cache-double-buffer-lru.png">
<meta property="og:image" content="http://yoursite.com/images/cache-refesh.png">
<meta property="og:image" content="http://yoursite.com/images/cache-read-write-mode.png">
<meta property="article:published_time" content="2024-03-05T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-07T16:00:00.000Z">
<meta property="article:author" content="wxquare">
<meta property="article:tag" content="æ•°æ®ç»“æ„">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="ç¼“å­˜">
<meta property="article:tag" content="åˆ†å¸ƒå¼ç³»ç»Ÿ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/cache-remote-local-multilevel.png">


<link rel="canonical" href="http://yoursite.com/2024/03/06/system-design/8-cache-redis/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-Hans","comments":true,"permalink":"http://yoursite.com/2024/03/06/system-design/8-cache-redis/","path":"2024/03/06/system-design/8-cache-redis/","title":"ä¸­é—´ä»¶ - Redis åŸç†ä¸å®è·µ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä¸­é—´ä»¶ - Redis åŸç†ä¸å®è·µ | wxquare's Blogs</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">wxquare's Blogs</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-friends"><a href="/friends" rel="section"><i class="fa fa-user fa-fw"></i>Friends</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%8B-%E7%9B%AE%E5%BD%95%E5%AF%BC%E8%88%AA"><span class="nav-number">1.</span> <span class="nav-text">ğŸ“‹ ç›®å½•å¯¼èˆª</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%9F%BA%E7%A1%80%E7%AF%87"><span class="nav-number">1.1.</span> <span class="nav-text">ä¸€ã€åŸºç¡€ç¯‡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90"><span class="nav-number">1.2.</span> <span class="nav-text">äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.3.</span> <span class="nav-text">ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-number">1.4.</span> <span class="nav-text">å››ã€é«˜çº§ç‰¹æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.5.</span> <span class="nav-text">äº”ã€æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-number">1.6.</span> <span class="nav-text">å…­ã€å®æˆ˜æ¡ˆä¾‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E4%B8%8E%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.</span> <span class="nav-text">Redis æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E6%80%BB%E8%A7%88"><span class="nav-number">2.1.</span> <span class="nav-text">æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.2.</span> <span class="nav-text">å…¸å‹åº”ç”¨åœºæ™¯</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%8A%A0%E9%80%9F%EF%BC%88%E4%B8%8A%E6%B8%B8%E6%95%B0%E6%8D%AE-%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%A4%96%E9%83%A8%E8%81%9A%E5%90%88%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">2.2.1.</span> <span class="nav-text">ç¼“å­˜åŠ é€Ÿï¼ˆä¸Šæ¸¸æ•°æ®&#x2F;æ•°æ®åº“&#x2F;å¤–éƒ¨èšåˆæ•°æ®ï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E6%95%B0%E5%99%A8%E5%9C%BA%E6%99%AF%EF%BC%88incr-int%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">è®¡æ•°å™¨åœºæ™¯ï¼ˆincr + intï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZSet-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.4.</span> <span class="nav-text">ZSet ä½¿ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">2.5.</span> <span class="nav-text">List ä½¿ç”¨åœºæ™¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90-1"><span class="nav-number">3.</span> <span class="nav-text">äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.1.</span> <span class="nav-text">Hash åº•å±‚å®ç°åŸç†è¯¦è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BC%96%E7%A0%81%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5"><span class="nav-number">3.1.1.</span> <span class="nav-text">1. ç¼–ç é€‰æ‹©ç­–ç•¥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ziplist%EF%BC%88%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8%EF%BC%89-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96"><span class="nav-number">3.1.2.</span> <span class="nav-text">2. ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰- å†…å­˜ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">2.1 æ•´ä½“ç»“æ„</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-Entry-%E8%8A%82%E7%82%B9%E8%AF%A6%E7%BB%86%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%89"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">2.2 Entry èŠ‚ç‚¹è¯¦ç»†ç»“æ„ï¼ˆä¸‰éƒ¨åˆ†ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Part-1-prevlen%EF%BC%88%E5%89%8D%E4%B8%80%E8%8A%82%E7%82%B9%E9%95%BF%E5%BA%A6%EF%BC%89"><span class="nav-number">3.1.2.2.1.</span> <span class="nav-text">Part 1: prevlenï¼ˆå‰ä¸€èŠ‚ç‚¹é•¿åº¦ï¼‰</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Part-2-encoding%EF%BC%88%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B%EF%BC%89"><span class="nav-number">3.1.2.2.2.</span> <span class="nav-text">Part 2: encodingï¼ˆç¼–ç ç±»å‹ï¼‰</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Part-3-content%EF%BC%88%E5%AE%9E%E9%99%85%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">3.1.2.2.3.</span> <span class="nav-text">Part 3: contentï¼ˆå®é™…æ•°æ®ï¼‰</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-3-%E5%AE%9E%E9%99%85%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.2.3.</span> <span class="nav-text">2.3 å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-4-%E9%81%8D%E5%8E%86%E6%9C%BA%E5%88%B6"><span class="nav-number">3.1.2.4.</span> <span class="nav-text">2.4 éå†æœºåˆ¶</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-%E8%BF%9E%E9%94%81%E6%9B%B4%E6%96%B0%E9%97%AE%E9%A2%98%EF%BC%88Cascade-Update%EF%BC%89"><span class="nav-number">3.1.2.5.</span> <span class="nav-text">2.5 è¿é”æ›´æ–°é—®é¢˜ï¼ˆCascade Updateï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-6-%E7%BC%96%E7%A0%81%E7%A4%BA%E4%BE%8B%EF%BC%88Go-%E4%BB%A3%E7%A0%81%EF%BC%89"><span class="nav-number">3.1.2.6.</span> <span class="nav-text">2.6 ç¼–ç ç¤ºä¾‹ï¼ˆGo ä»£ç ï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-7-%E4%BC%98%E5%8A%BF%E4%B8%8E%E9%99%90%E5%88%B6"><span class="nav-number">3.1.2.7.</span> <span class="nav-text">2.7 ä¼˜åŠ¿ä¸é™åˆ¶</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-8-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E6%80%BB%E7%BB%93"><span class="nav-number">3.1.2.8.</span> <span class="nav-text">2.8 åº”ç”¨åœºæ™¯æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-hashtable%EF%BC%88%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%89-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">3.1.3.</span> <span class="nav-text">3. hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰- æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%B8%90%E8%BF%9B%E5%BC%8F-Rehash-%E6%9C%BA%E5%88%B6%EF%BC%88%E6%A0%B8%E5%BF%83%EF%BC%89"><span class="nav-number">3.1.4.</span> <span class="nav-text">4. æ¸è¿›å¼ Rehash æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.5.</span> <span class="nav-text">5. å“ˆå¸Œå‡½æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="nav-number">3.1.6.</span> <span class="nav-text">6. æ€§èƒ½å¯¹æ¯”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E7%94%B5%E5%95%86%E5%9C%BA%E6%99%AF%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">3.1.7.</span> <span class="nav-text">7. ç”µå•†åœºæ™¯æœ€ä½³å®è·µ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-Hash-vs-String-JSON"><span class="nav-number">3.1.8.</span> <span class="nav-text">8. Hash vs String(JSON)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E4%BC%98"><span class="nav-number">3.1.9.</span> <span class="nav-text">9. ç›‘æ§ä¸è°ƒä¼˜</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.2.</span> <span class="nav-text">String åº•å±‚å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String-SDS-%E6%A0%B8%E5%BF%83%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.1.</span> <span class="nav-text">String&#x2F;SDS æ ¸å¿ƒç»“æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SDS-%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.2.</span> <span class="nav-text">SDS ç»“æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF%E5%AF%B9%E6%AF%94"><span class="nav-number">3.2.3.</span> <span class="nav-text">ä¼˜åŠ¿å¯¹æ¯”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A0%81%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.2.4.</span> <span class="nav-text">ç¼–ç ç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.2.5.</span> <span class="nav-text">åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.3.</span> <span class="nav-text">List åº•å±‚å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#quicklist-%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.1.</span> <span class="nav-text">quicklist ç»“æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="nav-number">3.3.2.</span> <span class="nav-text">é…ç½®å‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="nav-number">3.3.3.</span> <span class="nav-text">åº”ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.4.</span> <span class="nav-text">æ€§èƒ½å¯¹æ¯”</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.4.</span> <span class="nav-text">Set åº•å±‚å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#intset%EF%BC%88%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">3.4.1.</span> <span class="nav-text">intsetï¼ˆæ•´æ•°é›†åˆï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="nav-number">3.4.2.</span> <span class="nav-text">åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZSet-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.5.</span> <span class="nav-text">ZSet åº•å±‚å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ziplist-%E7%BC%96%E7%A0%81"><span class="nav-number">3.5.1.</span> <span class="nav-text">ziplist ç¼–ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#skiplist-hashtable-%E7%BC%96%E7%A0%81"><span class="nav-number">3.5.2.</span> <span class="nav-text">skiplist + hashtable ç¼–ç </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="nav-number">3.5.3.</span> <span class="nav-text">åº”ç”¨åœºæ™¯</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5-1"><span class="nav-number">4.</span> <span class="nav-text">ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%AE%B9%E9%87%8F%E8%A7%84%E5%88%92%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-number">4.1.</span> <span class="nav-text">ç¼“å­˜å®¹é‡è§„åˆ’ä¸å†…å­˜ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5"><span class="nav-number">4.1.1.</span> <span class="nav-text">å†…å­˜æ·˜æ±°ç­–ç•¥</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%9C%9F%E9%94%AE%E5%88%A0%E9%99%A4%E7%AD%96%E7%95%A5"><span class="nav-number">4.2.</span> <span class="nav-text">è¿‡æœŸé”®åˆ é™¤ç­–ç•¥</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7-1"><span class="nav-number">5.</span> <span class="nav-text">å››ã€é«˜çº§ç‰¹æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%EF%BC%88RDB%E3%80%81AOF%EF%BC%89"><span class="nav-number">5.1.</span> <span class="nav-text">æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDBã€AOFï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98-vs-%E8%BF%9C%E7%A8%8B%E7%BC%93%E5%AD%98"><span class="nav-number">5.2.</span> <span class="nav-text">æœ¬åœ°ç¼“å­˜ vs è¿œç¨‹ç¼“å­˜</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8Cbuffer-vs-LRU-LFU"><span class="nav-number">5.2.1.</span> <span class="nav-text">åŒbuffer vs LRU&#x2F;LFU</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E4%B8%8EDB%E4%B8%80%E8%87%B4%E6%80%A7%E6%96%B9%E6%A1%88"><span class="nav-number">5.3.</span> <span class="nav-text">ç¼“å­˜ä¸DBä¸€è‡´æ€§æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="nav-number">5.3.1.</span> <span class="nav-text">ä¸€è‡´æ€§é—®é¢˜åˆ†æ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%80%83%EF%BC%9A"><span class="nav-number">5.4.</span> <span class="nav-text">æ€è€ƒï¼š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%EF%BC%88%E9%9B%AA%E5%B4%A9%E3%80%81%E7%A9%BF%E9%80%8F%E3%80%81%E5%87%BB%E7%A9%BF%EF%BC%89"><span class="nav-number">5.5.</span> <span class="nav-text">ç¼“å­˜å¼‚å¸¸å¤„ç†ï¼ˆé›ªå´©ã€ç©¿é€ã€å‡»ç©¿ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7%E7%BC%93%E5%AD%98%E9%97%AE%E9%A2%98"><span class="nav-number">5.5.1.</span> <span class="nav-text">ä¸‰å¤§ç¼“å­˜é—®é¢˜</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-1"><span class="nav-number">6.</span> <span class="nav-text">äº”ã€æ€§èƒ½ä¼˜åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-Redis-%E8%BF%99%E4%B9%88%E5%BF%AB%EF%BC%9F"><span class="nav-number">6.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆ Redis è¿™ä¹ˆå¿«ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%8E%9F%E5%9B%A0"><span class="nav-number">6.1.1.</span> <span class="nav-text">æ ¸å¿ƒåŸå› </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.2.</span> <span class="nav-text">å•çº¿ç¨‹æ¨¡å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B%EF%BC%9F"><span class="nav-number">6.2.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7Key%E5%92%8C%E7%83%ADKey%E9%97%AE%E9%A2%98"><span class="nav-number">6.3.</span> <span class="nav-text">å¤§Keyå’Œçƒ­Keyé—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%A7Key%EF%BC%9F"><span class="nav-number">6.3.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%B9%E6%A1%88%EF%BC%88%E4%B8%BB%E4%BB%8E%E3%80%81%E5%93%A8%E5%85%B5%E3%80%81%E9%9B%86%E7%BE%A4%EF%BC%89"><span class="nav-number">6.4.</span> <span class="nav-text">åˆ†å¸ƒå¼æ–¹æ¡ˆï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E8%B7%AF%E7%BA%BF"><span class="nav-number">6.4.1.</span> <span class="nav-text">æ¶æ„æ¼”è¿›è·¯çº¿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">6.4.2.</span> <span class="nav-text">ä¸»ä»å¤åˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F-Sentinel"><span class="nav-number">6.4.3.</span> <span class="nav-text">å“¨å…µæ¨¡å¼ (Sentinel)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Redis-Cluster-%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.4.4.</span> <span class="nav-text">Redis Cluster é›†ç¾¤æ¨¡å¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Codis"><span class="nav-number">6.4.5.</span> <span class="nav-text">Codis</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lua-%E8%84%9A%E6%9C%AC"><span class="nav-number">6.5.</span> <span class="nav-text">Lua è„šæœ¬</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-Lua%EF%BC%9F"><span class="nav-number">6.5.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆä½¿ç”¨ Luaï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">6.5.2.</span> <span class="nav-text">ä½¿ç”¨æ³¨æ„äº‹é¡¹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">7.</span> <span class="nav-text">Redis å¸¸ç”¨å‘½ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%91%BD%E4%BB%A4"><span class="nav-number">7.1.</span> <span class="nav-text">è¿æ¥å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="nav-number">7.2.</span> <span class="nav-text">åŸºç¡€å‘½ä»¤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E7%9B%91%E6%8E%A7"><span class="nav-number">8.</span> <span class="nav-text">æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7Key%E5%92%8C%E7%83%ADKey%E9%97%AE%E9%A2%98-1"><span class="nav-number">8.1.</span> <span class="nav-text">å¤§Keyå’Œçƒ­Keyé—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%A4%A7Key%EF%BC%9F-1"><span class="nav-number">8.1.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7-Key-%E5%8D%B1%E5%AE%B3"><span class="nav-number">8.1.2.</span> <span class="nav-text">å¤§ Key å±å®³</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E7%8E%B0%E5%A4%A7-Key"><span class="nav-number">8.1.3.</span> <span class="nav-text">å‘ç°å¤§ Key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">8.1.4.</span> <span class="nav-text">è§£å†³æ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%83%AD-Key-%E5%8D%B1%E5%AE%B3"><span class="nav-number">8.1.5.</span> <span class="nav-text">çƒ­ Key å±å®³</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="nav-number">8.1.6.</span> <span class="nav-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="nav-number">8.2.</span> <span class="nav-text">ç›‘æ§æŒ‡æ ‡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E6%8C%87%E6%A0%87"><span class="nav-number">8.2.1.</span> <span class="nav-text">å…³é”®æŒ‡æ ‡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6"><span class="nav-number">8.2.2.</span> <span class="nav-text">ç›‘æ§å‘Šè­¦</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-1"><span class="nav-number">9.</span> <span class="nav-text">å…­ã€å®æˆ˜æ¡ˆä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.1.</span> <span class="nav-text">åˆ†å¸ƒå¼é”å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.1.1.</span> <span class="nav-text">åŸºæœ¬å®ç°</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BloomFilter-%E5%AE%9E%E8%B7%B5"><span class="nav-number">9.2.</span> <span class="nav-text">BloomFilter å®è·µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">9.2.1.</span> <span class="nav-text">åŸç†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AC%E5%BC%8F"><span class="nav-number">9.3.</span> <span class="nav-text">å…¬å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-%E5%AE%9E%E7%8E%B0"><span class="nav-number">9.4.</span> <span class="nav-text">Redis å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="nav-number">9.5.</span> <span class="nav-text">åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="nav-number">10.</span> <span class="nav-text">ç§’æ€ç³»ç»Ÿè®¾è®¡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98"><span class="nav-number">10.1.</span> <span class="nav-text">æ ¸å¿ƒé—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1"><span class="nav-number">10.2.</span> <span class="nav-text">æ–¹æ¡ˆè®¾è®¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E8%A1%8C%E6%A6%9C%E5%AE%9E%E7%8E%B0"><span class="nav-number">11.</span> <span class="nav-text">æ’è¡Œæ¦œå®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%97%B6%E6%8E%92%E8%A1%8C%E6%A6%9C"><span class="nav-number">11.1.</span> <span class="nav-text">å®æ—¶æ’è¡Œæ¦œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%8F%E6%97%A5%E6%8E%92%E8%A1%8C%E6%A6%9C%EF%BC%88%E8%87%AA%E5%8A%A8%E8%BF%87%E6%9C%9F%EF%BC%89"><span class="nav-number">11.2.</span> <span class="nav-text">æ¯æ—¥æ’è¡Œæ¦œï¼ˆè‡ªåŠ¨è¿‡æœŸï¼‰</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SDK-%E6%8E%A8%E8%8D%90"><span class="nav-number">12.</span> <span class="nav-text">SDK æ¨è</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Go-Client"><span class="nav-number">12.1.</span> <span class="nav-text">Go Client</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93"><span class="nav-number">13.</span> <span class="nav-text">æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E6%95%B0%E5%AD%97%E8%AE%B0%E5%BF%86"><span class="nav-number">13.1.</span> <span class="nav-text">å…³é”®æ•°å­—è®°å¿†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E9%80%89%E6%8B%A9%E5%86%B3%E7%AD%96%E6%A0%91"><span class="nav-number">13.2.</span> <span class="nav-text">æ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-number">13.3.</span> <span class="nav-text">ç¼“å­˜è®¾è®¡æ£€æŸ¥æ¸…å•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E9%80%9F%E6%9F%A5"><span class="nav-number">13.4.</span> <span class="nav-text">æœ€ä½³å®è·µé€ŸæŸ¥</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9B%BE%E8%A1%A8%E7%B4%A2%E5%BC%95"><span class="nav-number">14.</span> <span class="nav-text">å¯è§†åŒ–å›¾è¡¨ç´¢å¼•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hash-%E7%9B%B8%E5%85%B3"><span class="nav-number">14.1.</span> <span class="nav-text">Hash ç›¸å…³</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ziplist-%E7%9B%B8%E5%85%B3"><span class="nav-number">14.2.</span> <span class="nav-text">Ziplist ç›¸å…³</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-number">14.3.</span> <span class="nav-text">å®æˆ˜æ¡ˆä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AF%B9%E6%AF%94"><span class="nav-number">14.4.</span> <span class="nav-text">æ•°æ®ç»“æ„å¯¹æ¯”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="nav-number">15.</span> <span class="nav-text">æ¨èé˜…è¯»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-number">15.1.</span> <span class="nav-text">å®˜æ–¹æ–‡æ¡£</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%B1%E5%BA%A6%E6%96%87%E7%AB%A0"><span class="nav-number">15.2.</span> <span class="nav-text">æ·±åº¦æ–‡ç« </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B-1"><span class="nav-number">15.3.</span> <span class="nav-text">å®æˆ˜æ¡ˆä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">15.4.</span> <span class="nav-text">æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%BA%93"><span class="nav-number">15.5.</span> <span class="nav-text">é¢è¯•é¢˜åº“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97"><span class="nav-number">16.</span> <span class="nav-text">æ›´æ–°æ—¥å¿—</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wxquare"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">wxquare</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/xianguiwang0316@gmail.com" title="E-Mail â†’ xianguiwang0316@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2024/03/06/system-design/8-cache-redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="wxquare">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxquare's Blogs">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ä¸­é—´ä»¶ - Redis åŸç†ä¸å®è·µ | wxquare's Blogs">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä¸­é—´ä»¶ - Redis åŸç†ä¸å®è·µ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-06 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-06T00:00:00+08:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2026-01-08 00:00:00" itemprop="dateModified" datetime="2026-01-08T00:00:00+08:00">2026-01-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">ç³»ç»Ÿè®¾è®¡</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>æœ¬æ–‡æ·±å…¥å‰–æ Redis çš„æ ¸å¿ƒåŸç†ã€æ•°æ®ç»“æ„åº•å±‚å®ç°ã€ç”µå•†åœºæ™¯æœ€ä½³å®è·µã€‚åŒ…å« Hash ziplist å­—èŠ‚çº§å†…å­˜åˆ†æã€æ¸è¿›å¼ rehash æœºåˆ¶ã€ç¼“å­˜ä¸€è‡´æ€§æ–¹æ¡ˆç­‰ã€‚</p>
</blockquote>
<h2 id="ğŸ“‹-ç›®å½•å¯¼èˆª"><a href="#ğŸ“‹-ç›®å½•å¯¼èˆª" class="headerlink" title="ğŸ“‹ ç›®å½•å¯¼èˆª"></a>ğŸ“‹ ç›®å½•å¯¼èˆª</h2><h3 id="ä¸€ã€åŸºç¡€ç¯‡"><a href="#ä¸€ã€åŸºç¡€ç¯‡" class="headerlink" title="ä¸€ã€åŸºç¡€ç¯‡"></a>ä¸€ã€åŸºç¡€ç¯‡</h3><ol>
<li><a href="#redis-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E4%B8%8E%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">Redis æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯</a></li>
<li><a href="#redis-5%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">äº”ç§æ•°æ®ç±»å‹ä¸åº•å±‚å®ç°</a></li>
<li><a href="#redis-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">å¸¸ç”¨å‘½ä»¤ä¸æ—¶é—´å¤æ‚åº¦</a></li>
</ol>
<h3 id="äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ"><a href="#äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ" class="headerlink" title="äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ"></a>äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ</h3><ol>
<li><a href="#hash-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3">Hash åº•å±‚å®ç°è¯¦è§£</a>ï¼ˆâ­ æ ¸å¿ƒé‡ç‚¹ï¼‰<ul>
<li>ziplist å‹ç¼©åˆ—è¡¨ï¼ˆå­—èŠ‚çº§åˆ†æï¼‰</li>
<li>hashtable å“ˆå¸Œè¡¨ï¼ˆæ¸è¿›å¼ rehashï¼‰</li>
<li>å®æˆ˜æ¡ˆä¾‹ï¼š<code>&#123;name: &quot;iPhone&quot;, price: 5999&#125;</code></li>
</ul>
</li>
<li><a href="#string-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0">String&#x2F;SDS å®ç°</a></li>
<li><a href="#list-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0">List å®ç°ï¼ˆziplist&#x2F;linkedlist&#x2F;quicklistï¼‰</a></li>
<li><a href="#set-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0">Set å®ç°ï¼ˆintset&#x2F;hashtableï¼‰</a></li>
<li><a href="#zset-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0">ZSet å®ç°ï¼ˆziplist&#x2F;skiplistï¼‰</a></li>
</ol>
<h3 id="ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ"><a href="#ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ" class="headerlink" title="ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ"></a>ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ</h3><ol>
<li><a href="#redis-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">ç¼“å­˜ä½¿ç”¨åœºæ™¯</a>ï¼ˆè®¡æ•°å™¨ã€é™æµã€é˜Ÿåˆ—ï¼‰</li>
<li><a href="#%E6%80%8E%E4%B9%88%E8%80%83%E8%99%91%E7%BC%93%E5%AD%98%E5%92%8Cdb%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E9%97%AE%E9%A2%98">ç¼“å­˜ä¸DBä¸€è‡´æ€§</a></li>
<li><a href="#%E7%BC%93%E5%AD%98%E5%BC%82%E5%B8%B8%E4%B8%8E%E5%AF%B9%E5%BA%94%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95">ç¼“å­˜å¼‚å¸¸å¤„ç†</a>ï¼ˆé›ªå´©ã€ç©¿é€ã€å‡»ç©¿ï¼‰</li>
<li><a href="#%E9%80%89%E6%8B%A9local-remote-multilevel-cache">æœ¬åœ°ç¼“å­˜ vs è¿œç¨‹ç¼“å­˜</a></li>
</ol>
<h3 id="å››ã€é«˜çº§ç‰¹æ€§"><a href="#å››ã€é«˜çº§ç‰¹æ€§" class="headerlink" title="å››ã€é«˜çº§ç‰¹æ€§"></a>å››ã€é«˜çº§ç‰¹æ€§</h3><ol>
<li><a href="#%E8%AE%A1%E7%AE%97%E6%89%80%E9%9C%80%E7%9A%84%E7%BC%93%E5%AD%98%E7%9A%84%E5%AE%B9%E9%87%8F%E5%BD%93%E5%AE%B9%E9%87%8F%E8%B6%85%E8%BF%87%E9%99%90%E5%88%B6%E6%97%B6%E7%9A%84%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5">å†…å­˜ç®¡ç†</a>ï¼ˆæ·˜æ±°ç­–ç•¥ã€è¿‡æœŸé”®åˆ é™¤ï¼‰</li>
<li><a href="#redis-%E4%B8%A4%E7%A7%8D%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E4%BC%98%E7%BC%BA%E7%82%B9">æŒä¹…åŒ–æœºåˆ¶</a>ï¼ˆRDBã€AOFï¼‰</li>
<li><a href="#redis%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%B9%E6%A1%88">åˆ†å¸ƒå¼æ–¹æ¡ˆ</a>ï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰</li>
<li><a href="#redis--lua">Lua è„šæœ¬</a></li>
</ol>
<h3 id="äº”ã€æ€§èƒ½ä¼˜åŒ–"><a href="#äº”ã€æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="äº”ã€æ€§èƒ½ä¼˜åŒ–"></a>äº”ã€æ€§èƒ½ä¼˜åŒ–</h3><ol>
<li><a href="#redis-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E4%B9%88%E5%BF%AB">ä¸ºä»€ä¹ˆ Redis è¿™ä¹ˆå¿«</a></li>
<li><a href="#redis-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B">å•çº¿ç¨‹æ¨¡å‹</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E7%9B%91%E6%8E%A7">æ€§èƒ½è°ƒä¼˜å®è·µ</a></li>
<li><a href="#%E5%A4%A7key%E5%92%8C%E7%83%ADkey%E9%97%AE%E9%A2%98">å¤§ Keyã€çƒ­ Key é—®é¢˜</a></li>
</ol>
<h3 id="å…­ã€å®æˆ˜æ¡ˆä¾‹"><a href="#å…­ã€å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å…­ã€å®æˆ˜æ¡ˆä¾‹"></a>å…­ã€å®æˆ˜æ¡ˆä¾‹</h3><ol>
<li><a href="#redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">åˆ†å¸ƒå¼é”å®ç°</a></li>
<li><a href="#bloomfilter-%E5%AE%9E%E8%B7%B5">BloomFilter åº”ç”¨</a></li>
<li><a href="#%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1">ç§’æ€ç³»ç»Ÿè®¾è®¡</a></li>
<li><a href="#%E6%8E%92%E8%A1%8C%E6%A6%9C%E5%AE%9E%E7%8E%B0">æ’è¡Œæ¦œå®ç°</a></li>
</ol>
<hr>
<h2 id="Redis-æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯"><a href="#Redis-æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯" class="headerlink" title="Redis æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯"></a>Redis æ ¸å¿ƒç‰¹æ€§ä¸ä½¿ç”¨åœºæ™¯</h2><h3 id="æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ"><a href="#æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ"></a>æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¯´æ˜</th>
<th>ä¼˜åŠ¿</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å†…å­˜å­˜å‚¨</strong></td>
<td>æ•°æ®å…¨éƒ¨åœ¨å†…å­˜ä¸­</td>
<td>æå¿«çš„è¯»å†™é€Ÿåº¦ï¼ˆ10w+ QPSï¼‰</td>
</tr>
<tr>
<td><strong>å•çº¿ç¨‹æ¨¡å‹</strong></td>
<td>å‘½ä»¤ä¸²è¡Œæ‰§è¡Œ</td>
<td>é¿å…é”ç«äº‰ï¼Œç®€åŒ–å¹¶å‘</td>
</tr>
<tr>
<td><strong>å¤šç§æ•°æ®ç»“æ„</strong></td>
<td>String&#x2F;Hash&#x2F;List&#x2F;Set&#x2F;ZSet</td>
<td>è¦†ç›–å¤šç§ä¸šåŠ¡åœºæ™¯</td>
</tr>
<tr>
<td><strong>æŒä¹…åŒ–æ”¯æŒ</strong></td>
<td>RDB + AOF</td>
<td>æ•°æ®ä¸ä¸¢å¤±</td>
</tr>
<tr>
<td><strong>ä¸»ä»å¤åˆ¶</strong></td>
<td>è¯»å†™åˆ†ç¦»</td>
<td>é«˜å¯ç”¨ã€é«˜å¹¶å‘</td>
</tr>
<tr>
<td><strong>é›†ç¾¤æ¨¡å¼</strong></td>
<td>åˆ†ç‰‡å­˜å‚¨</td>
<td>æ¨ªå‘æ‰©å±•èƒ½åŠ›</td>
</tr>
</tbody></table>
<h3 id="å…¸å‹åº”ç”¨åœºæ™¯"><a href="#å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="å…¸å‹åº”ç”¨åœºæ™¯"></a>å…¸å‹åº”ç”¨åœºæ™¯</h3><h4 id="ç¼“å­˜åŠ é€Ÿï¼ˆä¸Šæ¸¸æ•°æ®-æ•°æ®åº“-å¤–éƒ¨èšåˆæ•°æ®ï¼‰"><a href="#ç¼“å­˜åŠ é€Ÿï¼ˆä¸Šæ¸¸æ•°æ®-æ•°æ®åº“-å¤–éƒ¨èšåˆæ•°æ®ï¼‰" class="headerlink" title="ç¼“å­˜åŠ é€Ÿï¼ˆä¸Šæ¸¸æ•°æ®&#x2F;æ•°æ®åº“&#x2F;å¤–éƒ¨èšåˆæ•°æ®ï¼‰"></a>ç¼“å­˜åŠ é€Ÿï¼ˆä¸Šæ¸¸æ•°æ®&#x2F;æ•°æ®åº“&#x2F;å¤–éƒ¨èšåˆæ•°æ®ï¼‰</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢å•†å“è¯¦æƒ…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetProduct</span><span class="params">(productID <span class="type">string</span>)</span></span> (*Product, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. å…ˆæŸ¥ç¼“å­˜</span></span><br><span class="line">    key := <span class="string">&quot;product:&quot;</span> + productID</span><br><span class="line">    data, err := rdb.Get(ctx, key).Result()</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> json.Unmarshal(data)  <span class="comment">// ç¼“å­˜å‘½ä¸­</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢ DB</span></span><br><span class="line">    product, err := db.QueryProduct(productID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. å›å†™ç¼“å­˜ï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰</span></span><br><span class="line">    rdb.Set(ctx, key, json.Marshal(product), <span class="number">1</span>*time.Hour)</span><br><span class="line">    <span class="keyword">return</span> product, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­˜å‚¨ JSON å¯¹è±¡</span></span><br><span class="line">rdb.Set(ctx, <span class="string">&quot;user:123&quot;</span>, <span class="string">`&#123;&quot;name&quot;:&quot;alice&quot;,&quot;age&quot;:25&#125;`</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨è®¡æ•°å™¨</span></span><br><span class="line">rdb.Set(ctx, <span class="string">&quot;visit:count&quot;</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æ€§èƒ½æå‡</strong>ï¼šDB æŸ¥è¯¢ 100ms â†’ Redis æŸ¥è¯¢ 1msï¼ˆæå‡ 100 å€ï¼‰</p>
<h3 id="è®¡æ•°å™¨åœºæ™¯ï¼ˆincr-intï¼‰"><a href="#è®¡æ•°å™¨åœºæ™¯ï¼ˆincr-intï¼‰" class="headerlink" title="è®¡æ•°å™¨åœºæ™¯ï¼ˆincr + intï¼‰"></a>è®¡æ•°å™¨åœºæ™¯ï¼ˆincr + intï¼‰</h3><ol>
<li>åº“å­˜æ‰£å‡ï¼ˆæœ€æ ¸å¿ƒåœºæ™¯ï¼‰è¿™æ˜¯è®¡æ•°å™¨æœ€å¹¿æ³›çš„åº”ç”¨ã€‚åœ¨ç§’æ€æˆ–å¤§ä¿ƒæœŸé—´ï¼Œç›´æ¥æ“ä½œæ•°æ®åº“åº“å­˜ä¼šç¬é—´æ‹–å®ç£ç›˜ I&#x2F;Oã€‚</li>
</ol>
<ul>
<li>é€»è¾‘ï¼š</li>
</ul>
<ol>
<li><p>æ´»åŠ¨å¼€å§‹å‰ï¼Œå°†å•†å“åº“å­˜åŒæ­¥åˆ° Redisï¼šSET stock:sku:1001 50ã€‚ </p>
</li>
<li><p>ç”¨æˆ·ä¸‹å•æ—¶ï¼Œæ‰§è¡Œï¼šDECR stock:sku:1001ã€‚ </p>
</li>
<li><p>å¦‚æœè¿”å›å€¼ &gt;&#x3D; 0ï¼Œæ”¾è¡Œå»å†™è®¢å•ï¼›å¦‚æœè¿”å›å€¼ &lt; 0ï¼Œç«‹å³è¿”å›â€œå·²å”®ç½„â€ã€‚</p>
</li>
<li><p>ä¼˜åŠ¿ï¼š å†…å­˜çº§æ“ä½œï¼Œå•æœºå¯æ”¯æ’‘ 10w+ TPSï¼Œå½»åº•æœç»è¶…å–ã€‚</p>
</li>
<li><p>é«˜é¢‘é™æµï¼ˆé˜²åˆ·ä¸é£æ§ï¼‰</p>
</li>
</ol>
<ul>
<li>é€»è¾‘ï¼š <ol>
<li>Key ä¸º limit:user:{uid}:api:{api_name}ã€‚ </li>
<li>æ¯æ¬¡è¯·æ±‚æ‰§è¡Œ INCRã€‚ </li>
<li>å¦‚æœæ˜¯é¦–æ¬¡è°ƒç”¨ï¼ˆè¿”å› 1ï¼‰ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ EXPIRE 60ï¼ˆå³ 1 åˆ†é’Ÿé™æµï¼‰ã€‚ </li>
<li>å¦‚æœè¿”å›å€¼è¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ 100ï¼‰ï¼Œç›´æ¥æ‹’ç»è¯·æ±‚ã€‚</li>
</ol>
</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const bookNormalStockScript = `</span><br><span class="line"><span class="keyword">local</span> key = KEYS[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">local</span> book_num = <span class="built_in">tonumber</span>(ARGV[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">local</span> platform = <span class="built_in">tonumber</span>(ARGV[<span class="number">2</span>]) <span class="keyword">or</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> normal_stock = <span class="built_in">tonumber</span>(redis.call(<span class="string">&quot;HGET&quot;</span>, key, <span class="string">&quot;0&quot;</span>)) <span class="keyword">or</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> book_num &gt; normal_stock <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">redis.call(<span class="string">&quot;hincrby&quot;</span>, key, <span class="string">&quot;0&quot;</span>, -book_num)</span><br><span class="line">redis.call(<span class="string">&quot;HINCRBY&quot;</span>, key, <span class="string">&quot;booking&quot;</span>, book_num)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> normal_stock - book_num</span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<h3 id="ZSet-ä½¿ç”¨åœºæ™¯"><a href="#ZSet-ä½¿ç”¨åœºæ™¯" class="headerlink" title="ZSet ä½¿ç”¨åœºæ™¯"></a>ZSet ä½¿ç”¨åœºæ™¯</h3><h3 id="List-ä½¿ç”¨åœºæ™¯"><a href="#List-ä½¿ç”¨åœºæ™¯" class="headerlink" title="List ä½¿ç”¨åœºæ™¯"></a>List ä½¿ç”¨åœºæ™¯</h3><ol>
<li>åœ¨ç§’æ€ç¬é—´ï¼Œç”±äºæµé‡è¿œè¶…æ•°æ®åº“æ‰¿å—èƒ½åŠ›ï¼Œå…ˆå°†è¯·æ±‚â€œé˜Ÿåˆ—åŒ–â€ã€‚</li>
</ol>
<ul>
<li>æ“ä½œï¼š ç”¨æˆ·çš„è¯·æ±‚åˆ°è¾¾åï¼Œé€šè¿‡ LPUSH å‹å…¥ä¸€ä¸ªæ’é˜Ÿåˆ— seckill:queue:product_idã€‚</li>
<li>å¤„ç†ï¼š åå°å¼€å¯å›ºå®šæ•°é‡çš„ Worker è¿›ç¨‹ï¼Œé€šè¿‡ RPOP æˆ– BRPOP è·å–è¯·æ±‚è¿›è¡Œåç»­å‡åº“å­˜æ“ä½œã€‚</li>
<li>ä¼˜åŠ¿ï¼š å‰Šå³°å¡«è°·ï¼Œä¿æŠ¤åç«¯æ ¸å¿ƒç³»ç»Ÿ</li>
</ul>
<ol start="2">
<li><p>æµè§ˆæœ€è¿‘æŸ¥çœ‹çš„å•†å“ï¼ˆTop 10ï¼‰ å¦‚æœä½ åœ¨å•†åŸè¯¦æƒ…é¡µä¸‹æ–¹å±•ç¤ºâ€œæœ€è¿‘æŸ¥çœ‹â€ï¼Œä½ å¯èƒ½éœ€è¦å…ˆè¯»å–å‰ 10 ä¸ªæ˜¾ç¤ºç»™ç”¨æˆ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 1. å…ˆè¯»å–å‰ 10 ä¸ªç»™å‰ç«¯å±•ç¤ºï¼Œä¸åˆ é™¤</span><br><span class="line">products, _ := rdb.LRange(ctx, &quot;user:history:123&quot;, 0, 9).Result()</span><br><span class="line"></span><br><span class="line">// 2. å¦‚æœç”¨æˆ·ç‚¹å¼€äº†æŸä¸ªå•†å“ï¼Œä½ å†å¾€é‡ŒåŠ ï¼Œå¹¶è£å‰ª</span><br><span class="line">pipe := rdb.Pipeline()</span><br><span class="line">pipe.LPush(ctx, &quot;user:history:123&quot;, &quot;new_product_id&quot;)</span><br><span class="line">pipe.LTrim(ctx, &quot;user:history:123&quot;, 0, 9) // åªä¿ç•™æœ€æ–°çš„10ä¸ª</span><br><span class="line">pipe.Exec(ctx)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼“å­˜æ•°æ®ï¼ˆdbï¼Œservice) çš„æ•°æ®ï¼Œæé«˜è®¿é—®æ•ˆç‡</p>
<ul>
<li>ç¼“å­˜å®¹é‡è¯„ä¼°</li>
<li>ç¼“å­˜è¿‡æœŸæœºåˆ¶ï¼Œæ—¶é—´</li>
<li>ç¼“å­˜missï¼Œæº¯æºå’Œç›‘æ§</li>
<li>ç¼“å­˜é›ªå´©,å¤§é¢ç§¯keyå¤±æ•ˆDBä¿æŠ¤ã€‚</li>
<li>ç¼“å­˜å‡»ç©¿ï¼šçƒ­keyå‡»ç©¿ä¿æŠ¤</li>
<li>ç¼“å­˜ç©¿é€ï¼šæ— æ•ˆkeyå‡»ç©¿DBä¿æŠ¤</li>
<li>ç¼“å­˜æ›´æ–°å’Œä¸€è‡´æ€§é—®é¢˜</li>
<li>ç¼“å­˜çƒ­keyå’Œå¤§keyé—®é¢˜</li>
</ul>
</li>
<li><p>é™æµå’Œè®¡æ•°ã€‚luaè„šæœ¬ã€‚ï¼ˆint,incr,luaï¼‰</p>
<ul>
<li>è®¡æ•°å™¨ ï¼ˆä¸´ç•Œå€¼å’Œfrozen)</li>
<li>token ï¼ˆå¸¸ç”¨ï¼‰</li>
<li>æ¼æ¡¶ï¼ˆå¹³æ»‘ï¼‰</li>
<li>åŸºäºredisçš„åˆ†å¸ƒå¼é™æµï¼š<a href="https://pandaychen.github.io/2020/09/21/A-DISTRIBUTE-GOREDIS-RATELIMITER-ANALYSIS/">https://pandaychen.github.io/2020/09/21/A-DISTRIBUTE-GOREDIS-RATELIMITER-ANALYSIS/</a></li>
<li><a href="https://blog.csdn.net/crazymakercircle/article/details/130035504">https://blog.csdn.net/crazymakercircle/article/details/130035504</a></li>
</ul>
</li>
<li><p>å»¶æ—¶é˜Ÿåˆ—</p>
<ul>
<li>ä½¿ç”¨ ZSET+ å®šæ—¶è½®è¯¢çš„æ–¹å¼å®ç°å»¶æ—¶é˜Ÿåˆ—æœºåˆ¶ï¼Œä»»åŠ¡é›†åˆè®°ä¸º taskGroupKey</li>
<li>ç”Ÿæˆä»»åŠ¡ä»¥ å½“å‰æ—¶é—´æˆ³ ä¸ å»¶æ—¶æ—¶é—´ ç›¸åŠ åå¾—åˆ°ä»»åŠ¡çœŸæ­£çš„è§¦å‘æ—¶é—´ï¼Œè®°ä¸º time1ï¼Œä»»åŠ¡çš„ uuid å³ä¸º taskidï¼Œå½“å‰æ—¶é—´æˆ³è®°ä¸º curTime</li>
<li>ä½¿ç”¨ ZADD taskGroupKey time1 taskid å°†ä»»åŠ¡å†™å…¥ ZSET</li>
<li>ä¸»é€»è¾‘ä¸æ–­ä»¥è½®è¯¢æ–¹å¼ ZRANGE taskGroupKey curTime MAXTIME withscores è·å– [curTime,MAXTIME) ä¹‹é—´çš„ä»»åŠ¡ï¼Œè®°ä¸ºå·²ç»åˆ°æœŸçš„å»¶æ—¶ä»»åŠ¡ï¼ˆé›†ï¼‰</li>
<li>å¤„ç†å»¶æ—¶ä»»åŠ¡ï¼Œå¤„ç†å®Œæˆååˆ é™¤å³å¯</li>
<li>ä¿å­˜å½“å‰æ—¶é—´æˆ³ curTimeï¼Œä½œä¸ºä¸‹ä¸€æ¬¡è½®è¯¢æ—¶çš„ ZRANGE æŒ‡ä»¤çš„èŒƒå›´èµ·ç‚¹</li>
<li><a href="https://github.com/bitleak/lmstfy">https://github.com/bitleak/lmstfy</a></li>
</ul>
</li>
<li><p>æ¶ˆæ¯é˜Ÿåˆ—</p>
<ul>
<li>redis æ”¯æŒ List æ•°æ®ç»“æ„ï¼Œæœ‰æ—¶ä¹Ÿä¼šå……å½“æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä½¿ç”¨ç”Ÿäº§è€…ï¼šLPUSHï¼›æ¶ˆè´¹è€…ï¼šRBPOP æˆ– RPOP æ¨¡æ‹Ÿé˜Ÿåˆ—</li>
</ul>
</li>
<li><p>åˆ†å¸ƒå¼é”ï¼š<a href="https://juejin.cn/post/6936956908007850014">https://juejin.cn/post/6936956908007850014</a></p>
</li>
<li><p>bloomfilter: <a href="https://juejin.cn/post/6844903862072000526">https://juejin.cn/post/6844903862072000526</a></p>
<p>   $m &#x3D; -\frac{nln(p)}{(ln2)^2}$</p>
<p>   $k&#x3D;\frac{m}{n}ln(2)$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n æ˜¯é¢„æœŸæ’å…¥çš„å…ƒç´ æ•°é‡ï¼ˆæ•°æ®è§„æ¨¡ï¼‰ï¼Œä¾‹å¦‚ 20,000,000ã€‚</span><br><span class="line">p æ˜¯é¢„æœŸçš„è¯¯åˆ¤ç‡ï¼Œä¾‹å¦‚ 0.001ã€‚</span><br><span class="line">m æ˜¯ä½æ•°ç»„çš„å¤§å°ã€‚</span><br><span class="line">k æ˜¯å“ˆå¸Œå‡½æ•°çš„æ•°é‡ã€‚</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ-1"><a href="#äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ-1" class="headerlink" title="äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ"></a>äºŒã€æ•°æ®ç»“æ„æ·±åº¦å‰–æ</h2><blockquote>
<p>æ·±å…¥ç†è§£ Redis äº”ç§æ•°æ®ç±»å‹çš„åº•å±‚å®ç°åŸç†ï¼ŒæŒæ¡å†…å­˜ä¼˜åŒ–æŠ€å·§ã€‚</p>
</blockquote>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/6844904192042074126">Redis äº”ç§æ•°æ®ç±»å‹åº•å±‚ç»“æ„è¯¦è§£</a></li>
<li><a href="http://redisbook.com/">Redis è®¾è®¡ä¸å®ç°</a></li>
</ul>
<hr>
<h3 id="Hash-åº•å±‚å®ç°åŸç†è¯¦è§£"><a href="#Hash-åº•å±‚å®ç°åŸç†è¯¦è§£" class="headerlink" title="Hash åº•å±‚å®ç°åŸç†è¯¦è§£"></a>Hash åº•å±‚å®ç°åŸç†è¯¦è§£</h3><p>Redis Hash é‡‡ç”¨<strong>ä¸¤ç§ç¼–ç æ–¹å¼</strong>ï¼Œæ ¹æ®æ•°æ®ç‰¹å¾è‡ªåŠ¨é€‰æ‹©ï¼š</p>
<h4 id="1-ç¼–ç é€‰æ‹©ç­–ç•¥"><a href="#1-ç¼–ç é€‰æ‹©ç­–ç•¥" class="headerlink" title="1. ç¼–ç é€‰æ‹©ç­–ç•¥"></a>1. ç¼–ç é€‰æ‹©ç­–ç•¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    A[åˆ›å»ºHash] --&gt; B&#123;å…ƒç´ æ•°&lt;=512 ä¸” å€¼é•¿åº¦&lt;=64B?&#125;</span><br><span class="line">    B --&gt;|æ˜¯| C[ziplist å‹ç¼©åˆ—è¡¨]</span><br><span class="line">    B --&gt;|å¦| D[hashtable å“ˆå¸Œè¡¨]</span><br><span class="line">    C --&gt;|è¶…è¿‡é˜ˆå€¼| D</span><br><span class="line">    </span><br><span class="line">    style C fill:#e8f5e9</span><br><span class="line">    style D fill:#e1f5fe</span><br></pre></td></tr></table></figure>

<p><strong>é…ç½®å‚æ•°ï¼ˆredis.confï¼‰ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hash-max-ziplist-entries 512   # æœ€å¤§å…ƒç´ ä¸ªæ•°</span><br><span class="line">hash-max-ziplist-value 64       # å•ä¸ªvalueæœ€å¤§é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</span><br></pre></td></tr></table></figure>

<h4 id="2-ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰-å†…å­˜ä¼˜åŒ–"><a href="#2-ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰-å†…å­˜ä¼˜åŒ–" class="headerlink" title="2. ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰- å†…å­˜ä¼˜åŒ–"></a>2. ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰- å†…å­˜ä¼˜åŒ–</h4><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå°å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚å•†å“è¯¦æƒ…ã€Sessionã€å°å‹ Listï¼‰</p>
<p>ziplist æ˜¯ Redis ä¸ºèŠ‚çœå†…å­˜è®¾è®¡çš„<strong>ç´§å‡‘å‹æ•°æ®ç»“æ„</strong>ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨<strong>ä¸€å—è¿ç»­çš„å†…å­˜</strong>ä¸­ã€‚</p>
<h5 id="2-1-æ•´ä½“ç»“æ„"><a href="#2-1-æ•´ä½“ç»“æ„" class="headerlink" title="2.1 æ•´ä½“ç»“æ„"></a>2.1 æ•´ä½“ç»“æ„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+----------+----------+--------+---------+---------+-----+---------+--------+</span><br><span class="line">| zlbytes  | zltail   | zllen  | entry1  | entry2  | ... | entryN  | zlend  |</span><br><span class="line">+----------+----------+--------+---------+---------+-----+---------+--------+</span><br><span class="line">  4å­—èŠ‚      4å­—èŠ‚      2å­—èŠ‚    å˜é•¿      å˜é•¿            å˜é•¿      1å­—èŠ‚</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>é•¿åº¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>zlbytes</strong></td>
<td>4 å­—èŠ‚</td>
<td>æ•´ä¸ª ziplist å ç”¨çš„æ€»å­—èŠ‚æ•°ï¼ˆåŒ…æ‹¬ zlbytes è‡ªèº«ï¼‰</td>
</tr>
<tr>
<td><strong>zltail</strong></td>
<td>4 å­—èŠ‚</td>
<td>åˆ°å°¾èŠ‚ç‚¹çš„åç§»é‡ï¼ˆç”¨äºå¿«é€Ÿå®šä½å°¾éƒ¨ï¼Œæ”¯æŒåå‘éå†ï¼‰</td>
</tr>
<tr>
<td><strong>zllen</strong></td>
<td>2 å­—èŠ‚</td>
<td>èŠ‚ç‚¹æ•°é‡ï¼Œæœ€å¤§ 65535ï¼›è¶…è¿‡åˆ™éœ€éå†æ•´ä¸ªåˆ—è¡¨è®¡æ•°</td>
</tr>
<tr>
<td><strong>entry</strong></td>
<td>å˜é•¿</td>
<td>å®é™…æ•°æ®èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹é•¿åº¦ä¸å›ºå®š</td>
</tr>
<tr>
<td><strong>zlend</strong></td>
<td>1 å­—èŠ‚</td>
<td>å›ºå®šä¸º <code>0xFF</code>ï¼Œæ ‡è®° ziplist ç»“æŸ</td>
</tr>
</tbody></table>
<h5 id="2-2-Entry-èŠ‚ç‚¹è¯¦ç»†ç»“æ„ï¼ˆä¸‰éƒ¨åˆ†ï¼‰"><a href="#2-2-Entry-èŠ‚ç‚¹è¯¦ç»†ç»“æ„ï¼ˆä¸‰éƒ¨åˆ†ï¼‰" class="headerlink" title="2.2 Entry èŠ‚ç‚¹è¯¦ç»†ç»“æ„ï¼ˆä¸‰éƒ¨åˆ†ï¼‰"></a>2.2 Entry èŠ‚ç‚¹è¯¦ç»†ç»“æ„ï¼ˆä¸‰éƒ¨åˆ†ï¼‰</h5><p>æ¯ä¸ª entry ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+----------+----------+----------+</span><br><span class="line">| prevlen  | encoding | content  |</span><br><span class="line">+----------+----------+----------+</span><br><span class="line">  1æˆ–5å­—èŠ‚   1-5å­—èŠ‚    å˜é•¿</span><br></pre></td></tr></table></figure>

<h6 id="Part-1-prevlenï¼ˆå‰ä¸€èŠ‚ç‚¹é•¿åº¦ï¼‰"><a href="#Part-1-prevlenï¼ˆå‰ä¸€èŠ‚ç‚¹é•¿åº¦ï¼‰" class="headerlink" title="Part 1: prevlenï¼ˆå‰ä¸€èŠ‚ç‚¹é•¿åº¦ï¼‰"></a><strong>Part 1: prevlenï¼ˆå‰ä¸€èŠ‚ç‚¹é•¿åº¦ï¼‰</strong></h6><p>è®°å½•<strong>å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦</strong>ï¼Œç”¨äº<strong>ä»åå‘å‰éå†</strong>ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–ç è§„åˆ™</span></span><br><span class="line"><span class="keyword">if</span> (å‰ä¸€èŠ‚ç‚¹é•¿åº¦ &lt; <span class="number">254</span> å­—èŠ‚) &#123;</span><br><span class="line">    prevlen = <span class="number">1</span> å­—èŠ‚      <span class="comment">// ç›´æ¥å­˜å‚¨é•¿åº¦å€¼</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    prevlen = <span class="number">5</span> å­—èŠ‚      <span class="comment">// ç¬¬1å­—èŠ‚=0xFEï¼Œå4å­—èŠ‚å­˜å®é™…é•¿åº¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>å‰ä¸€èŠ‚ç‚¹ 10 å­—èŠ‚ â†’ <code>prevlen = 0x0A</code>ï¼ˆ1å­—èŠ‚ï¼‰</li>
<li>å‰ä¸€èŠ‚ç‚¹ 300 å­—èŠ‚ â†’ <code>prevlen = 0xFE 0x00 0x00 0x01 0x2C</code>ï¼ˆ5å­—èŠ‚ï¼‰</li>
</ul>
<h6 id="Part-2-encodingï¼ˆç¼–ç ç±»å‹ï¼‰"><a href="#Part-2-encodingï¼ˆç¼–ç ç±»å‹ï¼‰" class="headerlink" title="Part 2: encodingï¼ˆç¼–ç ç±»å‹ï¼‰"></a><strong>Part 2: encodingï¼ˆç¼–ç ç±»å‹ï¼‰</strong></h6><p>è®°å½• <strong>content çš„æ•°æ®ç±»å‹å’Œé•¿åº¦</strong>ï¼ŒRedis ä½¿ç”¨å˜é•¿ç¼–ç èŠ‚çœç©ºé—´ã€‚</p>
<p><strong>å­—ç¬¦ä¸²ç¼–ç </strong>ï¼ˆå‰ 2 ä½æ ‡è¯†ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>ç¼–ç æ ¼å¼</th>
<th>è¯´æ˜</th>
<th>é•¿åº¦èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td><code>00pppppp</code></td>
<td>1å­—èŠ‚ï¼Œå6ä½å­˜é•¿åº¦</td>
<td>0 - 63 å­—èŠ‚</td>
</tr>
<tr>
<td><code>01pppppp qqqqqqqq</code></td>
<td>2å­—èŠ‚ï¼Œ14ä½å­˜é•¿åº¦</td>
<td>64 - 16383 å­—èŠ‚</td>
</tr>
<tr>
<td><code>10______ [4å­—èŠ‚]</code></td>
<td>5å­—èŠ‚ï¼Œåç»­4å­—èŠ‚å­˜é•¿åº¦</td>
<td>&gt; 16383 å­—èŠ‚</td>
</tr>
</tbody></table>
<p><strong>æ•´æ•°ç¼–ç </strong>ï¼ˆå‰ 2 ä½ä¸º <code>11</code>ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>ç¼–ç å€¼</th>
<th>è¯´æ˜</th>
<th>æ•°æ®é•¿åº¦</th>
</tr>
</thead>
<tbody><tr>
<td><code>11000000</code></td>
<td>int16_t</td>
<td>2 å­—èŠ‚</td>
</tr>
<tr>
<td><code>11010000</code></td>
<td>int32_t</td>
<td>4 å­—èŠ‚</td>
</tr>
<tr>
<td><code>11100000</code></td>
<td>int64_t</td>
<td>8 å­—èŠ‚</td>
</tr>
<tr>
<td><code>11110000</code></td>
<td>24 ä½æ•´æ•°</td>
<td>3 å­—èŠ‚</td>
</tr>
<tr>
<td><code>11111110</code></td>
<td>8 ä½æ•´æ•°</td>
<td>1 å­—èŠ‚</td>
</tr>
<tr>
<td><code>1111xxxx</code></td>
<td>0-12 çš„æ•´æ•°ç›´æ¥ç¼–ç åœ¨å4ä½</td>
<td><strong>0 å­—èŠ‚</strong>ï¼ˆæ—  contentï¼‰</td>
</tr>
</tbody></table>
<h6 id="Part-3-contentï¼ˆå®é™…æ•°æ®ï¼‰"><a href="#Part-3-contentï¼ˆå®é™…æ•°æ®ï¼‰" class="headerlink" title="Part 3: contentï¼ˆå®é™…æ•°æ®ï¼‰"></a><strong>Part 3: contentï¼ˆå®é™…æ•°æ®ï¼‰</strong></h6><p>å­˜å‚¨å®é™…çš„æ•°æ®å†…å®¹ï¼Œæ ¹æ® <code>encoding</code> å­—æ®µè§£æï¼š</p>
<ul>
<li><strong>å­—ç¬¦ä¸²</strong>ï¼šåŸå§‹å­—èŠ‚æ•°ç»„</li>
<li><strong>æ•´æ•°</strong>ï¼šäºŒè¿›åˆ¶æ•´æ•°ï¼ˆå°ç«¯åºï¼‰</li>
</ul>
<h5 id="2-3-å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹"><a href="#2-3-å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹" class="headerlink" title="2.3 å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹"></a>2.3 å®é™…å†…å­˜å¸ƒå±€ç¤ºä¾‹</h5><p>å­˜å‚¨ Hashï¼š<code>&#123;name: &quot;iPhone&quot;, price: 5999&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">åç§» | å­—æ®µ        | å€¼                  | è¯´æ˜</span><br><span class="line">-----|------------|---------------------|------------------</span><br><span class="line">0-3  | zlbytes    | 0x0000003F (63)     | æ€»å¤§å° 63 å­—èŠ‚</span><br><span class="line">4-7  | zltail     | 0x00000035 (53)     | å°¾èŠ‚ç‚¹åç§» 53</span><br><span class="line">8-9  | zllen      | 0x0004 (4)          | 4ä¸ªèŠ‚ç‚¹ï¼ˆ2 field + 2 valueï¼‰</span><br><span class="line"></span><br><span class="line">10   | prevlen    | 0x00                | ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">11   | encoding   | 0x04                | å­—ç¬¦ä¸²é•¿åº¦ 4</span><br><span class="line">12-15| content    | &quot;name&quot;              | field</span><br><span class="line">     | (å…± 6 å­—èŠ‚)</span><br><span class="line"></span><br><span class="line">16   | prevlen    | 0x06                | å‰ä¸€èŠ‚ç‚¹ 6 å­—èŠ‚</span><br><span class="line">17   | encoding   | 0x06                | å­—ç¬¦ä¸²é•¿åº¦ 6</span><br><span class="line">18-23| content    | &quot;iPhone&quot;            | value</span><br><span class="line">     | (å…± 8 å­—èŠ‚)</span><br><span class="line"></span><br><span class="line">24   | prevlen    | 0x08                | å‰ä¸€èŠ‚ç‚¹ 8 å­—èŠ‚</span><br><span class="line">25   | encoding   | 0x05                | å­—ç¬¦ä¸²é•¿åº¦ 5</span><br><span class="line">26-30| content    | &quot;price&quot;             | field</span><br><span class="line">     | (å…± 7 å­—èŠ‚)</span><br><span class="line"></span><br><span class="line">31   | prevlen    | 0x07                | å‰ä¸€èŠ‚ç‚¹ 7 å­—èŠ‚</span><br><span class="line">32   | encoding   | 0xC0                | int16_t</span><br><span class="line">33-34| content    | 0x176F (5999)       | valueï¼ˆæ•´æ•°ä¼˜åŒ–ï¼‰</span><br><span class="line">     | (å…± 4 å­—èŠ‚)</span><br><span class="line"></span><br><span class="line">35   | zlend      | 0xFF                | ç»“æŸæ ‡è®°</span><br></pre></td></tr></table></figure>

<p><strong>å†…å­˜è®¡ç®—</strong>ï¼š10ï¼ˆå¤´ï¼‰+ 6 + 8 + 7 + 4 + 1ï¼ˆå°¾ï¼‰&#x3D; <strong>36 å­—èŠ‚</strong></p>
<h5 id="2-4-éå†æœºåˆ¶"><a href="#2-4-éå†æœºåˆ¶" class="headerlink" title="2.4 éå†æœºåˆ¶"></a>2.4 éå†æœºåˆ¶</h5><p><strong>æ­£å‘éå†ï¼ˆä»å¤´åˆ°å°¾ï¼‰</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ptr = ziplist + <span class="number">10</span>;  <span class="comment">// è·³è¿‡å¤´éƒ¨</span></span><br><span class="line"><span class="keyword">while</span> (*ptr != <span class="number">0xFF</span>) &#123;</span><br><span class="line">    <span class="comment">// è§£æ encodingï¼Œè®¡ç®—èŠ‚ç‚¹é•¿åº¦</span></span><br><span class="line">    node_len = prevlen_size + encoding_size + content_size;</span><br><span class="line">    ptr += node_len;  <span class="comment">// è·³åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åå‘éå†ï¼ˆä»å°¾åˆ°å¤´ï¼‰</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ptr = ziplist + zltail;  <span class="comment">// ç›´æ¥å®šä½å°¾èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">while</span> (ptr &gt; ziplist + <span class="number">10</span>) &#123;</span><br><span class="line">    prevlen = parse_prevlen(ptr);  <span class="comment">// è¯»å– prevlen</span></span><br><span class="line">    ptr -= prevlen;  <span class="comment">// è·³åˆ°å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-5-è¿é”æ›´æ–°é—®é¢˜ï¼ˆCascade-Updateï¼‰"><a href="#2-5-è¿é”æ›´æ–°é—®é¢˜ï¼ˆCascade-Updateï¼‰" class="headerlink" title="2.5 è¿é”æ›´æ–°é—®é¢˜ï¼ˆCascade Updateï¼‰"></a>2.5 è¿é”æ›´æ–°é—®é¢˜ï¼ˆCascade Updateï¼‰</h5><p><strong>é—®é¢˜</strong>ï¼šæ’å…¥&#x2F;åˆ é™¤èŠ‚ç‚¹å¯èƒ½å¯¼è‡´åç»­èŠ‚ç‚¹çš„ <code>prevlen</code> å­—æ®µé•¿åº¦å˜åŒ–ã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹çŠ¶æ€ï¼š[253B] [253B] [253B]</span><br><span class="line">          æ¯ä¸ªèŠ‚ç‚¹çš„ prevlen å  1 å­—èŠ‚</span><br><span class="line"></span><br><span class="line">æ’å…¥å¤§èŠ‚ç‚¹ï¼š[253B] [260B] [???] [???]</span><br><span class="line">                     â†‘</span><br><span class="line">          å‰ä¸€èŠ‚ç‚¹å˜ä¸º 260 å­—èŠ‚ (&gt;254)</span><br><span class="line">          å½“å‰èŠ‚ç‚¹çš„ prevlen éœ€ä» 1 å­—èŠ‚æ‰©å±•ä¸º 5 å­—èŠ‚</span><br><span class="line">          å½“å‰èŠ‚ç‚¹é•¿åº¦ä» 253 â†’ 257 å­—èŠ‚</span><br><span class="line">          ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ prevlen ä¹Ÿéœ€æ‰©å±•...</span><br></pre></td></tr></table></figure>

<p><strong>å½±å“</strong>ï¼š</p>
<ul>
<li><strong>æœ€åæ—¶é—´å¤æ‚åº¦</strong>ï¼šO(nÂ²)ï¼ˆæ‰€æœ‰èŠ‚ç‚¹è¿é”æ›´æ–°ï¼‰</li>
<li><strong>å†…å­˜é‡åˆ†é…</strong>ï¼šè¿ç»­çš„ <code>realloc</code> æ“ä½œ</li>
<li><strong>å®é™…æ¦‚ç‡</strong>ï¼šæä½ï¼ˆéœ€è¦å¤§é‡èŠ‚ç‚¹åˆšå¥½åœ¨ 254 å­—èŠ‚è¾¹ç•Œï¼‰</li>
</ul>
<p><strong>Redis ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>é¢„å…ˆæ£€æŸ¥æ˜¯å¦ä¼šè§¦å‘è¿é”æ›´æ–°</li>
<li>ä¸€æ¬¡æ€§åˆ†é…è¶³å¤Ÿå†…å­˜ï¼Œå‡å°‘ <code>realloc</code> æ¬¡æ•°</li>
</ul>
<h5 id="2-6-ç¼–ç ç¤ºä¾‹ï¼ˆGo-ä»£ç ï¼‰"><a href="#2-6-ç¼–ç ç¤ºä¾‹ï¼ˆGo-ä»£ç ï¼‰" class="headerlink" title="2.6 ç¼–ç ç¤ºä¾‹ï¼ˆGo ä»£ç ï¼‰"></a>2.6 ç¼–ç ç¤ºä¾‹ï¼ˆGo ä»£ç ï¼‰</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šå­—ç¬¦ä¸² &quot;hello&quot; çš„ encoding</span></span><br><span class="line"><span class="comment">// é•¿åº¦ 5 &lt; 63ï¼Œä½¿ç”¨ 00pppppp æ ¼å¼</span></span><br><span class="line">encoding := <span class="number">0</span>b00000101  <span class="comment">// 0x05</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šæ•´æ•° 100 çš„ encoding</span></span><br><span class="line"><span class="comment">// èŒƒå›´åœ¨ int16 å†…ï¼Œä½¿ç”¨ 11000000</span></span><br><span class="line">encoding := <span class="number">0</span>b11000000  <span class="comment">// 0xC0</span></span><br><span class="line">content := []<span class="type">byte</span>&#123;<span class="number">0x64</span>, <span class="number">0x00</span>&#125;  <span class="comment">// å°ç«¯åº 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹ï¼šæ•´æ•° 12 çš„ encoding</span></span><br><span class="line"><span class="comment">// 0-12 ç›´æ¥ç¼–ç åœ¨ encoding ä¸­</span></span><br><span class="line">encoding := <span class="number">0</span>b11111100  <span class="comment">// 0xFCï¼Œå4ä½ 1100 = 12</span></span><br><span class="line"><span class="comment">// æ— éœ€ content å­—æ®µï¼</span></span><br></pre></td></tr></table></figure>

<h5 id="2-7-ä¼˜åŠ¿ä¸é™åˆ¶"><a href="#2-7-ä¼˜åŠ¿ä¸é™åˆ¶" class="headerlink" title="2.7 ä¼˜åŠ¿ä¸é™åˆ¶"></a>2.7 ä¼˜åŠ¿ä¸é™åˆ¶</h5><p><strong>âœ… ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å†…å­˜é«˜æ•ˆ</strong>ï¼šæ— æŒ‡é’ˆå¼€é”€ï¼Œç´§å‡‘å­˜å‚¨<ul>
<li>å¯¹æ¯”é“¾è¡¨ï¼šæ¯ä¸ªèŠ‚ç‚¹çœ 16 å­—èŠ‚ï¼ˆprev + next æŒ‡é’ˆï¼‰</li>
</ul>
</li>
<li><strong>CPU ç¼“å­˜å‹å¥½</strong>ï¼šè¿ç»­å†…å­˜ï¼Œé¢„è¯»ä¼˜åŒ–</li>
<li><strong>æ™ºèƒ½ç¼–ç </strong>ï¼šæ•´æ•°å‹ç¼©ã€å˜é•¿å­˜å‚¨</li>
<li><strong>åŒå‘éå†</strong>ï¼šé€šè¿‡ <code>zltail</code> å’Œ <code>prevlen</code> å®ç°</li>
</ul>
<p><strong>âŒ é™åˆ¶</strong>ï¼š</p>
<ul>
<li><strong>æŸ¥æ‰¾æ…¢</strong>ï¼šO(n) é¡ºåºéå†ï¼Œä¸é€‚åˆå¤§æ•°æ®</li>
<li><strong>è¿é”æ›´æ–°</strong>ï¼šæœ€å O(nÂ²)ï¼ˆå®é™…å¾ˆå°‘å‘ç”Ÿï¼‰</li>
<li><strong>å†…å­˜é‡åˆ†é…</strong>ï¼šæ’å…¥&#x2F;åˆ é™¤éœ€ <code>realloc</code></li>
<li><strong>é»˜è®¤é˜ˆå€¼</strong>ï¼š<ul>
<li>Hash: 512 entries</li>
<li>List: 512 entries</li>
<li>ZSet: 128 entries</li>
</ul>
</li>
</ul>
<h5 id="2-8-åº”ç”¨åœºæ™¯æ€»ç»“"><a href="#2-8-åº”ç”¨åœºæ™¯æ€»ç»“" class="headerlink" title="2.8 åº”ç”¨åœºæ™¯æ€»ç»“"></a>2.8 åº”ç”¨åœºæ™¯æ€»ç»“</h5><table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>ä½¿ç”¨ ziplist æ¡ä»¶</th>
<th>å…¸å‹åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Hash</strong></td>
<td>entries â‰¤ 512, value â‰¤ 64B</td>
<td>å•†å“åŸºç¡€ä¿¡æ¯ã€ç”¨æˆ· Session</td>
</tr>
<tr>
<td><strong>List</strong></td>
<td>entries â‰¤ 512</td>
<td>æ¶ˆæ¯é˜Ÿåˆ—ã€æµè§ˆå†å²</td>
</tr>
<tr>
<td><strong>ZSet</strong></td>
<td>entries â‰¤ 128, member â‰¤ 64B</td>
<td>å°å‹æ’è¡Œæ¦œã€ä¼˜å…ˆé˜Ÿåˆ—</td>
</tr>
</tbody></table>
<p><strong>ç›‘æ§å‘½ä»¤</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹ç¼–ç ç±»å‹</span></span><br><span class="line">redis&gt; OBJECT ENCODING mykey</span><br><span class="line"><span class="string">&quot;ziplist&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†…å­˜å ç”¨</span></span><br><span class="line">redis&gt; MEMORY USAGE mykey</span><br><span class="line">(<span class="built_in">integer</span>) 184</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ ziplist è¯¦ç»†ä¿¡æ¯ï¼ˆDEBUG å‘½ä»¤ï¼‰</span></span><br><span class="line">redis&gt; DEBUG OBJECT mykey</span><br><span class="line">Value at:0x7f8a9c0a0a00 refcount:1 encoding:ziplist serializedlength:48</span><br></pre></td></tr></table></figure>

<h4 id="3-hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰-æ€§èƒ½ä¼˜åŒ–"><a href="#3-hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="3. hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰- æ€§èƒ½ä¼˜åŒ–"></a>3. hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰- æ€§èƒ½ä¼˜åŒ–</h4><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤§é‡å­—æ®µæˆ–éœ€è¦å¿«é€ŸæŸ¥æ‰¾</p>
<p><strong>æ ¸å¿ƒç»“æ„</strong>ï¼šç»å…¸æ‹‰é“¾æ³•å“ˆå¸Œè¡¨</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redis å­—å…¸ç»“æ„ï¼ˆdictï¼‰</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dict</span> &#123;</span></span><br><span class="line">    dictht ht[<span class="number">2</span>];        <span class="comment">// ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œht[1] ç”¨äº rehash</span></span><br><span class="line">    <span class="type">long</span> rehashidx;      <span class="comment">// rehash è¿›åº¦ï¼Œ-1 è¡¨ç¤ºæœªè¿›è¡Œ</span></span><br><span class="line">&#125; dict;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“ˆå¸Œè¡¨ç»“æ„ï¼ˆdicthtï¼‰</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictht</span> &#123;</span></span><br><span class="line">    dictEntry **table;   <span class="comment">// å“ˆå¸Œè¡¨æ•°ç»„ï¼ˆæŒ‡é’ˆæ•°ç»„ï¼‰</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> size;  <span class="comment">// å¤§å°ï¼ˆ2çš„å¹‚æ¬¡æ–¹ï¼‰</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> used;  <span class="comment">// å·²æœ‰èŠ‚ç‚¹æ•°</span></span><br><span class="line">&#125; dictht;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“ˆå¸ŒèŠ‚ç‚¹ï¼ˆdictEntryï¼‰</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> &#123;</span></span><br><span class="line">    <span class="type">void</span> *key;           <span class="comment">// é”®</span></span><br><span class="line">    <span class="type">void</span> *value;         <span class="comment">// å€¼</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> *<span class="title">next</span>;</span>  <span class="comment">// é“¾è¡¨æŒ‡é’ˆï¼ˆè§£å†³å†²çªï¼‰</span></span><br><span class="line">&#125; dictEntry;</span><br></pre></td></tr></table></figure>

<p><strong>å¯è§†åŒ–ç»“æ„</strong>ï¼šè¯¦è§ <a href="/diagrams/mermaid/redis-hashtable.mmd">redis-hashtable.mmd</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dict</span><br><span class="line">â”œâ”€â”€ ht[0] (ä¸»å“ˆå¸Œè¡¨)</span><br><span class="line">â”‚   â”œâ”€â”€ table[0] â†’ NULL</span><br><span class="line">â”‚   â”œâ”€â”€ table[1] â†’ entry(name:iPhone) â†’ NULL</span><br><span class="line">â”‚   â”œâ”€â”€ table[2] â†’ entry(price:5999) â†’ entry(stock:100) â†’ NULL  (æ‹‰é“¾æ³•)</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â””â”€â”€ ht[1] (rehashç”¨)</span><br><span class="line">    â””â”€â”€ NULL (æœªä½¿ç”¨)</span><br></pre></td></tr></table></figure>

<h4 id="4-æ¸è¿›å¼-Rehash-æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰"><a href="#4-æ¸è¿›å¼-Rehash-æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰" class="headerlink" title="4. æ¸è¿›å¼ Rehash æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰"></a>4. æ¸è¿›å¼ Rehash æœºåˆ¶ï¼ˆæ ¸å¿ƒï¼‰</h4><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰©å®¹</span></span><br><span class="line"><span class="number">1.</span> è´Ÿè½½å› å­ = used/size &gt;= <span class="number">1</span> (æ— BGSAVE/BGREWRITEAOFæ—¶)</span><br><span class="line"><span class="number">2.</span> è´Ÿè½½å› å­ &gt;= <span class="number">5</span> (å¼ºåˆ¶æ‰©å®¹)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼©å®¹</span></span><br><span class="line">è´Ÿè½½å› å­ &lt; <span class="number">0.1</span></span><br></pre></td></tr></table></figure>

<p><strong>æ¸è¿›å¼ Rehash æµç¨‹</strong>ï¼š</p>
<ol>
<li>ä¸º <code>ht[1]</code> åˆ†é…ç©ºé—´ï¼ˆæ‰©å®¹ä¸º <code>used * 2</code> çš„æœ€å° 2^nï¼‰</li>
<li><code>rehashidx = 0</code> å¼€å§‹è¿ç§»</li>
<li><strong>æ¯æ¬¡å¢åˆ æ”¹æŸ¥æ“ä½œæ—¶</strong>ï¼Œé¡ºå¸¦è¿ç§» <code>ht[0].table[rehashidx]</code> çš„æ‰€æœ‰æ•°æ®åˆ° <code>ht[1]</code></li>
<li>å…¨éƒ¨è¿ç§»å®Œæˆåï¼Œé‡Šæ”¾ <code>ht[0]</code>ï¼Œå°† <code>ht[1]</code> è®¾ä¸º <code>ht[0]</code></li>
</ol>
<p><strong>å¯è§†åŒ–æµç¨‹</strong>ï¼šè¯¦è§ <a href="/diagrams/mermaid/redis-rehash-process.mmd">redis-rehash-process.mmd</a></p>
<p><strong>Rehash æœŸé—´çš„æ“ä½œ</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥æ‰¾ï¼šå…ˆæŸ¥ ht[<span class="number">0</span>]ï¼Œæœªæ‰¾åˆ°å†æŸ¥ ht[<span class="number">1</span>]</span><br><span class="line">æ–°å¢ï¼šç›´æ¥å†™å…¥ ht[<span class="number">1</span>]ï¼ˆæ–°æ•°æ®ä¸è¿›æ—§è¡¨ï¼‰</span><br><span class="line">åˆ é™¤/æ›´æ–°ï¼šåœ¨ ht[<span class="number">0</span>] æˆ– ht[<span class="number">1</span>] ä¸­æ‰¾åˆ°åæ“ä½œ</span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºä»€ä¹ˆç”¨æ¸è¿›å¼ï¼Ÿ</strong></p>
<ul>
<li>é¿å…ä¸€æ¬¡æ€§ rehash å¤§é‡æ•°æ®å¯¼è‡´ Redis é˜»å¡ï¼ˆæ¯«ç§’çº§â†’å¾®ç§’çº§ï¼‰</li>
<li>åˆ†æ‘Šåˆ°æ¯æ¬¡æ“ä½œä¸­ï¼Œå¯¹å•æ¬¡è¯·æ±‚å½±å“æå°</li>
</ul>
<h4 id="5-å“ˆå¸Œå‡½æ•°"><a href="#5-å“ˆå¸Œå‡½æ•°" class="headerlink" title="5. å“ˆå¸Œå‡½æ•°"></a>5. å“ˆå¸Œå‡½æ•°</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redis ä½¿ç”¨ MurmurHash2ï¼ˆé€Ÿåº¦å¿«ã€åˆ†å¸ƒå‡åŒ€ï¼‰</span></span><br><span class="line">hash = MurmurHash2(key, len);</span><br><span class="line">index = hash &amp; dict-&gt;ht[x].sizemask;  <span class="comment">// ä½è¿ç®—ä»£æ›¿å–æ¨¡ï¼Œæ€§èƒ½ä¼˜</span></span><br></pre></td></tr></table></figure>

<h4 id="6-æ€§èƒ½å¯¹æ¯”"><a href="#6-æ€§èƒ½å¯¹æ¯”" class="headerlink" title="6. æ€§èƒ½å¯¹æ¯”"></a>6. æ€§èƒ½å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>ziplist</th>
<th>hashtable</th>
</tr>
</thead>
<tbody><tr>
<td>HSET</td>
<td>O(n)</td>
<td>O(1) å¹³å‡</td>
</tr>
<tr>
<td>HGET</td>
<td>O(n)</td>
<td>O(1) å¹³å‡</td>
</tr>
<tr>
<td>HDEL</td>
<td>O(n)</td>
<td>O(1) å¹³å‡</td>
</tr>
<tr>
<td>HGETALL</td>
<td>O(n)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å†…å­˜å ç”¨</td>
<td><strong>ä½</strong>ï¼ˆæ— æŒ‡é’ˆï¼‰</td>
<td><strong>é«˜</strong>ï¼ˆæŒ‡é’ˆ+ç©ºé—´æ¢æ—¶é—´ï¼‰</td>
</tr>
<tr>
<td>CPUç¼“å­˜</td>
<td><strong>å‹å¥½</strong>ï¼ˆè¿ç»­ï¼‰</td>
<td>ä¸€èˆ¬ï¼ˆéšæœºè®¿é—®ï¼‰</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>&lt; 512å­—æ®µå°å¯¹è±¡</td>
<td>å¤§é‡å­—æ®µå¿«é€ŸæŸ¥æ‰¾</td>
</tr>
</tbody></table>
<h4 id="7-ç”µå•†åœºæ™¯æœ€ä½³å®è·µ"><a href="#7-ç”µå•†åœºæ™¯æœ€ä½³å®è·µ" class="headerlink" title="7. ç”µå•†åœºæ™¯æœ€ä½³å®è·µ"></a>7. ç”µå•†åœºæ™¯æœ€ä½³å®è·µ</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èï¼šå•†å“è¯¦æƒ…ç¼“å­˜ï¼ˆå­—æ®µé€‚ä¸­ï¼Œé¢‘ç¹éƒ¨åˆ†æ›´æ–°ï¼‰</span></span><br><span class="line">rdb.HSet(ctx, <span class="string">&quot;product:1001&quot;</span>, <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>:      <span class="string">&quot;iPhone 15&quot;</span>,</span><br><span class="line">    <span class="string">&quot;price&quot;</span>:     <span class="string">&quot;5999&quot;</span>,</span><br><span class="line">    <span class="string">&quot;stock&quot;</span>:     <span class="string">&quot;100&quot;</span>,</span><br><span class="line">    <span class="string">&quot;seller_id&quot;</span>: <span class="string">&quot;10086&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæ›´æ–°åº“å­˜ï¼Œæ— éœ€è¯»å–æ•´ä¸ªå¯¹è±¡</span></span><br><span class="line">rdb.HIncrBy(ctx, <span class="string">&quot;product:1001&quot;</span>, <span class="string">&quot;stock&quot;</span>, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ¨èï¼šç”¨æˆ· Session å­˜å‚¨</span></span><br><span class="line">rdb.HSet(ctx, <span class="string">&quot;session:abc123&quot;</span>, <span class="string">&quot;uid&quot;</span>, <span class="string">&quot;88888&quot;</span>)</span><br><span class="line">rdb.HSet(ctx, <span class="string">&quot;session:abc123&quot;</span>, <span class="string">&quot;role&quot;</span>, <span class="string">&quot;buyer&quot;</span>)</span><br><span class="line">rdb.Expire(ctx, <span class="string">&quot;session:abc123&quot;</span>, <span class="number">30</span>*time.Minute)</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é¿å…ï¼šå¤§ Hashï¼ˆ&gt; 10000 å­—æ®µï¼‰</span></span><br><span class="line"><span class="comment">// é—®é¢˜ï¼šHGETALL é˜»å¡ã€é›†ç¾¤æ•°æ®å€¾æ–œã€æŒä¹…åŒ–æ…¢</span></span><br><span class="line"><span class="comment">// è§£å†³ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªå° Hashï¼Œå¦‚ product:1001:baseã€product:1001:detail</span></span><br></pre></td></tr></table></figure>

<h4 id="8-Hash-vs-String-JSON"><a href="#8-Hash-vs-String-JSON" class="headerlink" title="8. Hash vs String(JSON)"></a>8. Hash vs String(JSON)</h4><table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>Hash</th>
<th>String (JSON)</th>
</tr>
</thead>
<tbody><tr>
<td>å†…å­˜</td>
<td>ziplist æ¨¡å¼æ›´çœ</td>
<td>JSON åºåˆ—åŒ–å¼€é”€å¤§</td>
</tr>
<tr>
<td>éƒ¨åˆ†æ›´æ–°</td>
<td>âœ… <code>HSET field</code></td>
<td>âŒ éœ€æ•´ä½“ GETâ†’æ”¹â†’SET</td>
</tr>
<tr>
<td>åºåˆ—åŒ–</td>
<td>æ— éœ€åºåˆ—åŒ–</td>
<td>éœ€ JSON ç¼–è§£ç ï¼ˆCPUå¼€é”€ï¼‰</td>
</tr>
<tr>
<td>æŸ¥è¯¢çµæ´»æ€§</td>
<td><code>HMGET</code> ç²¾ç¡®å–å­—æ®µ</td>
<td><code>GET</code> æ•´ä½“å–å‡º</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>é¢‘ç¹éƒ¨åˆ†å­—æ®µæ›´æ–°</td>
<td>æ•´ä½“è¯»å†™ã€å¤æ‚åµŒå¥—ç»“æ„</td>
</tr>
</tbody></table>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ul>
<li><strong>ç”¨ Hash</strong>ï¼šå¯¹è±¡å­—æ®µ &lt; 1000ï¼Œéœ€è¦å•ç‹¬è¯»å†™æŸäº›å­—æ®µï¼ˆå¦‚åº“å­˜ï¼‰</li>
<li><strong>ç”¨ String</strong>ï¼šå¯¹è±¡ç»“æ„å¤æ‚åµŒå¥—ï¼ˆJSONï¼‰ï¼Œæ•´ä½“è¯»å†™å±…å¤š</li>
</ul>
<h4 id="9-ç›‘æ§ä¸è°ƒä¼˜"><a href="#9-ç›‘æ§ä¸è°ƒä¼˜" class="headerlink" title="9. ç›‘æ§ä¸è°ƒä¼˜"></a>9. ç›‘æ§ä¸è°ƒä¼˜</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥æ‰¾å¤§ key</span></span><br><span class="line">redis-cli --bigkeys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æŸ¥çœ‹ Hash ç¼–ç </span></span><br><span class="line">redis-cli&gt; OBJECT ENCODING product:1001</span><br><span class="line"><span class="string">&quot;ziplist&quot;</span>  <span class="comment"># æˆ– &quot;hashtable&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŸ¥çœ‹å†…å­˜å ç”¨</span></span><br><span class="line">redis-cli&gt; MEMORY USAGE product:1001</span><br><span class="line">(<span class="built_in">integer</span>) 184</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. è°ƒæ•´ç¼–ç é˜ˆå€¼ï¼ˆæ ¹æ®ä¸šåŠ¡è°ƒæ•´ï¼‰</span></span><br><span class="line">CONFIG SET hash-max-ziplist-entries 1024</span><br><span class="line">CONFIG SET hash-max-ziplist-value 128</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="String-åº•å±‚å®ç°"><a href="#String-åº•å±‚å®ç°" class="headerlink" title="String åº•å±‚å®ç°"></a>String åº•å±‚å®ç°</h3><h4 id="String-SDS-æ ¸å¿ƒç»“æ„"><a href="#String-SDS-æ ¸å¿ƒç»“æ„" class="headerlink" title="String&#x2F;SDS æ ¸å¿ƒç»“æ„"></a>String&#x2F;SDS æ ¸å¿ƒç»“æ„</h4><p>Redis String å®é™…æ˜¯ <strong>SDSï¼ˆSimple Dynamic Stringï¼‰</strong>ï¼Œè€Œé C å­—ç¬¦ä¸²ã€‚</p>
<h4 id="SDS-ç»“æ„"><a href="#SDS-ç»“æ„" class="headerlink" title="SDS ç»“æ„"></a>SDS ç»“æ„</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sdshdr</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> len;        <span class="comment">// å·²ä½¿ç”¨é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> <span class="built_in">free</span>;       <span class="comment">// å‰©ä½™å¯ç”¨ç©ºé—´</span></span><br><span class="line">    <span class="type">char</span> buf[];     <span class="comment">// å®é™…æ•°æ®</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜åŠ¿å¯¹æ¯”"><a href="#ä¼˜åŠ¿å¯¹æ¯”" class="headerlink" title="ä¼˜åŠ¿å¯¹æ¯”"></a>ä¼˜åŠ¿å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>C å­—ç¬¦ä¸²</th>
<th>SDS</th>
</tr>
</thead>
<tbody><tr>
<td>è·å–é•¿åº¦</td>
<td>O(n) éå†</td>
<td>O(1) ç›´æ¥è¯» len</td>
</tr>
<tr>
<td>ç¼“å†²åŒºæº¢å‡º</td>
<td>ä¸æ£€æŸ¥ï¼Œæ˜“æº¢å‡º</td>
<td>è‡ªåŠ¨æ‰©å®¹ï¼Œå®‰å…¨</td>
</tr>
<tr>
<td>å†…å­˜é‡åˆ†é…</td>
<td>æ¯æ¬¡éƒ½éœ€è¦</td>
<td>ç©ºé—´é¢„åˆ†é… + æƒ°æ€§é‡Šæ”¾</td>
</tr>
<tr>
<td>äºŒè¿›åˆ¶å®‰å…¨</td>
<td>å¦ï¼ˆé‡ <code>\0</code> ç»“æŸï¼‰</td>
<td>æ˜¯ï¼ˆè®°å½•é•¿åº¦ï¼‰</td>
</tr>
</tbody></table>
<h4 id="ç¼–ç ç±»å‹"><a href="#ç¼–ç ç±»å‹" class="headerlink" title="ç¼–ç ç±»å‹"></a>ç¼–ç ç±»å‹</h4><p>String æœ‰ 3 ç§ç¼–ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. int ç¼–ç ï¼ˆæ•´æ•°ï¼‰</span></span><br><span class="line">SET count 100</span><br><span class="line">OBJECT ENCODING count  <span class="comment"># &quot;int&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. embstr ç¼–ç ï¼ˆçŸ­å­—ç¬¦ä¸² â‰¤ 44 å­—èŠ‚ï¼‰</span></span><br><span class="line">SET short <span class="string">&quot;hello&quot;</span></span><br><span class="line">OBJECT ENCODING short  <span class="comment"># &quot;embstr&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. raw ç¼–ç ï¼ˆé•¿å­—ç¬¦ä¸² &gt; 44 å­—èŠ‚ï¼‰</span></span><br><span class="line">SET long <span class="string">&quot;very long string...&quot;</span></span><br><span class="line">OBJECT ENCODING long  <span class="comment"># &quot;raw&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>embstr vs raw</strong>ï¼š</p>
<ul>
<li><strong>embstr</strong>ï¼šSDS å’Œ redisObject åœ¨è¿ç»­å†…å­˜ï¼ˆä¸€æ¬¡åˆ†é…ï¼‰</li>
<li><strong>raw</strong>ï¼šSDS å’Œ redisObject åˆ†å¼€åˆ†é…ï¼ˆä¸¤æ¬¡åˆ†é…ï¼‰</li>
</ul>
<h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è®¡æ•°å™¨</span></span><br><span class="line">rdb.Incr(ctx, <span class="string">&quot;page:views&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. åˆ†å¸ƒå¼ ID ç”Ÿæˆ</span></span><br><span class="line">id := rdb.Incr(ctx, <span class="string">&quot;order:id&quot;</span>).Val()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. é™æµï¼ˆå›ºå®šçª—å£ï¼‰</span></span><br><span class="line">count := rdb.Incr(ctx, <span class="string">&quot;limit:user:123&quot;</span>).Val()</span><br><span class="line"><span class="keyword">if</span> count == <span class="number">1</span> &#123;</span><br><span class="line">    rdb.Expire(ctx, <span class="string">&quot;limit:user:123&quot;</span>, <span class="number">60</span>*time.Second)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> count &gt; <span class="number">100</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ErrRateLimited</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. Session å­˜å‚¨</span></span><br><span class="line">rdb.Set(ctx, <span class="string">&quot;session:token_abc&quot;</span>, userJSON, <span class="number">30</span>*time.Minute)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="List-åº•å±‚å®ç°"><a href="#List-åº•å±‚å®ç°" class="headerlink" title="List åº•å±‚å®ç°"></a>List åº•å±‚å®ç°</h3><p>List åœ¨ Redis 3.2 ä¹‹å‰ä½¿ç”¨ <strong>ziplist</strong> æˆ– <strong>linkedlist</strong>ï¼Œ3.2+ ç»Ÿä¸€ä½¿ç”¨ <strong>quicklist</strong>ã€‚</p>
<h4 id="quicklist-ç»“æ„"><a href="#quicklist-ç»“æ„" class="headerlink" title="quicklist ç»“æ„"></a>quicklist ç»“æ„</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">quicklist = ziplist é“¾è¡¨</span><br><span class="line"></span><br><span class="line">[ziplist1] â‡„ [ziplist2] â‡„ [ziplist3] â‡„ [ziplist4]</span><br><span class="line">    â†“             â†“             â†“             â†“</span><br><span class="line">  [a,b,c]      [d,e,f]      [g,h,i]      [j,k,l]</span><br></pre></td></tr></table></figure>

<p><strong>è®¾è®¡æ€æƒ³</strong>ï¼š</p>
<ul>
<li><strong>ziplist</strong>ï¼šå†…å­˜ç´§å‡‘ï¼Œä½†å¤§é‡æ•°æ®æ—¶æ€§èƒ½å·®</li>
<li><strong>linkedlist</strong>ï¼šæ’å…¥å¿«ï¼Œä½†å†…å­˜ç¢ç‰‡å¤š</li>
<li><strong>quicklist</strong>ï¼šæŠ˜ä¸­æ–¹æ¡ˆï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå° ziplist</li>
</ul>
<h4 id="é…ç½®å‚æ•°"><a href="#é…ç½®å‚æ•°" class="headerlink" title="é…ç½®å‚æ•°"></a>é…ç½®å‚æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ¯ä¸ª ziplist çš„æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span><br><span class="line">list-max-ziplist-size -2  # -2 è¡¨ç¤º 8KB</span><br><span class="line"></span><br><span class="line"># ä¸¤ç«¯ä¸å‹ç¼©çš„èŠ‚ç‚¹æ•°ï¼ˆLZF å‹ç¼©ï¼‰</span><br><span class="line">list-compress-depth 0  # 0 è¡¨ç¤ºä¸å‹ç¼©</span><br></pre></td></tr></table></figure>

<h4 id="åº”ç”¨åœºæ™¯-1"><a href="#åº”ç”¨åœºæ™¯-1" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆFIFOï¼‰</span></span><br><span class="line">rdb.LPush(ctx, <span class="string">&quot;queue:tasks&quot;</span>, task1, task2)  <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">task := rdb.RPop(ctx, <span class="string">&quot;queue:tasks&quot;</span>)         <span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æœ€è¿‘æµè§ˆè®°å½•ï¼ˆLIFOï¼‰</span></span><br><span class="line">rdb.LPush(ctx, <span class="string">&quot;user:123:history&quot;</span>, productID)</span><br><span class="line">rdb.LTrim(ctx, <span class="string">&quot;user:123:history&quot;</span>, <span class="number">0</span>, <span class="number">9</span>)  <span class="comment">// åªä¿ç•™æœ€æ–° 10 æ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ—¶é—´çº¿ï¼ˆTimelineï¼‰</span></span><br><span class="line">rdb.LPush(ctx, <span class="string">&quot;timeline:user:123&quot;</span>, postID)</span><br><span class="line">posts := rdb.LRange(ctx, <span class="string">&quot;timeline:user:123&quot;</span>, <span class="number">0</span>, <span class="number">19</span>)  <span class="comment">// æœ€æ–° 20 æ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. é˜»å¡é˜Ÿåˆ—ï¼ˆBRPOPï¼‰</span></span><br><span class="line">task := rdb.BRPop(ctx, <span class="number">5</span>*time.Second, <span class="string">&quot;queue:tasks&quot;</span>)  <span class="comment">// é˜»å¡ç­‰å¾…</span></span><br></pre></td></tr></table></figure>

<h4 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>LPUSH&#x2F;RPUSH</td>
<td>O(1)</td>
<td>å¤´å°¾æ’å…¥</td>
</tr>
<tr>
<td>LPOP&#x2F;RPOP</td>
<td>O(1)</td>
<td>å¤´å°¾å¼¹å‡º</td>
</tr>
<tr>
<td>LINDEX</td>
<td>O(n)</td>
<td>æŒ‰ç´¢å¼•æŸ¥è¯¢</td>
</tr>
<tr>
<td>LRANGE</td>
<td>O(n)</td>
<td>èŒƒå›´æŸ¥è¯¢</td>
</tr>
<tr>
<td>LINSERT</td>
<td>O(n)</td>
<td>ä¸­é—´æ’å…¥</td>
</tr>
</tbody></table>
<hr>
<h3 id="Set-åº•å±‚å®ç°"><a href="#Set-åº•å±‚å®ç°" class="headerlink" title="Set åº•å±‚å®ç°"></a>Set åº•å±‚å®ç°</h3><p>Set ä½¿ç”¨ <strong>intset</strong> æˆ– <strong>hashtable</strong> ç¼–ç ã€‚</p>
<h4 id="intsetï¼ˆæ•´æ•°é›†åˆï¼‰"><a href="#intsetï¼ˆæ•´æ•°é›†åˆï¼‰" class="headerlink" title="intsetï¼ˆæ•´æ•°é›†åˆï¼‰"></a>intsetï¼ˆæ•´æ•°é›†åˆï¼‰</h4><p><strong>é€‚ç”¨æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°</li>
<li>å…ƒç´ æ•°é‡ â‰¤ 512ï¼ˆ<code>set-max-intset-entries</code>ï¼‰</li>
</ul>
<p><strong>ç»“æ„</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">intset</span> &#123;</span></span><br><span class="line">    <span class="type">uint32_t</span> encoding;  <span class="comment">// INTSET_ENC_INT16/INT32/INT64</span></span><br><span class="line">    <span class="type">uint32_t</span> length;    <span class="comment">// å…ƒç´ æ•°é‡</span></span><br><span class="line">    <span class="type">int8_t</span> contents[];  <span class="comment">// æœ‰åºæ•°ç»„</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>âœ… æœ‰åºå­˜å‚¨ï¼ŒäºŒåˆ†æŸ¥æ‰¾ O(log n)</li>
<li>âœ… å†…å­˜ç´§å‡‘</li>
<li>âŒ æ’å…¥&#x2F;åˆ é™¤éœ€ç§»åŠ¨å…ƒç´  O(n)</li>
</ul>
<h4 id="åº”ç”¨åœºæ™¯-2"><a href="#åº”ç”¨åœºæ™¯-2" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ ‡ç­¾ç³»ç»Ÿ</span></span><br><span class="line">rdb.SAdd(ctx, <span class="string">&quot;user:123:tags&quot;</span>, <span class="string">&quot;VIP&quot;</span>, <span class="string">&quot;ç”·æ€§&quot;</span>, <span class="string">&quot;90å&quot;</span>)</span><br><span class="line">tags := rdb.SMembers(ctx, <span class="string">&quot;user:123:tags&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å…±åŒå¥½å‹</span></span><br><span class="line">rdb.SAdd(ctx, <span class="string">&quot;user:123:friends&quot;</span>, <span class="string">&quot;456&quot;</span>, <span class="string">&quot;789&quot;</span>)</span><br><span class="line">rdb.SAdd(ctx, <span class="string">&quot;user:456:friends&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="string">&quot;789&quot;</span>)</span><br><span class="line">common := rdb.SInter(ctx, <span class="string">&quot;user:123:friends&quot;</span>, <span class="string">&quot;user:456:friends&quot;</span>)  <span class="comment">// [789]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. å»é‡ï¼ˆæŠ½å¥–æ± ï¼‰</span></span><br><span class="line">rdb.SAdd(ctx, <span class="string">&quot;lottery:pool&quot;</span>, userIDs...)</span><br><span class="line">winner := rdb.SPop(ctx, <span class="string">&quot;lottery:pool&quot;</span>)  <span class="comment">// éšæœºæŠ½å–</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. ç‚¹èµç”¨æˆ·åˆ—è¡¨</span></span><br><span class="line">rdb.SAdd(ctx, <span class="string">&quot;post:1001:likes&quot;</span>, <span class="string">&quot;user:123&quot;</span>)</span><br><span class="line">isLiked := rdb.SIsMember(ctx, <span class="string">&quot;post:1001:likes&quot;</span>, <span class="string">&quot;user:123&quot;</span>)</span><br><span class="line">likeCount := rdb.SCard(ctx, <span class="string">&quot;post:1001:likes&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ZSet-åº•å±‚å®ç°"><a href="#ZSet-åº•å±‚å®ç°" class="headerlink" title="ZSet åº•å±‚å®ç°"></a>ZSet åº•å±‚å®ç°</h3><p>ZSet ä½¿ç”¨ <strong>ziplist</strong> æˆ– <strong>skiplist + hashtable</strong> ç¼–ç ã€‚</p>
<h4 id="ziplist-ç¼–ç "><a href="#ziplist-ç¼–ç " class="headerlink" title="ziplist ç¼–ç "></a>ziplist ç¼–ç </h4><p><strong>æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>å…ƒç´ æ•°é‡ â‰¤ 128ï¼ˆ<code>zset-max-ziplist-entries</code>ï¼‰</li>
<li>å•ä¸ªå…ƒç´  â‰¤ 64 å­—èŠ‚ï¼ˆ<code>zset-max-ziplist-value</code>ï¼‰</li>
</ul>
<p><strong>å­˜å‚¨æ ¼å¼</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[member1, score1, member2, score2, ...]</span><br><span class="line">æŒ‰ score æœ‰åºå­˜å‚¨</span><br></pre></td></tr></table></figure>

<h4 id="skiplist-hashtable-ç¼–ç "><a href="#skiplist-hashtable-ç¼–ç " class="headerlink" title="skiplist + hashtable ç¼–ç "></a>skiplist + hashtable ç¼–ç </h4><p><strong>ä¸ºä»€ä¹ˆç”¨ä¸¤ç§ç»“æ„ï¼Ÿ</strong></p>
<ul>
<li><strong>skiplist</strong>ï¼šæŒ‰ score æœ‰åºï¼ŒèŒƒå›´æŸ¥è¯¢ O(log n)</li>
<li><strong>hashtable</strong>ï¼šæŒ‰ member æŸ¥æ‰¾ï¼ŒO(1) è·å– score</li>
</ul>
<p><strong>skiplist ç»“æ„</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Level 3:  1 --------------------------------&gt; 100</span><br><span class="line">Level 2:  1 -------&gt; 50 -------------------&gt; 100</span><br><span class="line">Level 1:  1 --&gt; 25 &gt; 50 --&gt; 75 ------------&gt; 100</span><br><span class="line">Level 0:  1 &gt; 10 &gt; 25 &gt; 50 &gt; 75 &gt; 90 &gt; 100</span><br></pre></td></tr></table></figure>

<p>å¹³å‡æŸ¥æ‰¾å¤æ‚åº¦ï¼šO(log n)</p>
<h4 id="åº”ç”¨åœºæ™¯-3"><a href="#åº”ç”¨åœºæ™¯-3" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ’è¡Œæ¦œ</span></span><br><span class="line">rdb.ZAdd(ctx, <span class="string">&quot;rank:score&quot;</span>, &amp;redis.Z&#123;Score: <span class="number">5999</span>, Member: <span class="string">&quot;user:123&quot;</span>&#125;)</span><br><span class="line">top10 := rdb.ZRevRange(ctx, <span class="string">&quot;rank:score&quot;</span>, <span class="number">0</span>, <span class="number">9</span>)  <span class="comment">// å‰ 10 å</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å»¶æ—¶é˜Ÿåˆ—</span></span><br><span class="line">rdb.ZAdd(ctx, <span class="string">&quot;delay:queue&quot;</span>, &amp;redis.Z&#123;</span><br><span class="line">    Score:  <span class="type">float64</span>(time.Now().Add(<span class="number">5</span>*time.Minute).Unix()),</span><br><span class="line">    Member: taskID,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// å®šæ—¶æ‹‰å–åˆ°æœŸä»»åŠ¡</span></span><br><span class="line">tasks := rdb.ZRangeByScore(ctx, <span class="string">&quot;delay:queue&quot;</span>, &amp;redis.ZRangeBy&#123;</span><br><span class="line">    Min: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">    Max: strconv.Itoa(<span class="type">int</span>(time.Now().Unix())),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æƒé‡æ¨è</span></span><br><span class="line">rdb.ZAdd(ctx, <span class="string">&quot;recommend:user:123&quot;</span>, &amp;redis.Z&#123;Score: <span class="number">0.95</span>, Member: <span class="string">&quot;item:1001&quot;</span>&#125;)</span><br><span class="line">recommended := rdb.ZRevRangeByScore(ctx, <span class="string">&quot;recommend:user:123&quot;</span>, &amp;redis.ZRangeBy&#123;</span><br><span class="line">    Min: <span class="string">&quot;0.8&quot;</span>,</span><br><span class="line">    Max: <span class="string">&quot;+inf&quot;</span>,</span><br><span class="line">    Count: <span class="number">10</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¾®ä¿¡æ­¥æ•°æ’è¡Œæ¦œ</span></span><br><span class="line">rdb.ZAdd(ctx, <span class="string">&quot;steps:2026-01-08&quot;</span>, &amp;redis.Z&#123;Score: <span class="number">10000</span>, Member: <span class="string">&quot;user:123&quot;</span>&#125;)</span><br><span class="line">myRank := rdb.ZRevRank(ctx, <span class="string">&quot;steps:2026-01-08&quot;</span>, <span class="string">&quot;user:123&quot;</span>)  <span class="comment">// æˆ‘çš„æ’å</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ-1"><a href="#ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ-1" class="headerlink" title="ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ"></a>ä¸‰ã€ç¼“å­˜è®¾è®¡ä¸å®è·µ</h2><blockquote>
<p>æŒæ¡ç¼“å­˜ä½¿ç”¨æ¨¡å¼ã€ä¸€è‡´æ€§æ–¹æ¡ˆã€å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼Œæ„å»ºé«˜å¯ç”¨ç¼“å­˜ç³»ç»Ÿã€‚</p>
</blockquote>
<hr>
<h3 id="ç¼“å­˜å®¹é‡è§„åˆ’ä¸å†…å­˜ç®¡ç†"><a href="#ç¼“å­˜å®¹é‡è§„åˆ’ä¸å†…å­˜ç®¡ç†" class="headerlink" title="ç¼“å­˜å®¹é‡è§„åˆ’ä¸å†…å­˜ç®¡ç†"></a>ç¼“å­˜å®¹é‡è§„åˆ’ä¸å†…å­˜ç®¡ç†</h3><h4 id="å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥"></a>å†…å­˜æ·˜æ±°ç­–ç•¥</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- noeviction(é»˜è®¤ç­–ç•¥)ï¼šå¯¹äºå†™è¯·æ±‚ä¸å†æä¾›æœåŠ¡ï¼Œç›´æ¥è¿”å›é”™è¯¯ï¼ˆDELè¯·æ±‚å’Œéƒ¨åˆ†ç‰¹æ®Šè¯·æ±‚é™¤å¤–ï¼‰</span><br><span class="line">- allkeys-lruï¼šä»æ‰€æœ‰keyä¸­ä½¿ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°</span><br><span class="line">- volatile-lruï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ä½¿ç”¨LRUç®—æ³•è¿›è¡Œæ·˜æ±°</span><br><span class="line">- allkeys-randomï¼šä»æ‰€æœ‰keyä¸­éšæœºæ·˜æ±°æ•°æ®</span><br><span class="line">- volatile-randomï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­éšæœºæ·˜æ±°</span><br><span class="line">- volatile-ttlï¼šåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œæ ¹æ®keyçš„è¿‡æœŸæ—¶é—´è¿›è¡Œæ·˜æ±°ï¼Œè¶Šæ—©è¿‡æœŸçš„è¶Šä¼˜å…ˆè¢«æ·˜æ±°</span><br><span class="line">LFUç®—æ³•æ˜¯Redis4.0é‡Œé¢æ–°åŠ çš„ä¸€ç§æ·˜æ±°ç­–ç•¥ã€‚å®ƒçš„å…¨ç§°æ˜¯Least Frequently Used</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="https://juejin.cn/post/6844903927037558792">redis å†…å­˜æ·˜æ±°ç­–ç•¥è§£æ</a></p>
<h3 id="è¿‡æœŸé”®åˆ é™¤ç­–ç•¥"><a href="#è¿‡æœŸé”®åˆ é™¤ç­–ç•¥" class="headerlink" title="è¿‡æœŸé”®åˆ é™¤ç­–ç•¥"></a>è¿‡æœŸé”®åˆ é™¤ç­–ç•¥</h3><p>è¿‡æœŸç­–ç•¥é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ul>
<li>å®šæ—¶è¿‡æœŸï¼šæ¯ä¸ªè®¾ç½®è¿‡æœŸæ—¶é—´çš„keyéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œåˆ°è¿‡æœŸæ—¶é—´å°±ä¼šç«‹å³æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥ç«‹å³æ¸…é™¤è¿‡æœŸçš„æ•°æ®ï¼Œå¯¹å†…å­˜å¾ˆå‹å¥½ï¼›ä½†æ˜¯ä¼šå ç”¨å¤§é‡çš„CPUèµ„æºå»å¤„ç†è¿‡æœŸçš„æ•°æ®ï¼Œä»è€Œå½±å“ç¼“å­˜çš„å“åº”æ—¶é—´å’Œååé‡ã€‚</li>
<li>æƒ°æ€§è¿‡æœŸï¼šåªæœ‰å½“è®¿é—®ä¸€ä¸ªkeyæ—¶ï¼Œæ‰ä¼šåˆ¤æ–­è¯¥keyæ˜¯å¦å·²è¿‡æœŸï¼Œè¿‡æœŸåˆ™æ¸…é™¤ã€‚è¯¥ç­–ç•¥å¯ä»¥æœ€å¤§åŒ–åœ°èŠ‚çœCPUèµ„æºï¼Œå´å¯¹å†…å­˜éå¸¸ä¸å‹å¥½ã€‚æç«¯æƒ…å†µå¯èƒ½å‡ºç°å¤§é‡çš„è¿‡æœŸkeyæ²¡æœ‰å†æ¬¡è¢«è®¿é—®ï¼Œä»è€Œä¸ä¼šè¢«æ¸…é™¤ï¼Œå ç”¨å¤§é‡å†…å­˜ã€‚</li>
<li>å®šæœŸè¿‡æœŸï¼šæ¯éš”ä¸€å®šçš„æ—¶é—´ï¼Œä¼šæ‰«æä¸€å®šæ•°é‡çš„æ•°æ®åº“çš„expireså­—å…¸ä¸­ä¸€å®šæ•°é‡çš„keyï¼Œå¹¶æ¸…é™¤å…¶ä¸­å·²è¿‡æœŸçš„keyã€‚è¯¥ç­–ç•¥æ˜¯å‰ä¸¤è€…çš„ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆã€‚é€šè¿‡è°ƒæ•´å®šæ—¶æ‰«æçš„æ—¶é—´é—´éš”å’Œæ¯æ¬¡æ‰«æçš„é™å®šè€—æ—¶ï¼Œå¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹ä½¿å¾—CPUå’Œå†…å­˜èµ„æºè¾¾åˆ°æœ€ä¼˜çš„å¹³è¡¡æ•ˆæœã€‚<br>(expireså­—å…¸ä¼šä¿å­˜æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyçš„è¿‡æœŸæ—¶é—´æ•°æ®ï¼Œå…¶ä¸­ï¼Œkeyæ˜¯æŒ‡å‘é”®ç©ºé—´ä¸­çš„æŸä¸ªé”®çš„æŒ‡é’ˆï¼Œvalueæ˜¯è¯¥é”®çš„æ¯«ç§’ç²¾åº¦çš„UNIXæ—¶é—´æˆ³è¡¨ç¤ºçš„è¿‡æœŸæ—¶é—´ã€‚é”®ç©ºé—´æ˜¯æŒ‡è¯¥Redisé›†ç¾¤ä¸­ä¿å­˜çš„æ‰€æœ‰é”®ã€‚)</li>
</ul>
<hr>
<h2 id="å››ã€é«˜çº§ç‰¹æ€§-1"><a href="#å››ã€é«˜çº§ç‰¹æ€§-1" class="headerlink" title="å››ã€é«˜çº§ç‰¹æ€§"></a>å››ã€é«˜çº§ç‰¹æ€§</h2><blockquote>
<p>æŒæ¡æŒä¹…åŒ–ã€åˆ†å¸ƒå¼æ¶æ„ã€Lua è„šæœ¬ç­‰é«˜çº§ç‰¹æ€§ï¼Œæ„å»ºç”Ÿäº§çº§ Redis ç³»ç»Ÿã€‚</p>
</blockquote>
<hr>
<h3 id="æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDBã€AOFï¼‰"><a href="#æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDBã€AOFï¼‰" class="headerlink" title="æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDBã€AOFï¼‰"></a>æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDBã€AOFï¼‰</h3><p>Redis æä¾›ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š</p>
<ul>
<li>**RDB (Redis DataBase)**ï¼šå¿«ç…§æ–¹å¼ï¼Œç´§å‡‘çš„äºŒè¿›åˆ¶æ•°æ®</li>
<li>**AOF (Append Only File)**ï¼šè¿½åŠ æ—¥å¿—æ–¹å¼ï¼Œè®°å½•æ‰€æœ‰å†™æ“ä½œ</li>
</ul>
<p><strong>è¯¦ç»†å¯¹æ¯”</strong>ï¼š<a href="http://kaito-kidd.com/2020/06/29/redis-persistence-rdb-aof/">RedisæŒä¹…åŒ–åŸç†</a></p>
<hr>
<h3 id="æœ¬åœ°ç¼“å­˜-vs-è¿œç¨‹ç¼“å­˜"><a href="#æœ¬åœ°ç¼“å­˜-vs-è¿œç¨‹ç¼“å­˜" class="headerlink" title="æœ¬åœ°ç¼“å­˜ vs è¿œç¨‹ç¼“å­˜"></a>æœ¬åœ°ç¼“å­˜ vs è¿œç¨‹ç¼“å­˜</h3><p align="center">
  <img src="/images/cache-remote-local-multilevel.png" width=600 height=360>
</p>

<h4 id="åŒbuffer-vs-LRU-LFU"><a href="#åŒbuffer-vs-LRU-LFU" class="headerlink" title="åŒbuffer vs LRU&#x2F;LFU"></a>åŒbuffer vs LRU&#x2F;LFU</h4><p align="center">
  <img src="/images/double-buffer-lru.png" width=550 height=600>
</p>

<p align="center">
  <img src="/images/cache-double-buffer-lru.png" width=600 height=400>
</p>

<p>æœ¬åœ°ç¼“å­˜çš„åŒç¼“å†²æœºåˆ¶å’Œæœ¬åœ°LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•éƒ½æ˜¯å¸¸è§çš„ç¼“å­˜ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p>
<ol>
<li><p>åŒç¼“å†²æœºåˆ¶ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>æé«˜å¹¶å‘æ€§èƒ½ï¼šåŒç¼“å†²æœºåˆ¶ä½¿ç”¨ä¸¤ä¸ªç¼“å†²åŒºï¼Œä¸€ä¸ªç”¨äºè¯»å–æ•°æ®ï¼Œå¦ä¸€ä¸ªç”¨äºå†™å…¥æ•°æ®ã€‚è¿™æ ·å¯ä»¥é¿å…è¯»å†™å†²çªï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</li>
<li>æé«˜æ•°æ®è®¿é—®æ•ˆç‡ï¼šç”±äºè¯»å–æ“ä½œä¸ä¼šç›´æ¥è®¿é—®ä¸»ç¼“å­˜ï¼Œè€Œæ˜¯è¯»å–ç¼“å†²åŒºçš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥æ›´å¿«åœ°è·å–æ•°æ®ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>å†…å­˜å¼€é”€å¢åŠ ï¼šåŒç¼“å†²æœºåˆ¶éœ€è¦ç»´æŠ¤ä¸¤ä¸ªç¼“å†²åŒºï¼Œè¿™ä¼šå¢åŠ å†…å­˜å¼€é”€ã€‚</li>
<li>æ•°æ®å»¶è¿Ÿï¼šæ•°æ®æ›´æ–°å®šæ—¶åŒæ­¥ï¼Œæœ‰ä¸€å®šå»¶æ—¶ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p>æœ¬åœ°LRUç®—æ³•ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>æ•°æ®è®¿é—®æ•ˆç‡é«˜ï¼šLRUç®—æ³•æ ¹æ®æ•°æ®çš„è®¿é—®é¡ºåºè¿›è¡Œç¼“å­˜æ›¿æ¢ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°å‡ºç¼“å­˜ã€‚è¿™æ ·å¯ä»¥ä¿ç•™æœ€å¸¸ç”¨çš„æ•°æ®ï¼Œæé«˜æ•°æ®çš„è®¿é—®æ•ˆç‡ã€‚</li>
<li>ç®€å•æœ‰æ•ˆï¼šLRUç®—æ³•çš„å®ç°ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦ç»´æŠ¤ä¸€ä¸ªè®¿é—®é¡ºåºé“¾è¡¨å’Œä¸€ä¸ªå“ˆå¸Œè¡¨å³å¯ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ï¼šå¦‚æœæ•°æ®çš„è®¿é—®æ¨¡å¼ä¸ç¬¦åˆLRUç®—æ³•çš„å‡è®¾ï¼Œå³æœ€è¿‘è®¿é—®çš„æ•°æ®åœ¨æœªæ¥ä¹Ÿæ˜¯æœ€æœ‰å¯èƒ½è¢«è®¿é—®çš„ï¼Œé‚£ä¹ˆLRUç®—æ³•çš„æ•ˆæœå¯èƒ½ä¸ç†æƒ³ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¼šä¸‹é™ã€‚</li>
<li>å¯¹äºçƒ­ç‚¹æ•°æ®ä¸æ•æ„Ÿï¼šLRUç®—æ³•åªè€ƒè™‘äº†æœ€è¿‘çš„è®¿é—®æƒ…å†µï¼Œå¯¹äºçƒ­ç‚¹æ•°æ®ï¼ˆé¢‘ç¹è®¿é—®çš„æ•°æ®ï¼‰å¯èƒ½æ— æ³•æœ‰æ•ˆåœ°ä¿ç•™åœ¨ç¼“å­˜ä¸­ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>ç»¼åˆæ¥çœ‹ï¼ŒåŒç¼“å†²æœºåˆ¶é€‚ç”¨äºéœ€è¦æé«˜å¹¶å‘æ€§èƒ½ã€æ‰¹é‡æ›´æ–°ç­‰åœºæ™¯ï¼Œä½†ä¼šå¢åŠ å†…å­˜å¼€é”€ã€‚æœ¬åœ°LRUç®—æ³•é€‚ç”¨äºéœ€è¦æé«˜æ•°æ®è®¿é—®æ•ˆç‡çš„åœºæ™¯ï¼Œä½†å¯¹äºè®¿é—®æ¨¡å¼ä¸ç¬¦åˆLRUå‡è®¾çš„æƒ…å†µä¸‹ï¼Œç¼“å­˜å‘½ä¸­ç‡å¯èƒ½ä¸‹é™ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å’Œåœºæ™¯é€‰æ‹©é€‚åˆçš„ç¼“å­˜ä¼˜åŒ–æŠ€æœ¯ã€‚</p>
<h3 id="ç¼“å­˜ä¸DBä¸€è‡´æ€§æ–¹æ¡ˆ"><a href="#ç¼“å­˜ä¸DBä¸€è‡´æ€§æ–¹æ¡ˆ" class="headerlink" title="ç¼“å­˜ä¸DBä¸€è‡´æ€§æ–¹æ¡ˆ"></a>ç¼“å­˜ä¸DBä¸€è‡´æ€§æ–¹æ¡ˆ</h3><h4 id="ä¸€è‡´æ€§é—®é¢˜åˆ†æ"><a href="#ä¸€è‡´æ€§é—®é¢˜åˆ†æ" class="headerlink" title="ä¸€è‡´æ€§é—®é¢˜åˆ†æ"></a>ä¸€è‡´æ€§é—®é¢˜åˆ†æ</h4><p>å½“ä½¿ç”¨ Redis ç¼“å­˜ DB æ•°æ®æ—¶ï¼ŒDB æ•°æ®ä¼šå‘ç”Ÿ UPDATEï¼Œå¦‚ä½•è€ƒè™‘ Redis å’Œ DB æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜å‘¢ï¼Ÿ</p>
<ul>
<li>é€šå¸¸æ¥è¯´ï¼Œå¯¹äºæµé‡è¾ƒå°çš„ä¸šåŠ¡æ¥è¯´ï¼Œå¯ä»¥è®¾ç½®è¾ƒå°çš„expire time,å¯ä»¥å°†rediså’Œdbçš„ä¸ä¸€è‡´çš„æ—¶é—´æ§åˆ¶åœ¨ä¸€å®šçš„èŒƒå›´å†…éƒ¨</li>
<li>å¯¹äºç¼“å­˜å’Œdbä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜çš„åœºåˆï¼Œé€šå¸¸é‡‡ç”¨çš„æ˜¯å…ˆæ›´æ–°dbï¼Œå†åˆ é™¤æˆ–è€…æ›´æ–°redisï¼Œè€ƒè™‘åˆ°å¹¶å‘æ€§å’Œä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼ˆåˆ é™¤æˆ–è€…æ›´æ–°å¯èƒ½ä¼šå¤±è´¥ï¼‰ï¼Œå¯ä»¥å¢åŠ é‡è¯•æœºåˆ¶ï¼ˆåŒåˆ é™¤ï¼‰ï¼Œå¦‚æœè€ƒè™‘ä¸»ä»å»¶æ—¶ï¼Œå¯ä»¥å¼•å…¥mqåšå»¶æ—¶åŒåˆ </li>
<li><a href="http://kaito-kidd.com/2021/09/08/how-to-keep-cache-and-consistency-of-db/">http://kaito-kidd.com/2021/09/08/how-to-keep-cache-and-consistency-of-db/</a><p align="center">
<img src="/images/cache-refesh.png" width=600 height=800>
</p></li>
</ul>
<p align="center">
  <img src="/images/cache-read-write-mode.png" width=600 height=400>
</p>


<table>
<thead>
<tr>
<th>ç¼“å­˜æ›´æ–°æ–¹å¼</th>
<th>ä¼˜ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>ç¼“å­˜æ¨¡å¼+TTL</td>
<td>ä¸šåŠ¡ä»£ç åªæ›´æ–°DBï¼Œä¸æ›´æ–°cacheï¼Œè®¾ç½®è¾ƒçŸ­çš„TTL(é€šå¸¸åˆ†é’Ÿçº§ï¼‰ï¼Œä¾é cacheè¿‡æœŸæ— æ³•æ‰¾åˆ°keyæ—¶å›æºDBï¼Œçƒ­keyè¿‡æœŸå¯èƒ½å›å¯¼è‡´è¯·æ±‚å¤§é‡è¯·æ±‚å‡»ç©¿åˆ°DBï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æˆ–è€…singleflightç­‰æ–¹å¼é¿å…è¿™ç§é—®é¢˜</td>
</tr>
<tr>
<td>å®šæ—¶åˆ·æ–°æ¨¡å¼</td>
<td>å®šæ—¶ä»»åŠ¡å¼‚æ­¥è·å–DBæ•°æ®åˆ·æ–°åˆ°cacheï¼Œè¯»è¯·æ±‚å¯ä¸å›æºï¼Œéœ€è¦è€ƒè™‘åˆ·æ–°æ—¶é—´å’Œæ‰¹é‡è¯»å†™</td>
</tr>
<tr>
<td>å†™DB,å†™cache</td>
<td>åœ¨å¹¶å‘æ¡ä»¶ä¸‹ï¼ŒDBå†™æ“ä½œé¡ºåºå’Œcacheæ“ä½œä¸åŒä¿è¯é¡ºåºä¸€è‡´æ€§ï¼Œéœ€è¦å¢åŠ åˆ†å¸ƒå¼é”ç­‰æ“ä½œ</td>
</tr>
<tr>
<td>å†™DBï¼Œåˆ é™¤cache</td>
<td>åˆ é™¤cacheå¯èƒ½å¤±è´¥ï¼Œéœ€è¦å¢åŠ é‡è¯•ï¼Œé‡è¯•ä¹Ÿå¯èƒ½å¤±è´¥ï¼Œæ¯”è¾ƒå¤æ‚çš„åŠ ä¸ªMQè¡¥å¿é‡è¯•</td>
</tr>
</tbody></table>
<h3 id="æ€è€ƒï¼š"><a href="#æ€è€ƒï¼š" class="headerlink" title="æ€è€ƒï¼š"></a>æ€è€ƒï¼š</h3><ul>
<li>å¯¹ä¸€è‡´æ€§è¦æ±‚æœ‰å¤šå¼ºï¼Ÿ</li>
<li>TTL è®¾ç½®çš„æ—¶é•¿</li>
<li>å¹¶å‘å†²çªå¯èƒ½æ€§</li>
<li>çƒ­keyç¼“å­˜å‡»ç©¿ä¿æŠ¤</li>
</ul>
<h3 id="ç¼“å­˜å¼‚å¸¸å¤„ç†ï¼ˆé›ªå´©ã€ç©¿é€ã€å‡»ç©¿ï¼‰"><a href="#ç¼“å­˜å¼‚å¸¸å¤„ç†ï¼ˆé›ªå´©ã€ç©¿é€ã€å‡»ç©¿ï¼‰" class="headerlink" title="ç¼“å­˜å¼‚å¸¸å¤„ç†ï¼ˆé›ªå´©ã€ç©¿é€ã€å‡»ç©¿ï¼‰"></a>ç¼“å­˜å¼‚å¸¸å¤„ç†ï¼ˆé›ªå´©ã€ç©¿é€ã€å‡»ç©¿ï¼‰</h3><h4 id="ä¸‰å¤§ç¼“å­˜é—®é¢˜"><a href="#ä¸‰å¤§ç¼“å­˜é—®é¢˜" class="headerlink" title="ä¸‰å¤§ç¼“å­˜é—®é¢˜"></a>ä¸‰å¤§ç¼“å­˜é—®é¢˜</h4><ol>
<li><strong>ç¼“å­˜é›ªå´©</strong>ï¼šå¤§é¢ç§¯ Key åŒæ—¶å¤±æ•ˆæˆ–åˆ é™¤ï¼Œå¯¼è‡´è¯·æ±‚å…¨éƒ¨æ‰“åˆ° DB</li>
<li><strong>ç¼“å­˜ç©¿é€</strong>ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„ Keyï¼ˆæ¶æ„æ”»å‡»ï¼‰ï¼Œç»•è¿‡ç¼“å­˜ç›´å‡» DB</li>
<li><strong>ç¼“å­˜å‡»ç©¿</strong>ï¼šçƒ­ç‚¹ Key å¤±æ•ˆç¬é—´ï¼Œé«˜å¹¶å‘è¯·æ±‚å‡»ç©¿åˆ° DB</li>
</ol>
<p><strong>è¯¦ç»†æ–¹æ¡ˆ</strong>ï¼š<a href="https://juejin.im/post/6844903651182542856">ç¼“å­˜å¼‚å¸¸è§£å†³æ–¹æ¡ˆ</a></p>
<hr>
<h2 id="äº”ã€æ€§èƒ½ä¼˜åŒ–-1"><a href="#äº”ã€æ€§èƒ½ä¼˜åŒ–-1" class="headerlink" title="äº”ã€æ€§èƒ½ä¼˜åŒ–"></a>äº”ã€æ€§èƒ½ä¼˜åŒ–</h2><blockquote>
<p>ç†è§£ Redis é«˜æ€§èƒ½åŸç†ï¼ŒæŒæ¡æ€§èƒ½è°ƒä¼˜æŠ€å·§ï¼Œè§£å†³å¤§Key&#x2F;çƒ­Keyé—®é¢˜ã€‚</p>
</blockquote>
<hr>
<h3 id="ä¸ºä»€ä¹ˆ-Redis-è¿™ä¹ˆå¿«ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Redis-è¿™ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Redis è¿™ä¹ˆå¿«ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Redis è¿™ä¹ˆå¿«ï¼Ÿ</h3><h4 id="æ ¸å¿ƒåŸå› "><a href="#æ ¸å¿ƒåŸå› " class="headerlink" title="æ ¸å¿ƒåŸå› "></a>æ ¸å¿ƒåŸå› </h4><ol>
<li><strong>å®Œå…¨åŸºäºå†…å­˜</strong>ï¼šç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMapï¼ŒHashMap çš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(1)ï¼›</li>
</ol>
<ul>
<li>2ã€æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedis ä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼›</li>
<li>3ã€é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›</li>
<li>4ã€ä½¿ç”¨å¤šè·¯ I&#x2F;O å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡ IOï¼›</li>
<li>5ã€<strong>è‡ªå»º VM æœºåˆ¶</strong>ï¼šä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedis ç›´æ¥è‡ªå·±æ„å»ºäº† VM æœºåˆ¶ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ã€‚</li>
</ul>
<p><strong>è¯¦ç»†åˆ†æ</strong>ï¼š<a href="http://kaito-kidd.com/2020/06/28/why-redis-so-fast/">å•çº¿ç¨‹ Redis ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</a></p>
<hr>
<h3 id="å•çº¿ç¨‹æ¨¡å‹"><a href="#å•çº¿ç¨‹æ¨¡å‹" class="headerlink" title="å•çº¿ç¨‹æ¨¡å‹"></a>å•çº¿ç¨‹æ¨¡å‹</h3><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹ï¼Ÿ</h4><p><strong>å‚è€ƒ</strong>ï¼š<a href="https://draveness.me/whys-the-design-redis-single-thread/">Redis å•çº¿ç¨‹è®¾è®¡</a></p>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>é¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
<li>æ— éœ€è€ƒè™‘é”é—®é¢˜</li>
<li>å®ç°ç®€å•æ¸…æ™°</li>
</ul>
<p><strong>åŠ£åŠ¿</strong>ï¼š</p>
<ul>
<li>æ— æ³•åˆ©ç”¨å¤šæ ¸ CPU</li>
<li>é•¿è€—æ—¶å‘½ä»¤ä¼šé˜»å¡</li>
</ul>
<hr>
<h3 id="å¤§Keyå’Œçƒ­Keyé—®é¢˜"><a href="#å¤§Keyå’Œçƒ­Keyé—®é¢˜" class="headerlink" title="å¤§Keyå’Œçƒ­Keyé—®é¢˜"></a>å¤§Keyå’Œçƒ­Keyé—®é¢˜</h3><h4 id="ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»€ä¹ˆæ˜¯å¤§ Keyï¼Ÿ</span></span><br><span class="line">- String: value &gt; 10KB</span><br><span class="line">- Hash/List/Set/ZSet: å…ƒç´ æ•°é‡ &gt; 10000</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="åˆ†å¸ƒå¼æ–¹æ¡ˆï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰"><a href="#åˆ†å¸ƒå¼æ–¹æ¡ˆï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰" class="headerlink" title="åˆ†å¸ƒå¼æ–¹æ¡ˆï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰"></a>åˆ†å¸ƒå¼æ–¹æ¡ˆï¼ˆä¸»ä»ã€å“¨å…µã€é›†ç¾¤ï¼‰</h3><h4 id="æ¶æ„æ¼”è¿›è·¯çº¿"><a href="#æ¶æ„æ¼”è¿›è·¯çº¿" class="headerlink" title="æ¶æ„æ¼”è¿›è·¯çº¿"></a>æ¶æ„æ¼”è¿›è·¯çº¿</h4><table>
<thead>
<tr>
<th>é˜¶æ®µ</th>
<th>æ–¹æ¡ˆ</th>
<th>ç‰¹ç‚¹</th>
<th>å±€é™æ€§</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><strong>å•æœºç‰ˆ</strong></td>
<td>ç®€å•ç›´æ¥</td>
<td>å•ç‚¹æ•…éšœã€å®¹é‡æœ‰é™ã€å¹¶å‘æœ‰é™</td>
</tr>
<tr>
<td>2</td>
<td><strong>ä¸»ä»å¤åˆ¶</strong></td>
<td>è¯»å†™åˆ†ç¦»ã€é«˜å¯ç”¨</td>
<td>ä¸»ä»å»¶è¿Ÿã€æ— è‡ªåŠ¨æ•…éšœè½¬ç§»</td>
</tr>
<tr>
<td>3</td>
<td><strong>å“¨å…µæ¨¡å¼ (Sentinel)</strong></td>
<td>è‡ªåŠ¨æ•…éšœè½¬ç§»</td>
<td>éš¾ä»¥æ‰©å®¹ã€ä¸»åº“å†™å…¥ç“¶é¢ˆ</td>
</tr>
<tr>
<td>4</td>
<td><strong>é›†ç¾¤æ¨¡å¼ (Cluster)</strong></td>
<td>æ¨ªå‘æ‰©å±•ã€é«˜å¯ç”¨</td>
<td>å¤æ‚åº¦é«˜ã€è·¨slotæ“ä½œå—é™</td>
</tr>
<tr>
<td>5</td>
<td><strong>Codis</strong></td>
<td>ä¸­å¿ƒåŒ–ç®¡ç†ã€æ˜“è¿ç»´</td>
<td>éœ€è¦é¢å¤–ç»„ä»¶ï¼ˆZookeeperï¼‰</td>
</tr>
</tbody></table>
<h4 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h4><p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸»åº“ï¼ˆMasterï¼‰è´Ÿè´£å†™æ“ä½œ</li>
<li>ä»åº“ï¼ˆSlaveï¼‰è´Ÿè´£è¯»æ“ä½œ</li>
<li>ä¸»åº“æ•°æ®è‡ªåŠ¨åŒæ­¥åˆ°ä»åº“</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¸»ä»å»¶è¿Ÿå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li>
<li>æ— è‡ªåŠ¨æ•…éšœæ¢å¤ï¼Œéœ€äººå·¥ä»‹å…¥</li>
</ul>
<h4 id="å“¨å…µæ¨¡å¼-Sentinel"><a href="#å“¨å…µæ¨¡å¼-Sentinel" class="headerlink" title="å“¨å…µæ¨¡å¼ (Sentinel)"></a>å“¨å…µæ¨¡å¼ (Sentinel)</h4><p><strong>ç›®æ ‡</strong>ï¼šè§£å†³ä¸»ä»å¤åˆ¶çš„è‡ªåŠ¨æ•…éšœæ¢å¤é—®é¢˜</p>
<p><strong>å·¥ä½œæœºåˆ¶</strong>ï¼š</p>
<ul>
<li>ç›‘æ§ä¸»ä»è¿è¡ŒçŠ¶æ€</li>
<li>å½“ Master æ•…éšœæ—¶ï¼Œé€šè¿‡ Raft é€‰ä¸¾</li>
<li>Leader å“¨å…µé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ Slave ä½œä¸ºæ–° Master</li>
<li>å…¶ä»– Slave ä»æ–° Master åŒæ­¥æ•°æ®</li>
</ul>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>éš¾ä»¥æ‰©å®¹</li>
<li>å•æœºå­˜å‚¨ã€è¯»å†™èƒ½åŠ›å—é™</li>
<li>æ‰€æœ‰ Redis èŠ‚ç‚¹éƒ½æœ‰å…¨é‡æ•°æ®ï¼Œå†…å­˜å†—ä½™</li>
</ul>
<h4 id="Redis-Cluster-é›†ç¾¤æ¨¡å¼"><a href="#Redis-Cluster-é›†ç¾¤æ¨¡å¼" class="headerlink" title="Redis Cluster é›†ç¾¤æ¨¡å¼"></a>Redis Cluster é›†ç¾¤æ¨¡å¼</h4><p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ— ä¸­å¿ƒæ¶æ„ï¼Œå»ä¸­å¿ƒåŒ–</li>
<li>æ•°æ®åˆ†ç‰‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨éƒ¨åˆ†æ•°æ®ï¼ˆ16384 ä¸ªæ§½ï¼‰</li>
<li>é€šè¿‡è·¯ç”±æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹</li>
<li>æ”¯æŒæ¨ªå‘å’Œçºµå‘æ‰©å±•</li>
<li>è‡ªåŠ¨æ•…éšœè½¬ç§»</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>å“¨å…µçš„æ‰€æœ‰ä¼˜ç‚¹</li>
<li>å¯åŠ¨æ€æ‰©å®¹&#x2F;ç¼©å®¹</li>
<li>æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨</li>
</ul>
<h4 id="Codis"><a href="#Codis" class="headerlink" title="Codis"></a>Codis</h4><p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>è±Œè±†èšå¼€æºæ–¹æ¡ˆ</li>
<li>ä¸­å¿ƒåŒ–ç®¡ç†ï¼ˆZookeeper&#x2F;Etcdï¼‰</li>
<li>Proxy å±‚è·¯ç”±</li>
<li>Dashboard å¯è§†åŒ–ç®¡ç†</li>
</ul>
<p><strong>GitHub</strong>ï¼š<a href="https://github.com/CodisLabs/codis">https://github.com/CodisLabs/codis</a></p>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://blog.csdn.net/QQ1006207580/article/details/103243281">Redis åˆ†å¸ƒå¼æ¶æ„æ¼”è¿›</a></li>
<li><a href="http://kaito-kidd.com/2020/07/07/redis-cluster-codis-twemproxy/">Redis é›†ç¾¤åŒ–æ–¹æ¡ˆå¯¹æ¯”ï¼šCodisã€Twemproxyã€Redis Cluster</a></li>
</ul>
<hr>
<h3 id="Lua-è„šæœ¬"><a href="#Lua-è„šæœ¬" class="headerlink" title="Lua è„šæœ¬"></a>Lua è„šæœ¬</h3><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨-Luaï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-Luaï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ Luaï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ Luaï¼Ÿ</h4><p>Redis æ‰§è¡Œ Lua è„šæœ¬å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li><strong>åŸå­æ€§</strong>ï¼šè„šæœ¬æ‰§è¡ŒæœŸé—´ä¸ä¼šæ‰§è¡Œå…¶ä»–è„šæœ¬æˆ–å‘½ä»¤</li>
<li><strong>ç‹¬å æ€§</strong>ï¼šRedis ä¸€æ—¦å¼€å§‹æ‰§è¡Œ Lua è„šæœ¬ï¼Œå°±ä¼šä¸€ç›´æ‰§è¡Œå®Œè¯¥è„šæœ¬</li>
<li><strong>åº”ç”¨å¹¿æ³›</strong>ï¼šåˆ†å¸ƒå¼é”ã€é™æµã€ç§’æ€ç­‰åœºæ™¯</li>
</ol>
<h4 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨æ³¨æ„äº‹é¡¹</h4><ul>
<li>ä½¿ç”¨ Lua è„šæœ¬å®ç°åŸå­æ€§æ“ä½œçš„ CASï¼Œé¿å…ä¸åŒå®¢æˆ·ç«¯å…ˆè¯» Redis æ•°æ®ï¼Œç»è¿‡è®¡ç®—åå†å†™æ•°æ®é€ æˆçš„å¹¶å‘é—®é¢˜</li>
<li>å‰åå¤šæ¬¡è¯·æ±‚çš„ç»“æœæœ‰ä¾èµ–å…³ç³»æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ Lua è„šæœ¬å°†å¤šä¸ªè¯·æ±‚æ•´åˆä¸ºä¸€ä¸ªï¼›ä½†è¯·æ±‚å‰åæ— ä¾èµ–æ—¶ï¼Œä½¿ç”¨ pipeline æ–¹å¼ï¼Œæ¯” Lua è„šæœ¬æ–¹ä¾¿</li>
<li>ä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œåœ¨ Lua è„šæœ¬ä¸­ä¸è¦å®šä¹‰è‡ªå·±çš„å…¨å±€å˜é‡ï¼Œä»¥å…æ±¡æŸ“ Redis å†…åµŒçš„ Lua ç¯å¢ƒã€‚å› ä¸º Lua è„šæœ¬ä¸­ä½ ä¼šä½¿ç”¨ä¸€äº›é¢„åˆ¶çš„å…¨å±€å˜é‡ï¼Œæ¯”å¦‚è¯´ redis.call()</li>
<li>æ³¨æ„ Lua è„šæœ¬çš„æ—¶é—´å¤æ‚åº¦ï¼ŒRedis çš„å•çº¿ç¨‹åŒæ ·ä¼šé˜»å¡åœ¨ Lua è„šæœ¬çš„æ‰§è¡Œä¸­ï¼ŒLua è„šæœ¬ä¸è¦è¿›è¡Œé«˜è€—æ—¶æ“ä½œ</li>
<li>Redis è¦æ±‚å•ä¸ª Lua è„šæœ¬æ“ä½œçš„ key å¿…é¡»åœ¨åŒä¸€ä¸ª Redis èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤ Redis Cluster æ–¹å¼éœ€è¦è®¾ç½® HashTagï¼ˆå®é™…ä¸­ä¸å¤ªå»ºè®®è¿™æ ·æ“ä½œï¼‰</li>
</ul>
<hr>
<h2 id="Redis-å¸¸ç”¨å‘½ä»¤"><a href="#Redis-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Redis å¸¸ç”¨å‘½ä»¤"></a>Redis å¸¸ç”¨å‘½ä»¤</h2><h3 id="è¿æ¥å‘½ä»¤"><a href="#è¿æ¥å‘½ä»¤" class="headerlink" title="è¿æ¥å‘½ä»¤"></a>è¿æ¥å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥ Redis</span></span><br><span class="line">redis-cli -h host -p port -a password</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢æ•°æ®åº“</span></span><br><span class="line">SELECT 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•è¿æ¥</span></span><br><span class="line">PING  <span class="comment"># è¿”å› PONG</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸºç¡€å‘½ä»¤"><a href="#åŸºç¡€å‘½ä»¤" class="headerlink" title="åŸºç¡€å‘½ä»¤"></a>åŸºç¡€å‘½ä»¤</h3><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
<th>æ—¶é—´å¤æ‚åº¦</th>
</tr>
</thead>
<tbody><tr>
<td><code>SET key value [NX|XX] [EX seconds]</code></td>
<td>è®¾ç½®é”®å€¼</td>
<td>O(1)</td>
</tr>
<tr>
<td><code>GET key</code></td>
<td>è·å–å€¼</td>
<td>O(1)</td>
</tr>
<tr>
<td><code>DEL key [key ...]</code></td>
<td>åˆ é™¤é”®</td>
<td>O(N)</td>
</tr>
<tr>
<td><code>EXISTS key [key ...]</code></td>
<td>æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨</td>
<td>O(N)</td>
</tr>
<tr>
<td><code>TTL key</code></td>
<td>æŸ¥è¯¢è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</td>
<td>O(1)</td>
</tr>
<tr>
<td><code>EXPIRE key seconds</code></td>
<td>è®¾ç½®è¿‡æœŸæ—¶é—´</td>
<td>O(1)</td>
</tr>
<tr>
<td><code>SCAN cursor [MATCH pattern]</code></td>
<td>æ‰«æé”®ï¼ˆæ¨èï¼‰</td>
<td>O(1)</td>
</tr>
<tr>
<td><code>KEYS pattern</code></td>
<td>æ¨¡å¼åŒ¹é…é”®ï¼ˆâš ï¸ ç”Ÿäº§ç¯å¢ƒç¦ç”¨ï¼‰</td>
<td>O(N)</td>
</tr>
</tbody></table>
<p><strong>âš ï¸ ç”Ÿäº§ç¯å¢ƒæ³¨æ„</strong>ï¼š</p>
<ul>
<li>**ç¦ç”¨ <code>KEYS *</code>**ï¼šéå†æ‰€æœ‰é”®ï¼Œæ—¶é—´å¤æ‚åº¦ O(N)ï¼Œä¼šé˜»å¡ Redis</li>
<li>**æ¨èä½¿ç”¨ <code>SCAN</code>**ï¼šæ¸è¿›å¼éå†ï¼Œä¸é˜»å¡æœåŠ¡å™¨</li>
</ul>
<h2 id="æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§"><a href="#æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§" class="headerlink" title="æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§"></a>æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§</h2><h3 id="å¤§Keyå’Œçƒ­Keyé—®é¢˜-1"><a href="#å¤§Keyå’Œçƒ­Keyé—®é¢˜-1" class="headerlink" title="å¤§Keyå’Œçƒ­Keyé—®é¢˜"></a>å¤§Keyå’Œçƒ­Keyé—®é¢˜</h3><h4 id="ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ-1"><a href="#ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ-1" class="headerlink" title="ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¤§Keyï¼Ÿ</h4><h4 id="å¤§-Key-å±å®³"><a href="#å¤§-Key-å±å®³" class="headerlink" title="å¤§ Key å±å®³"></a>å¤§ Key å±å®³</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»€ä¹ˆæ˜¯å¤§ Keyï¼Ÿ</span></span><br><span class="line">- String: value &gt; 10KB</span><br><span class="line">- Hash/List/Set/ZSet: å…ƒç´ æ•°é‡ &gt; 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±å®³</span></span><br><span class="line">1. å†…å­˜å ç”¨è¿‡å¤§ï¼Œå¯èƒ½ OOM</span><br><span class="line">2. å•ä¸ªæ“ä½œè€—æ—¶é•¿ï¼Œé˜»å¡å…¶ä»–è¯·æ±‚</span><br><span class="line">3. ä¸»ä»åŒæ­¥æ…¢ï¼Œå¯¼è‡´ä»åº“å»¶è¿Ÿ</span><br><span class="line">4. æŒä¹…åŒ–æ…¢ï¼ˆRDB/AOFï¼‰</span><br><span class="line">5. é›†ç¾¤æ•°æ®å€¾æ–œ</span><br></pre></td></tr></table></figure>

<h4 id="å‘ç°å¤§-Key"><a href="#å‘ç°å¤§-Key" class="headerlink" title="å‘ç°å¤§ Key"></a>å‘ç°å¤§ Key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ‰«ææ•´ä¸ªå®ä¾‹</span></span><br><span class="line">redis-cli --bigkeys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ‰«ææŒ‡å®šæ•°æ®åº“</span></span><br><span class="line">redis-cli -n 0 --bigkeys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åˆ†æ RDB æ–‡ä»¶</span></span><br><span class="line">redis-rdb-tools dump.rdb --<span class="built_in">command</span> memory --bytes 10240</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ä½¿ç”¨ MEMORY USAGE å‘½ä»¤</span></span><br><span class="line">redis&gt; MEMORY USAGE mykey</span><br><span class="line">(<span class="built_in">integer</span>) 1048576</span><br></pre></td></tr></table></figure>

<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ‹†åˆ†å¤§ Key</span></span><br><span class="line"><span class="comment">// é”™è¯¯ï¼šå•ä¸ª Hash å­˜å‚¨æ‰€æœ‰å•†å“</span></span><br><span class="line">HSET products <span class="number">1001</span> <span class="string">&quot;&#123;...&#125;&quot;</span> <span class="number">1002</span> <span class="string">&quot;&#123;...&#125;&quot;</span> ... <span class="number">10000</span> <span class="string">&quot;&#123;...&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®ï¼šæŒ‰åˆ†ç‰‡æ‹†åˆ†</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    rdb.HSet(ctx, fmt.Sprintf(<span class="string">&quot;products:shard:%d&quot;</span>, i), productID, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å‹ç¼©æ•°æ®</span></span><br><span class="line">data := compress(largeJSON)</span><br><span class="line">rdb.Set(ctx, key, data)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è®¾ç½®åˆç†è¿‡æœŸæ—¶é—´</span></span><br><span class="line">rdb.Set(ctx, key, value, <span class="number">1</span>*time.Hour)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å¼‚æ­¥åˆ é™¤å¤§ Key</span></span><br><span class="line">rdb.Unlink(ctx, largeKey)  <span class="comment">// éé˜»å¡åˆ é™¤</span></span><br></pre></td></tr></table></figure>

<h4 id="çƒ­-Key-å±å®³"><a href="#çƒ­-Key-å±å®³" class="headerlink" title="çƒ­ Key å±å®³"></a>çƒ­ Key å±å®³</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»€ä¹ˆæ˜¯çƒ­ Keyï¼Ÿ</span></span><br><span class="line">QPS &gt; 10000 çš„ Keyï¼ˆå¦‚ç§’æ€å•†å“ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="comment"># å±å®³</span></span><br><span class="line">1. å•ä¸ª Redis èŠ‚ç‚¹æµé‡è¿‡å¤§</span><br><span class="line">2. CPU å ç”¨è¿‡é«˜</span><br><span class="line">3. ç½‘ç»œå¸¦å®½æ‰“æ»¡</span><br><span class="line">4. é›†ç¾¤èŠ‚ç‚¹è´Ÿè½½ä¸å‡</span><br></pre></td></tr></table></figure>

<h4 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æœ¬åœ°ç¼“å­˜ + Redis äºŒçº§ç¼“å­˜</span></span><br><span class="line">localCache := cache.New(<span class="number">5</span>*time.Minute, <span class="number">10</span>*time.Minute)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetHotKey</span><span class="params">(key <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// å…ˆæŸ¥æœ¬åœ°ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">if</span> val, found := localCache.Get(key); found &#123;</span><br><span class="line">        <span class="keyword">return</span> val.(<span class="type">string</span>), <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†æŸ¥ Redis</span></span><br><span class="line">    val, err := rdb.Get(ctx, key).Result()</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        localCache.Set(key, val, cache.DefaultExpiration)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å¤šå‰¯æœ¬åˆ†æ•£è¯·æ±‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetHotKeyWithReplica</span><span class="params">(key <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// éšæœºé€‰æ‹©å‰¯æœ¬</span></span><br><span class="line">    replica := rand.Intn(<span class="number">10</span>)</span><br><span class="line">    replicaKey := fmt.Sprintf(<span class="string">&quot;%s:replica:%d&quot;</span>, key, replica)</span><br><span class="line">    <span class="keyword">return</span> rdb.Get(ctx, replicaKey).Result()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. é™æµä¿æŠ¤</span></span><br><span class="line">limiter := rate.NewLimiter(<span class="number">10000</span>, <span class="number">20000</span>)  <span class="comment">// 10000 QPS, burst 20000</span></span><br><span class="line"><span class="keyword">if</span> !limiter.Allow() &#123;</span><br><span class="line">    <span class="keyword">return</span> ErrTooManyRequests</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ç›‘æ§æŒ‡æ ‡"><a href="#ç›‘æ§æŒ‡æ ‡" class="headerlink" title="ç›‘æ§æŒ‡æ ‡"></a>ç›‘æ§æŒ‡æ ‡</h3><h4 id="å…³é”®æŒ‡æ ‡"><a href="#å…³é”®æŒ‡æ ‡" class="headerlink" title="å…³é”®æŒ‡æ ‡"></a>å…³é”®æŒ‡æ ‡</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. å†…å­˜ä½¿ç”¨</span></span><br><span class="line">redis&gt; INFO memory</span><br><span class="line">used_memory:1073741824             <span class="comment"># å·²ä½¿ç”¨å†…å­˜</span></span><br><span class="line">used_memory_peak:2147483648        <span class="comment"># å³°å€¼å†…å­˜</span></span><br><span class="line">used_memory_rss:1610612736         <span class="comment"># ç‰©ç†å†…å­˜</span></span><br><span class="line">mem_fragmentation_ratio:1.5        <span class="comment"># ç¢ç‰‡ç‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. æ€§èƒ½æŒ‡æ ‡</span></span><br><span class="line">redis&gt; INFO stats</span><br><span class="line">instantaneous_ops_per_sec:10000    <span class="comment"># å½“å‰ QPS</span></span><br><span class="line">total_commands_processed:1000000   <span class="comment"># æ€»å‘½ä»¤æ•°</span></span><br><span class="line">rejected_connections:0             <span class="comment"># æ‹’ç»è¿æ¥æ•°</span></span><br><span class="line">expired_keys:1000                  <span class="comment"># è¿‡æœŸé”®æ•°é‡</span></span><br><span class="line">evicted_keys:0                     <span class="comment"># æ·˜æ±°é”®æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æŒä¹…åŒ–</span></span><br><span class="line">redis&gt; INFO persistence</span><br><span class="line">rdb_last_save_time:1641024000      <span class="comment"># æœ€å RDB æ—¶é—´</span></span><br><span class="line">rdb_changes_since_last_save:1000   <span class="comment"># è‡ªä¸Šæ¬¡ RDB å˜æ›´æ•°</span></span><br><span class="line">aof_enabled:1                      <span class="comment"># AOF æ˜¯å¦å¼€å¯</span></span><br><span class="line">aof_last_rewrite_time_sec:2        <span class="comment"># æœ€å AOF é‡å†™è€—æ—¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å¤åˆ¶</span></span><br><span class="line">redis&gt; INFO replication</span><br><span class="line">role:master                        <span class="comment"># è§’è‰²</span></span><br><span class="line">connected_slaves:2                 <span class="comment"># ä»åº“æ•°é‡</span></span><br><span class="line">master_repl_offset:1000000         <span class="comment"># ä¸»åº“åç§»é‡</span></span><br><span class="line">repl_backlog_size:1048576          <span class="comment"># ç§¯å‹ç¼“å†²åŒºå¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. æ…¢æŸ¥è¯¢</span></span><br><span class="line">redis&gt; SLOWLOG GET 10</span><br><span class="line">1) 1) (<span class="built_in">integer</span>) 1</span><br><span class="line">   2) (<span class="built_in">integer</span>) 1641024000</span><br><span class="line">   3) (<span class="built_in">integer</span>) 50000              <span class="comment"># è€—æ—¶ 50ms</span></span><br><span class="line">   4) 1) <span class="string">&quot;KEYS&quot;</span></span><br><span class="line">      2) <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç›‘æ§å‘Šè­¦"><a href="#ç›‘æ§å‘Šè­¦" class="headerlink" title="ç›‘æ§å‘Šè­¦"></a>ç›‘æ§å‘Šè­¦</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Prometheus ç›‘æ§è§„åˆ™</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis_alerts</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="comment"># å†…å­˜ä½¿ç”¨ç‡ &gt; 80%</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RedisMemoryHigh</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">redis_memory_used_bytes</span> <span class="string">/</span> <span class="string">redis_memory_max_bytes</span> <span class="string">&gt;</span> <span class="number">0.8</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">        </span><br><span class="line">      <span class="comment"># QPS &gt; 50000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RedisQPSHigh</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">rate(redis_commands_processed_total[1m])</span> <span class="string">&gt;</span> <span class="number">50000</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">        </span><br><span class="line">      <span class="comment"># æ…¢æŸ¥è¯¢ &gt; 10ms</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RedisSlowLog</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">redis_slowlog_length</span> <span class="string">&gt;</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">10m</span></span><br><span class="line">        </span><br><span class="line">      <span class="comment"># ä¸»ä»å»¶è¿Ÿ &gt; 10s</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">RedisReplLag</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">redis_master_repl_offset</span> <span class="bullet">-</span> <span class="string">redis_slave_repl_offset</span> <span class="string">&gt;</span> <span class="number">10000000</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…­ã€å®æˆ˜æ¡ˆä¾‹-1"><a href="#å…­ã€å®æˆ˜æ¡ˆä¾‹-1" class="headerlink" title="å…­ã€å®æˆ˜æ¡ˆä¾‹"></a>å…­ã€å®æˆ˜æ¡ˆä¾‹</h2><blockquote>
<p>åŸºäºçœŸå®ä¸šåŠ¡åœºæ™¯ï¼ŒæŒæ¡åˆ†å¸ƒå¼é”ã€BloomFilterã€ç§’æ€ã€æ’è¡Œæ¦œç­‰é«˜çº§åº”ç”¨ã€‚</p>
</blockquote>
<hr>
<h3 id="åˆ†å¸ƒå¼é”å®ç°"><a href="#åˆ†å¸ƒå¼é”å®ç°" class="headerlink" title="åˆ†å¸ƒå¼é”å®ç°"></a>åˆ†å¸ƒå¼é”å®ç°</h3><p>Redis ä¸ºå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼ï¼Œé‡‡ç”¨é˜Ÿåˆ—æ¨¡å¼å°†å¹¶å‘è®¿é—®å˜æˆä¸²è¡Œè®¿é—®ï¼Œä¸”å¤šå®¢æˆ·ç«¯å¯¹ Redis çš„è¿æ¥å¹¶ä¸å­˜åœ¨ç«äº‰å…³ç³»ã€‚</p>
<h4 id="åŸºæœ¬å®ç°"><a href="#åŸºæœ¬å®ç°" class="headerlink" title="åŸºæœ¬å®ç°"></a>åŸºæœ¬å®ç°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SETNX + EXPIRE å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Lock</span><span class="params">(key <span class="type">string</span>, value <span class="type">string</span>, expiration time.Duration)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> rdb.SetNX(ctx, key, value, expiration).Val()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unlock</span><span class="params">(key <span class="type">string</span>, value <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Lua ä¿è¯åŸå­æ€§</span></span><br><span class="line">    script := <span class="string">`</span></span><br><span class="line"><span class="string">        if redis.call(&quot;get&quot;, KEYS[1]) == ARGV[1] then</span></span><br><span class="line"><span class="string">            return redis.call(&quot;del&quot;, KEYS[1])</span></span><br><span class="line"><span class="string">        else</span></span><br><span class="line"><span class="string">            return 0</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    <span class="keyword">return</span> rdb.Eval(ctx, script, []<span class="type">string</span>&#123;key&#125;, value).Err()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¯¦ç»†å®ç°</strong>ï¼š<a href="https://juejin.cn/post/6936956908007850014">Redis åˆ†å¸ƒå¼é”</a></p>
<hr>
<h3 id="BloomFilter-å®è·µ"><a href="#BloomFilter-å®è·µ" class="headerlink" title="BloomFilter å®è·µ"></a>BloomFilter å®è·µ</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>BloomFilter ç”¨äºå¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œ<strong>å…è®¸è¯¯åˆ¤ï¼ˆFalse Positiveï¼‰</strong>ï¼Œä½†<strong>ä¸ä¼šæ¼åˆ¤ï¼ˆNo False Negativeï¼‰</strong>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åˆ¤æ–­ç»“æœ = ä¸€å®šä¸å­˜åœ¨ or å¯èƒ½å­˜åœ¨</span><br></pre></td></tr></table></figure>

<h3 id="å…¬å¼"><a href="#å…¬å¼" class="headerlink" title="å…¬å¼"></a>å…¬å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">m = -n*ln(p) / (ln2)Â²    # ä½æ•°ç»„å¤§å°</span><br><span class="line">k = m/n * ln2            # å“ˆå¸Œå‡½æ•°æ•°é‡</span><br><span class="line"></span><br><span class="line">n = é¢„æœŸå…ƒç´ æ•°é‡</span><br><span class="line">p = è¯¯åˆ¤ç‡</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">n = 1,000,000ï¼ˆç™¾ä¸‡æ•°æ®ï¼‰</span><br><span class="line">p = 0.01ï¼ˆ1% è¯¯åˆ¤ç‡ï¼‰</span><br><span class="line"></span><br><span class="line">m = 9,585,059 bits â‰ˆ 1.15 MB</span><br><span class="line">k = 7 ä¸ªå“ˆå¸Œå‡½æ•°</span><br></pre></td></tr></table></figure>

<h3 id="Redis-å®ç°"><a href="#Redis-å®ç°" class="headerlink" title="Redis å®ç°"></a>Redis å®ç°</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/bits-and-blooms/bloom/v3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. åˆ›å»º BloomFilter</span></span><br><span class="line">bf := bloom.NewWithEstimates(<span class="number">1000000</span>, <span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ·»åŠ å…ƒç´ </span></span><br><span class="line">bf.Add([]<span class="type">byte</span>(<span class="string">&quot;user:123&quot;</span>))</span><br><span class="line">bf.Add([]<span class="type">byte</span>(<span class="string">&quot;user:456&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æŸ¥è¯¢å…ƒç´ </span></span><br><span class="line">exists := bf.Test([]<span class="type">byte</span>(<span class="string">&quot;user:123&quot;</span>))  <span class="comment">// true</span></span><br><span class="line">exists = bf.Test([]<span class="type">byte</span>(<span class="string">&quot;user:999&quot;</span>))   <span class="comment">// false æˆ– trueï¼ˆè¯¯åˆ¤ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. åºåˆ—åŒ–åˆ° Redis</span></span><br><span class="line">data, _ := bf.GobEncode()</span><br><span class="line">rdb.Set(ctx, <span class="string">&quot;bloomfilter:users&quot;</span>, data, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. ä» Redis åŠ è½½</span></span><br><span class="line">data, _ := rdb.Get(ctx, <span class="string">&quot;bloomfilter:users&quot;</span>).Bytes()</span><br><span class="line">bf := bloom.New(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">bf.GobDecode(data)</span><br></pre></td></tr></table></figure>

<h3 id="åº”ç”¨åœºæ™¯-4"><a href="#åº”ç”¨åœºæ™¯-4" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. é˜²æ­¢ç¼“å­˜ç©¿é€</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUser</span><span class="params">(uid <span class="type">string</span>)</span></span> (*User, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// å…ˆæŸ¥ BloomFilter</span></span><br><span class="line">    <span class="keyword">if</span> !bloomFilter.Test([]<span class="type">byte</span>(uid)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, ErrUserNotFound  <span class="comment">// ä¸€å®šä¸å­˜åœ¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å†æŸ¥ç¼“å­˜å’Œ DB</span></span><br><span class="line">    <span class="keyword">return</span> getUserFromCacheOrDB(uid)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å»é‡ï¼ˆçˆ¬è™« URLï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ShouldCrawl</span><span class="params">(url <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> bloomFilter.Test([]<span class="type">byte</span>(url)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>  <span class="comment">// å¯èƒ½å·²çˆ¬å–</span></span><br><span class="line">    &#125;</span><br><span class="line">    bloomFilter.Add([]<span class="type">byte</span>(url))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ¨èç³»ç»Ÿå»é‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FilterRecommendations</span><span class="params">(userID <span class="type">string</span>, items []<span class="type">string</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result []<span class="type">string</span></span><br><span class="line">    <span class="keyword">for</span> _, item := <span class="keyword">range</span> items &#123;</span><br><span class="line">        key := userID + <span class="string">&quot;:&quot;</span> + item</span><br><span class="line">        <span class="keyword">if</span> !viewedBF.Test([]<span class="type">byte</span>(key)) &#123;</span><br><span class="line">            result = <span class="built_in">append</span>(result, item)  <span class="comment">// æœªçœ‹è¿‡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ç§’æ€ç³»ç»Ÿè®¾è®¡"><a href="#ç§’æ€ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç§’æ€ç³»ç»Ÿè®¾è®¡"></a>ç§’æ€ç³»ç»Ÿè®¾è®¡</h2><h3 id="æ ¸å¿ƒé—®é¢˜"><a href="#æ ¸å¿ƒé—®é¢˜" class="headerlink" title="æ ¸å¿ƒé—®é¢˜"></a>æ ¸å¿ƒé—®é¢˜</h3><ol>
<li><strong>è¶…å–é—®é¢˜</strong>ï¼šåº“å­˜ä¸º 10ï¼Œå–å‡º 100 å•</li>
<li><strong>é«˜å¹¶å‘é—®é¢˜</strong>ï¼šç¬æ—¶ 10w+ QPS</li>
<li><strong>æ¶æ„åˆ·å•</strong>ï¼šæœºå™¨äººåˆ·å•</li>
</ol>
<h3 id="æ–¹æ¡ˆè®¾è®¡"><a href="#æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="æ–¹æ¡ˆè®¾è®¡"></a>æ–¹æ¡ˆè®¾è®¡</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. é¢„çƒ­åº“å­˜åˆ° Redis</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PreloadStock</span><span class="params">(productID <span class="type">string</span>, stock <span class="type">int</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    key := fmt.Sprintf(<span class="string">&quot;seckill:stock:%s&quot;</span>, productID)</span><br><span class="line">    <span class="keyword">return</span> rdb.Set(ctx, key, stock, <span class="number">0</span>).Err()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Lua è„šæœ¬ä¿è¯åŸå­æ€§æ‰£åº“å­˜</span></span><br><span class="line"><span class="keyword">var</span> decrStockScript = redis.NewScript(<span class="string">`</span></span><br><span class="line"><span class="string">    local key = KEYS[1]</span></span><br><span class="line"><span class="string">    local stock = tonumber(redis.call(&#x27;GET&#x27;, key))</span></span><br><span class="line"><span class="string">    if stock &lt;= 0 then</span></span><br><span class="line"><span class="string">        return -1  -- åº“å­˜ä¸è¶³</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    redis.call(&#x27;DECR&#x27;, key)</span></span><br><span class="line"><span class="string">    return stock - 1</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DecrStock</span><span class="params">(productID <span class="type">string</span>)</span></span> (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    key := fmt.Sprintf(<span class="string">&quot;seckill:stock:%s&quot;</span>, productID)</span><br><span class="line">    result, err := decrStockScript.Run(ctx, rdb, []<span class="type">string</span>&#123;key&#125;).Int()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> result &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, ErrStockNotEnough</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. é™æµ + é˜Ÿåˆ—å‰Šå³°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleSeckill</span><span class="params">(userID, productID <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="comment">// 3.1 ç”¨æˆ·çº§é™æµ</span></span><br><span class="line">    limitKey := fmt.Sprintf(<span class="string">&quot;limit:user:%s&quot;</span>, userID)</span><br><span class="line">    count := rdb.Incr(ctx, limitKey).Val()</span><br><span class="line">    <span class="keyword">if</span> count == <span class="number">1</span> &#123;</span><br><span class="line">        rdb.Expire(ctx, limitKey, <span class="number">60</span>*time.Second)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> count &gt; <span class="number">5</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ErrTooManyRequests  <span class="comment">// 1åˆ†é’Ÿæœ€å¤š5æ¬¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.2 æ‰£åº“å­˜</span></span><br><span class="line">    stock, err := DecrStock(productID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.3 å¼‚æ­¥åˆ›å»ºè®¢å•ï¼ˆæ”¾å…¥é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">    order := Order&#123;</span><br><span class="line">        UserID:    userID,</span><br><span class="line">        ProductID: productID,</span><br><span class="line">        CreatedAt: time.Now(),</span><br><span class="line">    &#125;</span><br><span class="line">    rdb.LPush(ctx, <span class="string">&quot;queue:orders&quot;</span>, json.Marshal(order))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. æ¶ˆè´¹è®¢å•é˜Ÿåˆ—</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ProcessOrders</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        data, err := rdb.BRPop(ctx, <span class="number">5</span>*time.Second, <span class="string">&quot;queue:orders&quot;</span>).Result()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> order Order</span><br><span class="line">        json.Unmarshal([]<span class="type">byte</span>(data[<span class="number">1</span>]), &amp;order)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å†™å…¥ MySQL</span></span><br><span class="line">        db.CreateOrder(&amp;order)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ’è¡Œæ¦œå®ç°"><a href="#æ’è¡Œæ¦œå®ç°" class="headerlink" title="æ’è¡Œæ¦œå®ç°"></a>æ’è¡Œæ¦œå®ç°</h2><h3 id="å®æ—¶æ’è¡Œæ¦œ"><a href="#å®æ—¶æ’è¡Œæ¦œ" class="headerlink" title="å®æ—¶æ’è¡Œæ¦œ"></a>å®æ—¶æ’è¡Œæ¦œ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ›´æ–°åˆ†æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateScore</span><span class="params">(userID <span class="type">string</span>, score <span class="type">int64</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> rdb.ZAdd(ctx, <span class="string">&quot;rank:realtime&quot;</span>, &amp;redis.Z&#123;</span><br><span class="line">        Score:  <span class="type">float64</span>(score),</span><br><span class="line">        Member: userID,</span><br><span class="line">    &#125;).Err()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è·å–æ’è¡Œæ¦œ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetTopN</span><span class="params">(n <span class="type">int</span>)</span></span> ([]User, <span class="type">error</span>) &#123;</span><br><span class="line">    <span class="comment">// è·å–å‰ N åï¼ˆåˆ†æ•°ä»é«˜åˆ°ä½ï¼‰</span></span><br><span class="line">    result, err := rdb.ZRevRangeWithScores(ctx, <span class="string">&quot;rank:realtime&quot;</span>, <span class="number">0</span>, <span class="type">int64</span>(n<span class="number">-1</span>)).Result()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> users []User</span><br><span class="line">    <span class="keyword">for</span> _, z := <span class="keyword">range</span> result &#123;</span><br><span class="line">        users = <span class="built_in">append</span>(users, User&#123;</span><br><span class="line">            ID:    z.Member.(<span class="type">string</span>),</span><br><span class="line">            Score: <span class="type">int64</span>(z.Score),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> users, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è·å–ç”¨æˆ·æ’å</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserRank</span><span class="params">(userID <span class="type">string</span>)</span></span> (<span class="type">int64</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    rank, err := rdb.ZRevRank(ctx, <span class="string">&quot;rank:realtime&quot;</span>, userID).Result()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> rank + <span class="number">1</span>, <span class="literal">nil</span>  <span class="comment">// æ’åä» 1 å¼€å§‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. è·å–ç”¨æˆ·åˆ†æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserScore</span><span class="params">(userID <span class="type">string</span>)</span></span> (<span class="type">int64</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    score, err := rdb.ZScore(ctx, <span class="string">&quot;rank:realtime&quot;</span>, userID).Result()</span><br><span class="line">    <span class="keyword">return</span> <span class="type">int64</span>(score), err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. è·å–æˆ‘çš„é™„è¿‘æ’åï¼ˆå‰åå„5åï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetNearbyRank</span><span class="params">(userID <span class="type">string</span>)</span></span> ([]User, <span class="type">error</span>) &#123;</span><br><span class="line">    rank, err := rdb.ZRevRank(ctx, <span class="string">&quot;rank:realtime&quot;</span>, userID).Result()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    start := rank - <span class="number">5</span></span><br><span class="line">    <span class="keyword">if</span> start &lt; <span class="number">0</span> &#123;</span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    end := rank + <span class="number">5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> rdb.ZRevRangeWithScores(ctx, <span class="string">&quot;rank:realtime&quot;</span>, start, end).Result()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¯æ—¥æ’è¡Œæ¦œï¼ˆè‡ªåŠ¨è¿‡æœŸï¼‰"><a href="#æ¯æ—¥æ’è¡Œæ¦œï¼ˆè‡ªåŠ¨è¿‡æœŸï¼‰" class="headerlink" title="æ¯æ—¥æ’è¡Œæ¦œï¼ˆè‡ªåŠ¨è¿‡æœŸï¼‰"></a>æ¯æ—¥æ’è¡Œæ¦œï¼ˆè‡ªåŠ¨è¿‡æœŸï¼‰</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateDailyScore</span><span class="params">(userID <span class="type">string</span>, score <span class="type">int64</span>, date time.Time)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    key := fmt.Sprintf(<span class="string">&quot;rank:daily:%s&quot;</span>, date.Format(<span class="string">&quot;2006-01-02&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°åˆ†æ•°</span></span><br><span class="line">    pipe := rdb.Pipeline()</span><br><span class="line">    pipe.ZAdd(ctx, key, &amp;redis.Z&#123;Score: <span class="type">float64</span>(score), Member: userID&#125;)</span><br><span class="line">    pipe.Expire(ctx, key, <span class="number">7</span>*<span class="number">24</span>*time.Hour)  <span class="comment">// 7å¤©åè¿‡æœŸ</span></span><br><span class="line">    _, err := pipe.Exec(ctx)</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="SDK-æ¨è"><a href="#SDK-æ¨è" class="headerlink" title="SDK æ¨è"></a>SDK æ¨è</h2><h3 id="Go-Client"><a href="#Go-Client" class="headerlink" title="Go Client"></a>Go Client</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. go-redisï¼ˆæ¨èï¼‰</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/redis/go-redis/v9&quot;</span></span><br><span class="line"></span><br><span class="line">rdb := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">    Addr:     <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">    Password: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    DB:       <span class="number">0</span>,</span><br><span class="line">    PoolSize: <span class="number">100</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. redigo</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;github.com/gomodule/redigo/redis&quot;</span></span><br><span class="line"></span><br><span class="line">pool := &amp;redis.Pool&#123;</span><br><span class="line">    MaxIdle:     <span class="number">10</span>,</span><br><span class="line">    MaxActive:   <span class="number">100</span>,</span><br><span class="line">    IdleTimeout: <span class="number">300</span> * time.Second,</span><br><span class="line">    Dial: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> (redis.Conn, <span class="type">error</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> redis.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;localhost:6379&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“"><a href="#æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“"></a>æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</h2><h3 id="å…³é”®æ•°å­—è®°å¿†"><a href="#å…³é”®æ•°å­—è®°å¿†" class="headerlink" title="å…³é”®æ•°å­—è®°å¿†"></a>å…³é”®æ•°å­—è®°å¿†</h3><table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>æ•°å€¼</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ€§èƒ½</strong></td>
<td>10w+ QPS</td>
<td>å•æœº Redis æ€§èƒ½</td>
</tr>
<tr>
<td><strong>å»¶è¿Ÿ</strong></td>
<td>1ms</td>
<td>å†…å­˜æ“ä½œå¹³å‡å»¶è¿Ÿ</td>
</tr>
<tr>
<td><strong>ziplist é˜ˆå€¼</strong></td>
<td>512 entries, 64B</td>
<td>Hash&#x2F;List é»˜è®¤é˜ˆå€¼</td>
</tr>
<tr>
<td><strong>zset ziplist</strong></td>
<td>128 entries, 64B</td>
<td>ZSet é»˜è®¤é˜ˆå€¼</td>
</tr>
<tr>
<td><strong>å¤§ Key</strong></td>
<td>&gt; 10KB or &gt; 10000</td>
<td>éœ€è¦æ‹†åˆ†</td>
</tr>
<tr>
<td><strong>æ…¢æŸ¥è¯¢</strong></td>
<td>&gt; 10ms</td>
<td>éœ€è¦ä¼˜åŒ–</td>
</tr>
<tr>
<td><strong>å†…å­˜ç¢ç‰‡ç‡</strong></td>
<td>1.0 - 1.5</td>
<td>æ­£å¸¸èŒƒå›´</td>
</tr>
<tr>
<td><strong>ä¸»ä»å»¶è¿Ÿ</strong></td>
<td>&lt; 1s</td>
<td>å¥åº·çŠ¶æ€</td>
</tr>
</tbody></table>
<h3 id="æ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘"><a href="#æ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘" class="headerlink" title="æ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘"></a>æ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">éœ€æ±‚ï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">â”œâ”€ åªéœ€è¦ç®€å•çš„ key-valueï¼Ÿ</span><br><span class="line">â”‚  â””â”€ æ˜¯ â†’ Stringï¼ˆJSONï¼‰</span><br><span class="line">â”œâ”€ éœ€è¦éƒ¨åˆ†å­—æ®µæ›´æ–°ï¼Ÿ</span><br><span class="line">â”‚  â”œâ”€ å­—æ®µæ•° &lt; 500 â†’ Hashï¼ˆziplistï¼‰</span><br><span class="line">â”‚  â””â”€ å­—æ®µæ•° &gt; 500 â†’ Hashï¼ˆhashtableï¼‰</span><br><span class="line">â”œâ”€ éœ€è¦æŒ‰é¡ºåºå­˜å‚¨ï¼Ÿ</span><br><span class="line">â”‚  â”œâ”€ æ¶ˆæ¯é˜Ÿåˆ— â†’ Listï¼ˆquicklistï¼‰</span><br><span class="line">â”‚  â”œâ”€ å»é‡é›†åˆ â†’ Setï¼ˆintset/hashtableï¼‰</span><br><span class="line">â”‚  â””â”€ æœ‰åºé›†åˆ â†’ ZSetï¼ˆziplist/skiplistï¼‰</span><br></pre></td></tr></table></figure>

<h3 id="ç¼“å­˜è®¾è®¡æ£€æŸ¥æ¸…å•"><a href="#ç¼“å­˜è®¾è®¡æ£€æŸ¥æ¸…å•" class="headerlink" title="ç¼“å­˜è®¾è®¡æ£€æŸ¥æ¸…å•"></a>ç¼“å­˜è®¾è®¡æ£€æŸ¥æ¸…å•</h3><ul>
<li><input disabled="" type="checkbox"> æ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦æœ‰ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼ˆå†™ç©¿&#x2F;å†™å›&#x2F;æ—è·¯ï¼‰ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦å¤„ç†äº†ç¼“å­˜ç©¿é€ï¼ˆBloomFilterï¼‰ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦å¤„ç†äº†ç¼“å­˜å‡»ç©¿ï¼ˆåˆ†å¸ƒå¼é”&#x2F;singleflightï¼‰ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦å¤„ç†äº†ç¼“å­˜é›ªå´©ï¼ˆéšæœºTTLï¼‰ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦ç›‘æ§äº†å¤§ Key å’Œçƒ­ Keyï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦è®¾ç½®äº†å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦é…ç½®äº†æŒä¹…åŒ–ï¼ˆRDB&#x2F;AOFï¼‰ï¼Ÿ</li>
<li><input disabled="" type="checkbox"> æ˜¯å¦è€ƒè™‘äº†ä¸»ä»&#x2F;é›†ç¾¤é«˜å¯ç”¨ï¼Ÿ</li>
</ul>
<h3 id="æœ€ä½³å®è·µé€ŸæŸ¥"><a href="#æœ€ä½³å®è·µé€ŸæŸ¥" class="headerlink" title="æœ€ä½³å®è·µé€ŸæŸ¥"></a>æœ€ä½³å®è·µé€ŸæŸ¥</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ¨èåšæ³•</span></span><br><span class="line"><span class="number">1.</span> è®¾ç½®è¿‡æœŸæ—¶é—´ï¼šrdb.Set(ctx, key, val, <span class="number">1</span>*time.Hour)</span><br><span class="line"><span class="number">2.</span> ä½¿ç”¨ Pipeline æ‰¹é‡æ“ä½œï¼špipe.HSet(ctx, key, field, val)</span><br><span class="line"><span class="number">3.</span> é¿å… KEYS å‘½ä»¤ï¼šä½¿ç”¨ SCAN æ›¿ä»£</span><br><span class="line"><span class="number">4.</span> ä½¿ç”¨ Lua ä¿è¯åŸå­æ€§ï¼šscript.Run(ctx, rdb, keys, args)</span><br><span class="line"><span class="number">5.</span> å¤§ Key æ‹†åˆ†ï¼šæŒ‰å“ˆå¸Œåˆ†ç‰‡æˆ–æŒ‰æ—¶é—´åˆ†æ®µ</span><br><span class="line"><span class="number">6.</span> çƒ­ Key æœ¬åœ°ç¼“å­˜ï¼šlocalCache + Redis äºŒçº§ç¼“å­˜</span><br><span class="line"><span class="number">7.</span> ä½¿ç”¨è¿æ¥æ± ï¼šPoolSize: <span class="number">100</span></span><br><span class="line"><span class="number">8.</span> è®¾ç½®è¶…æ—¶ï¼šDialTimeout/ReadTimeout/WriteTimeout</span><br><span class="line"></span><br><span class="line"><span class="comment">// âŒ é¿å…åšæ³•</span></span><br><span class="line"><span class="number">1.</span> ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå†…å­˜æ³„æ¼ï¼‰</span><br><span class="line"><span class="number">2.</span> å•æ¬¡æ“ä½œå¤§é‡æ•°æ®ï¼ˆé˜»å¡ï¼‰</span><br><span class="line"><span class="number">3.</span> åœ¨å¾ªç¯ä¸­å‘é€å‘½ä»¤ï¼ˆç½‘ç»œ RTTï¼‰</span><br><span class="line"><span class="number">4.</span> ä½¿ç”¨ KEYS * å‘½ä»¤ï¼ˆé˜»å¡ï¼‰</span><br><span class="line"><span class="number">5.</span> å•ä¸ª Key è¿‡å¤§ï¼ˆ&gt; <span class="number">10</span>MBï¼‰</span><br><span class="line"><span class="number">6.</span> é¢‘ç¹åˆ›å»ºè¿æ¥ï¼ˆæ€§èƒ½å·®ï¼‰</span><br><span class="line"><span class="number">7.</span> æ— ç›‘æ§å‘Šè­¦ï¼ˆé—®é¢˜å‘ç°æ…¢ï¼‰</span><br><span class="line"><span class="number">8.</span> ä¸åšæŒä¹…åŒ–ï¼ˆæ•°æ®ä¸¢å¤±ï¼‰</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¯è§†åŒ–å›¾è¡¨ç´¢å¼•"><a href="#å¯è§†åŒ–å›¾è¡¨ç´¢å¼•" class="headerlink" title="å¯è§†åŒ–å›¾è¡¨ç´¢å¼•"></a>å¯è§†åŒ–å›¾è¡¨ç´¢å¼•</h2><p>æœ¬æ–‡åŒ…å«è¯¦ç»†çš„æ•°æ®ç»“æ„å¯è§†åŒ–å›¾è¡¨ï¼Œè¯¦è§ï¼š</p>
<h3 id="Hash-ç›¸å…³"><a href="#Hash-ç›¸å…³" class="headerlink" title="Hash ç›¸å…³"></a>Hash ç›¸å…³</h3><ul>
<li><a href="/diagrams/mermaid/redis-hashtable.mmd">redis-hashtable.mmd</a> - Dict å’Œ Hashtable ç»“æ„</li>
<li><a href="/diagrams/mermaid/redis-rehash-process.mmd">redis-rehash-process.mmd</a> - æ¸è¿›å¼ Rehash æµç¨‹</li>
<li><a href="/diagrams/mermaid/redis-hash-encoding.mmd">redis-hash-encoding.mmd</a> - ziplist vs hashtable å¯¹æ¯”</li>
<li><a href="/diagrams/mermaid/redis-hashtable-preview.md">redis-hashtable-preview.md</a> - å®Œæ•´é¢„è§ˆ</li>
</ul>
<h3 id="Ziplist-ç›¸å…³"><a href="#Ziplist-ç›¸å…³" class="headerlink" title="Ziplist ç›¸å…³"></a>Ziplist ç›¸å…³</h3><ul>
<li><a href="/diagrams/mermaid/redis-ziplist-detail.mmd">redis-ziplist-detail.mmd</a> - Ziplist è¯¦ç»†ç»“æ„</li>
<li><a href="/diagrams/mermaid/redis-ziplist-memory.mmd">redis-ziplist-memory.mmd</a> - å†…å­˜å¸ƒå±€å®ä¾‹</li>
<li><a href="/diagrams/mermaid/redis-ziplist-hash-visual.mmd">redis-ziplist-hash-visual.mmd</a> - Hash å®æˆ˜å¯è§†åŒ–</li>
<li><a href="/diagrams/mermaid/redis-ziplist-hash-preview.md">redis-ziplist-hash-preview.md</a> - å®æˆ˜é¢„è§ˆ â­</li>
</ul>
<h3 id="å®æˆ˜æ¡ˆä¾‹"><a href="#å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h3><ul>
<li><a href="/diagrams/mermaid/redis-ziplist-hash-example.md">redis-ziplist-hash-example.md</a> - Hash <code>&#123;name:&quot;iPhone&quot;, price:5999&#125;</code> å®Œæ•´åˆ†æï¼ˆå­—èŠ‚çº§ï¼‰</li>
</ul>
<h3 id="æ•°æ®ç»“æ„å¯¹æ¯”"><a href="#æ•°æ®ç»“æ„å¯¹æ¯”" class="headerlink" title="æ•°æ®ç»“æ„å¯¹æ¯”"></a>æ•°æ®ç»“æ„å¯¹æ¯”</h3><ul>
<li><a href="/diagrams/mermaid/redis-datastructure-comparison.mmd">redis-datastructure-comparison.mmd</a> - ziplist vs linkedlist vs hashtable</li>
</ul>
<hr>
<h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><h3 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h3><ol>
<li><a href="https://redis.io/docs/">Redis å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://redis.io/commands/">Redis å‘½ä»¤å‚è€ƒ</a></li>
<li><a href="https://redis.io/docs/data-types/">Redis æ•°æ®ç±»å‹</a></li>
</ol>
<h3 id="æ·±åº¦æ–‡ç« "><a href="#æ·±åº¦æ–‡ç« " class="headerlink" title="æ·±åº¦æ–‡ç« "></a>æ·±åº¦æ–‡ç« </h3><ol>
<li><a href="http://redisbook.com/">Redis è®¾è®¡ä¸å®ç°ï¼ˆé»„å¥å®ï¼‰</a> - æ·±å…¥æºç çº§åˆ«</li>
<li><a href="https://juejin.cn/book/6844733724618129422">Redis æ·±åº¦å†é™©ï¼ˆé’±æ–‡å“ï¼‰</a> - å®æˆ˜è¿›é˜¶</li>
<li><a href="https://tech.meituan.com/2017/03/17/cache-about.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç¼“å­˜é‚£äº›äº‹</a></li>
<li><a href="http://kaito-kidd.com/categories/#Redis">Kaitoâ€™s Blog - Redis ç³»åˆ—</a><ul>
<li><a href="http://kaito-kidd.com/2020/06/29/redis-persistence-rdb-aof/">RedisæŒä¹…åŒ–æ˜¯å¦‚ä½•åšçš„ï¼Ÿ</a></li>
<li><a href="http://kaito-kidd.com/2020/06/28/why-redis-so-fast/">å•çº¿ç¨‹Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ</a></li>
<li><a href="http://kaito-kidd.com/2020/07/07/redis-cluster-codis-twemproxy/">Redisé›†ç¾¤åŒ–æ–¹æ¡ˆå¯¹æ¯”</a></li>
<li><a href="http://kaito-kidd.com/2021/09/08/how-to-keep-cache-and-consistency-of-db/">å¦‚ä½•ä¿æŒç¼“å­˜ä¸æ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Ÿ</a></li>
<li><a href="http://kaito-kidd.com/2021/03/04/redis-best-practice-optimization-road/">Redisæœ€ä½³å®è·µï¼š7ä¸ªç»´åº¦+43æ¡è§„èŒƒ</a></li>
<li><a href="http://kaito-kidd.com/2021/03/14/redis-trap/">Redisçš„15ä¸ªå‘</a></li>
</ul>
</li>
</ol>
<h3 id="å®æˆ˜æ¡ˆä¾‹-1"><a href="#å®æˆ˜æ¡ˆä¾‹-1" class="headerlink" title="å®æˆ˜æ¡ˆä¾‹"></a>å®æˆ˜æ¡ˆä¾‹</h3><ol>
<li><a href="https://gongfukangee.github.io/2019/06/09/SecondsKill/">ç§’æ€ç³»ç»Ÿè®¾è®¡</a></li>
<li><a href="https://www.cnblogs.com/zwwhnly/p/13041641.html">å¾®ä¿¡æ­¥æ•°æ’è¡Œæ¦œå®ç°</a></li>
<li><a href="https://juejin.cn/post/6936956908007850014">åˆ†å¸ƒå¼é”å®ç°</a></li>
<li><a href="https://juejin.cn/post/6844903862072000526">BloomFilteråº”ç”¨</a></li>
</ol>
<h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><ol>
<li><a href="https://cloud.tencent.com/developer/article/1724076">ä½ çš„ Redis ä¸ºä»€ä¹ˆå˜æ…¢äº†ï¼Ÿ</a></li>
<li><a href="https://help.aliyun.com/zh/redis/user-guide/suggestions-for-handling-common-latency-events">é˜¿é‡Œäº‘ Redis å»¶è¿Ÿäº‹ä»¶å¤„ç†å»ºè®®</a></li>
<li><a href="http://blog.caoxl.com/2018/11/28/Redis-Time-Complexity/">Redis å¸¸ç”¨å‘½ä»¤æ—¶é—´å¤æ‚åº¦</a></li>
</ol>
<h3 id="é¢è¯•é¢˜åº“"><a href="#é¢è¯•é¢˜åº“" class="headerlink" title="é¢è¯•é¢˜åº“"></a>é¢è¯•é¢˜åº“</h3><ol>
<li><a href="https://blog.csdn.net/ThinkWon/article/details/103522351">Redis é¢è¯•é¢˜æ±‡æ€»</a></li>
<li><a href="https://juejin.cn/post/6868409018151337991">ä¸€ä¸å°å¿ƒè‚å‡ºäº†4Wå­—çš„Redisé¢è¯•æ•™ç¨‹</a></li>
</ol>
<hr>
<h2 id="æ›´æ–°æ—¥å¿—"><a href="#æ›´æ–°æ—¥å¿—" class="headerlink" title="æ›´æ–°æ—¥å¿—"></a>æ›´æ–°æ—¥å¿—</h2><ul>
<li><p><strong>2026-01-08</strong>: é‡å¤§æ›´æ–°</p>
<ul>
<li>âœ… æ–°å¢ Hash åº•å±‚å®ç°è¯¦è§£ï¼ˆziplist å­—èŠ‚çº§åˆ†æ + hashtable æ¸è¿›å¼ rehashï¼‰</li>
<li>âœ… æ–°å¢ String&#x2F;List&#x2F;Set&#x2F;ZSet åº•å±‚å®ç°è¯´æ˜</li>
<li>âœ… æ–°å¢æ€§èƒ½ä¼˜åŒ–ç« èŠ‚ï¼ˆå¤§Key&#x2F;çƒ­Key å¤„ç†ï¼‰</li>
<li>âœ… æ–°å¢ç›‘æ§å‘Šè­¦æ–¹æ¡ˆ</li>
<li>âœ… æ–°å¢å®æˆ˜æ¡ˆä¾‹ï¼ˆç§’æ€ã€æ’è¡Œæ¦œã€BloomFilterï¼‰</li>
<li>âœ… æ–°å¢å¯è§†åŒ–å›¾è¡¨ç´¢å¼•</li>
<li>âœ… ä¼˜åŒ–æ–‡ç« ç»“æ„ï¼Œå¢åŠ ç›®å½•å¯¼èˆª</li>
</ul>
</li>
<li><p><strong>2024-03-06</strong>: åˆå§‹ç‰ˆæœ¬</p>
<ul>
<li>åŸºç¡€å†…å®¹ï¼šæ•°æ®ç±»å‹ã€ç¼“å­˜ç­–ç•¥ã€æŒä¹…åŒ–ã€åˆ†å¸ƒå¼æ–¹æ¡ˆ</li>
</ul>
</li>
</ul>
<hr>
<p><strong>æŒç»­æ›´æ–°ä¸­ï¼Œæ¬¢è¿æ”¶è—ï¼</strong> ğŸš€</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag"># æ•°æ®ç»“æ„</a>
              <a href="/tags/Redis/" rel="tag"># Redis</a>
              <a href="/tags/%E7%BC%93%E5%AD%98/" rel="tag"># ç¼“å­˜</a>
              <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" rel="tag"># åˆ†å¸ƒå¼ç³»ç»Ÿ</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/03/04/system-design/7-storage-desgin/" rel="prev" title="ä¸­é—´ä»¶ - å­˜å‚¨ä¸Mysqlæ•°æ®åº“">
                  <i class="fa fa-angle-left"></i> ä¸­é—´ä»¶ - å­˜å‚¨ä¸Mysqlæ•°æ®åº“
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/03/07/system-design/10-elasticsearch/" rel="next" title="ä¸­é—´ä»¶ - æœç´¢å’ŒElasticsearch">
                  ä¸­é—´ä»¶ - æœç´¢å’ŒElasticsearch <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wxquare</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
